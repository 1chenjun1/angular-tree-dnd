(function(){angular.module("template/treeTable/treeTable.html",[]).run(["$templateCache",function(a){a.put("template/treeTable/treeTable.html",'<table ng-class="tree_class">\n    <thead>\n  <tr>\n     <th ng-class="expandingProperty.titleClass" ng-style="expandingProperty.titleStyle">\n         {{expandingProperty.displayName || expandingProperty.field || expandingProperty}}\n        </th>\n        <th ng-repeat="col in colDefinitions" ng-class="col.titleClass" ng-style="col.titleStyle">\n         {{col.displayName || col.field}}\n     </th>\n    </tr>\n    </thead>\n <tbody>\n  <tr tree-table-node="row" ng-repeat="row in tree_rows track by row.__hashKey__ " ng-show="row.__visible__"\n     ng-class="(row.__selected__ ? \' active\':\'\')">\n        <td ng-if="!expandingProperty.template" tree-table-node-handle\n         ng-style="expandingProperty.cellStyle ? expandingProperty.cellStyle : {\'padding-left\': $callbacks.calsIndent(row.__level__)}"\n          ng-click="onSelect(row)" ng-class="expandingProperty.cellClass"\n            compile="expandingProperty.cellTemplate">\n              <a data-nodrag>\n                  <i ng-class="$iconClass" ng-click="row.__expanded__ = !row.__expanded__"\n                     class="tree-icon"></i>\n              </a>\n             {{row[expandingProperty.field] || row[expandingProperty]}}\n       </td>\n        <td ng-if="expandingProperty.template" compile="expandingProperty.template"></td>\n        <td ng-repeat="col in colDefinitions" ng-class="col.cellClass" ng-style="col.cellStyle"\n            compile="col.cellTemplate">\n            {{row[col.field]}}\n       </td>\n    </tr>\n    </tbody>\n</table>');a.put("template/treeTable/treeTableStatusCopy.html",'<label><i class="fa fa-copy"></i>&nbsp;<b>Copying</b></label>');a.put("template/treeTable/treeTableStatusMove.html",'<label><i class="fa fa-file-text"></i>&nbsp;<b>Moving</b></label>')}]);angular.module("treeTable",["template/treeTable/treeTable.html"]).directive("compile",["$compile",function(a){return{restrict:"A",link:function(d,c,b){d.$watch(b.compile,function(e){if(e!=null){var f=a(e);var g=f(d);c.empty().append(g)}})}}}]).directive("treeTable",["$timeout","$http","$compile","$window","$document","treeTableTemplate","tgConfig","$TreeTableHelper","$templateCache",function(b,h,f,a,d,g,e,i,c){return{restrict:"E",replace:true,scope:{treeData:"=",on_select:"&onSelect",on_click:"&onClick",tree:"=treeControl",tree_data:"=treeData",expandOn:"=",columnDefs:"=",callbacks:"=",primaryKey:"="},controller:["$scope","$element","$attrs","tgConfig",function(l,k,j,m){l.dragEnabled=true;l.dragDelay=0;l.indent=20;l.indent_plus=15;l.indent_unit="px";l.tree_class="table";l.primary_key="__uid__";l.enabledMove=true;l.statusMove=true;l.enabledStatus=false;l.enabledHotkey=false;l.$globals={};l.config={};l.statusElm=null;l.placeElm=null;l.toggleExpand=function(n){if(n.__children__.length>0){n.__expanded__=!n.__expanded__}};l.classIcon={};l.$callbacks={accept:function(o,n){return true},beforeDrag:function(n){return true},dragStart:function(n){},dragMove:function(n){},dragStop:function(n,o){},beforeDrop:function(n){return true},calsIndent:function(r,o,n){var q=0,p=(n)?0:l.indent_plus;if(!o){q=l.indent_unit?l.indent_unit:"px"}if(r-1<1){return p+q}else{return l.indent*(r-1)+p+q}},dragEnabled:function(){return l.dragEnabled},dropped:function(t,s,n){var p=t.node,u=t.parent||t.drag.treeData,o=t.move,q=o.parent||t.scope.treeData,r;if(q!=-1){if(n==true){r=u;if(r.__children__){r=r.__children__}p=r.splice(p.__index__,1)[0]}else{p=angular.copy(p);p.__uid__=null}if(t.drag==t.scope&&u==q&&o.pos>=t.node.__index__){o.pos--}if(o.pos>-1){r=q;if(r.__children__){r=r.__children__}r.splice(o.pos,0,p)}else{}return true}return false}};l.accept=function(o,n){return l.$callbacks.accept(o,n)};l.beforeDrag=function(n){return l.$callbacks.beforeDrag(n)};l.getPrevGlobal=function(n){if(n>0){return l.tree_rows[n-1]}return null};l.getNextGlobal=function(n){if(n>0){return l.tree_rows[n-1]}return null};l.getNode=function(n){if(n==null){return null}return l.tree_rows[n]};l.getHash=function(n){if(l.primary_key=="__uid__"){return"#"+n.__parent__+"#"+n.__index__+"#"+n.__uid__}else{return"#"+n.__parent__+"#"+n.__index__+"#"+n[l.primary_key]}};l.setScope=function(p,n){var o=l.getHash(p);if(l.$globals[o]!=n){l.$globals[o]=n}};l.getScope=function(n){if(n){return l.$globals[l.getHash(n)]}else{return l}};l.enableMove=function(n){if((typeof n)==="boolean"){l.enabledMove=n}else{l.enabledMove=true}};l.setPositionStatus=function(n){if(l.statusElm){l.statusElm.css({left:n.pageX+10+"px",top:n.pageY+15+"px","z-index":9999});l.statusElm.addClass(l.config.statusClass)}};l.hideStatus=function(){if(l.statusElm){l.statusElm.addClass(l.config.hiddenClass)}};l.refreshStatus=function(){if(l.enabledStatus){var n=l.statusElm;if(l.enabledMove){l.statusElm=angular.element(g.getMove())}else{l.statusElm=angular.element(g.getCopy())}if(n==l.statusElm){l.statusElm.removeClass(l.config.hiddenClass)}else{if(n){l.statusElm.attr("class",n.attr("class"));l.statusElm.attr("style",n.attr("style"));n.remove()}l.statusElm.removeClass(l.config.hiddenClass);d.find("body").append(l.statusElm)}}};l.initPlace=function(p,r,q){var o=p.prop("tagName").toLowerCase();if(!l.placeElm){if(o.toLowerCase()=="tr"){l.placeElm=angular.element(a.document.createElement("tr"));var n=l.colDefinitions.length;l.placeElm.append(angular.element(a.document.createElement("td")).addClass(l.config.emptyTreeClass).addClass("indented").addClass(l.config.placeHolderClass));while(n-->0){l.placeElm.append(angular.element(a.document.createElement("td")).addClass(l.config.emptyTreeClass).addClass(l.config.placeHolderClass))}}else{l.placeElm=angular.element(a.document.createElement("li")).addClass(l.config.emptyTreeClass).addClass(l.config.placeHolderClass)}}else{l.placeElm.removeClass(l.config.hiddenClass)}if(o.toLowerCase()=="tr"){i.replaceIndent(l,l.placeElm,r)}p[0].parentNode.insertBefore(l.placeElm[0],p[0]);l.placeElm.css("height",i.height(q)+"px");return l.placeElm};l.onClick=function(n){if(angular.isFunction(l.on_click)){l.on_click({branch:n})}};l.onSelect=function(n){if(n!==selected_branch){select_branch(n)}if(angular.isFunction(l.on_select)){l.on_select({branch:n})}};l.hidePlace=function(){if(l.placeElm){l.placeElm.addClass(l.config.hiddenClass)}};l.showPlace=function(){if(l.placeElm){l.placeElm.removeClass(l.config.hiddenClass)}}}],link:function(k,l,u){k.$type="TreeTable";k.colDefinitions=[];k.$watch(u.enableStatus,function(n){if((typeof n)==="boolean"){k.enabledStatus=n}},true);k.$watch(u.enableMove,function(n){if((typeof n)==="boolean"){k.enabledMove=n;k.statusMove=n}},true);k.$watch(u.templateCopy,function(C){var n=null;if((typeof C)==="string"&&C.trim().length>0){n=C.trim()}else{n=u.templateCopy;if(n){n=n.trim();if(n.length==0&&!c.get(n)){n=null}}}if(n){if(c.get(n)){g.setCopy(n)}}},true);k.$watch(u.templateMove,function(C){var n=null;if((typeof C)==="string"&&C.trim().length>0){n=C.trim()}else{n=u.templateMove;if(n){n=n.trim();if(n.length==0&&!c.get(n)){n=null}}}if(n){if(c.get(n)){g.setMove(n)}}},true);if(!u.primaryKey){k.primary_key=="__uid__"}else{k.$watch(u.primaryKey,function(n){if(typeof n==="string"){k.primary_key=n}else{k.primary_key=u.primaryKey}},true)}k.$watch(u.callbacks,function(n){angular.forEach(n,function(D,C){if(typeof D==="function"){if(k.$callbacks[C]){k.$callbacks[C]=D}}})},true);if((typeof u["class"])==="string"){k.tree_class=u["class"].trim()}if((typeof u.indentUnit)==="string"){k.indent_unit=u.indentUnit}k.$watch(u.enableHotkey,function(n){if((typeof n)==="boolean"){k.enabledHotkey=n}if(k.enabledHotkey){k.enabledMove=false}else{k.enabledMove=k.statusMove}},true);k.$watch(u.enableDrag,function(n){if((typeof n)==="boolean"){k.dragEnabled=n}},true);k.$watch(u.indent,function(n){if((typeof n)=="number"){k.indent=n}else{if((typeof u.indent)=="number"){k.indent=n}}},true);k.$watch(u.indentPlus,function(n){if((typeof n)=="number"){k.indent_plus=n}else{if((typeof u.indentPlus)=="number"){k.indent_plus=n}}},true);k.$watch(u.dragDelay,function(n){if((typeof n)=="number"){k.dragDelay=n}else{if((typeof u.dragDelay)=="number"){k.dragDelay=n}}},true);k.config={};angular.extend(k.config,e);k.$watch(u.config,function(n){angular.extend(k.config,n)},true);var r,y,v,s;k.classIcon={"1":u.iconExpand?u.iconExpand:"glyphicon glyphicon-minus","0":u.iconCollapse?u.iconCollapse:"glyphicon glyphicon-plus","-1":u.iconLeaf?u.iconLeaf:"glyphicon glyphicon-file"};u.expandLevel=u.expandLevel?u.expandLevel:"3";y=parseInt(u.expandLevel,10);if(!k.treeData){k.treeData=[]}var B=function(){if(k.treeData.length){var F=k.treeData[0],D=Object.keys(F),E=new RegExp("^__([a-zA-Z0-9_-]*)__$");for(var C=0,n=D.length;C<n;C++){if(typeof(F[D[C]])==="string"&&!E.test(D[C])){r=D[C];break}}if(!r){r=D[0]}k.expandingProperty=r}},x=function(){if(k.treeData.length){var C=[],E=k.treeData[0];var D=new RegExp("(^__([a-zA-Z0-9_-]*)__$|^"+r+"$)");for(var n in E){if(!D.test(n)){C.push({field:n})}}k.colDefinitions=C}};if(u.expandOn){r=k.expandOn||[];k.expandingProperty=k.expandOn||[]}if(u.columnDefs){if(!(angular.isArray(k.columnDefs))){x()}else{k.colDefinitions=k.columnDefs}}k.tree_rows=[];var A=null,q=function(F){var C,E,n,D;C=function(H,K){F(H,K);if(H.__children__!=null){var J,G,I;I=H.__children__;for(J=0,G=I.length;J<G;J++){C(I[J],K+1)}}};D=k.treeData;for(E=0,n=D.length;E<n;E++){C(D[E],1)}},w=function(n){if(!n){if(A!=null){A.__selected__=false}A=null;return}if(n!==A){if(A!=null){A.__selected__=false}n.__selected__=true;A=n;o(n);if(angular.isFunction(k.onSelect)){return b(function(){return k.onSelect(n)})}}},z=function(n){if(n.__parent_real__!==null&&n.__parent_real__>-1&&n.__parent_real__<k.tree_rows.length){return k.tree_rows[n.__parent_real__]}return null},t=function(D,C){var n;n=z(D);if(n!=null){C(n);return t(n,C)}},o=function(n){return t(n,function(C){return C.__expanded__=true})},j=function(){if(!u.expandOn){B()}if(!u.columnDefs){x()}var H,n;n=k.treeData;H=n.length;var C=[];if(H>0){var D,F;F=function(T,U,P,L,M,Q){var N,S,O;if(!angular.isArray(T.__children__)){T.__children__=[]}T.__parent_real__=P;T.__parent__=U;S=T.__children__.length;if(T.__expanded__==null&&S>0){T.__expanded__=L<y}if(S===0){O=-1}else{if(T.__expanded__){O=1}else{O=0}}var W=C.length;T.__index__=Q;T.__index_real__=W;T.__level__=L;T.__icon__=O;T.__visible__=M;if(T.__uid__==null){T.__uid__=""+Math.random()}C.push(T);var R=1;if(S>0){for(N=0;N<S;N++){R+=F(T.__children__[N],(k.primary_key=="__uid__")?T.__uid__:T[k.primary_key],W,L+1,M&&T.__expanded__,N)}}var V;if(k.primary_key=="__uid__"){V="#"+P+"#"+W+"#"+T.__uid__}else{V="#"+P+"#"+W+"#"+T[k.primary_key]}if(T.__hashKey__==null||T.__hashKey__!=V){T.__hashKey__=V;k.$globals[V]=null}T.__dept__=R;return R};var J=0;for(D=0;D<H;D++){J+=F(n[D],null,null,1,true,D)}var I,K,G=Object.keys(k.$globals),E=k.$globals.length;I=E-J;if(I!=0){K=E-I;_min=K-Math.abs(I);for(D=_min;D<K;D++){delete (k.$globals[G[D]])}}}k.tree_rows=C;return k.tree_rows},p=function(n){if(n.keyCode==27){k.hideStatus();k.$$apply=false;k.dragEnd(n)}else{if(k.enabledHotkey&&n.shiftKey){k.enableMove(true);k.refreshStatus()}}},m=function(n){if(k.enabledHotkey&&!n.shiftKey){k.enableMove(false);k.refreshStatus()}};k.$watch("treeData",j,true);j();angular.element(a.document.body).bind("keydown",p);angular.element(a.document.body).bind("keyup",m);k.$on("$destroy",function(){angular.element(a.document.body).unbind("keydown",p);angular.element(a.document.body).unbind("keyup",m);if(k.statusElm){k.statusElm.remove()}if(k.placeElm){k.placeElm.remove()}});if(k.tree!=null){if(angular.isObject(k.tree)){s=k.tree;s.expand_all=function(){q(function(n,C){n.__expanded__=true})};s.collapse_all=function(){q(function(n,C){n.__expanded__=false})};s.get_first_branch=function(){v=k.treeData.length;if(v>0){return k.treeData[0]}return null};s.select_first_branch=function(){var n;n=s.get_first_branch();return s.select_branch(n)};s.get_selected_branch=function(){return A};s.get_parent_branch=function(n){return z(n)};s.select_branch=function(n){w(n);return n};s.get_children=function(n){return n.__children__};s.select_parent_branch=function(n){var C;if(n==null){n=s.get_selected_branch()}if(n!=null){C=s.get_parent_branch(n);if(C!=null){s.select_branch(C);return C}}};s.add_branch=function(C,D,n){if((typeof n)!="number"){if(C!=null){C.__children__.push(D);C.__expanded__=true}else{k.treeData.push(D)}}else{if(C!=null){C.__children__.splice(n,0,D);C.__expanded__=true}else{k.treeData.splice(n,0,D)}}return D};s.add_root_branch=function(n){s.add_branch(null,n);return n};s.remove_branch=function(D){D=D||s.get_selected_branch();if(D){var C;if(D.__parent_real__!==null){C=s.get_parent_branch(D).__children__}else{C=k.treeData}var n=C.indexOf(D);C.splice(n,1);A=null}};s.expand_branch=function(n){if(n==null){n=s.get_selected_branch()}if(n!=null){n.__expanded__=true;return n}};s.collapse_branch=function(n){if(n==null){n=A}if(n!=null){n.__expanded__=false;return n}};s.get_siblings=function(n){var C,D;if(n==null){n=A}if(n!=null){C=s.get_parent_branch(n);if(C){D=C.__children__}else{D=k.treeData}return D}};s.get_next_sibling=function(n){var C,D;if(n==null){n=A}if(n!=null){D=s.get_siblings(n);v=D.length;C=D.indexOf(n);if(C<v){return D[C+1]}}};s.get_prev_sibling=function(n){var C,D;if(n==null){n=A}D=s.get_siblings(n);v=D.length;C=D.indexOf(n);if(C>0){return D[C-1]}};s.select_next_sibling=function(n){var C;if(n==null){n=A}if(n!=null){C=s.get_next_sibling(n);if(C!=null){return s.select_branch(C)}}};s.select_prev_sibling=function(n){var C;if(n==null){n=A}if(n!=null){C=s.get_prev_sibling(n);if(C!=null){return s.select_branch(C)}}};s.get_first_child=function(n){var C;if(n==null){n=A}if(n!=null){if(((C=n.__children__)!=null?C.length:void 0)>0){return n.__children__[0]}}};s.get_closest_ancestor_next_sibling=function(n){var D,C;D=s.get_next_sibling(n);if(D!=null){return D}else{C=s.get_parent_branch(n);return s.get_closest_ancestor_next_sibling(C)}};s.get_next_branch=function(n){var C;if(n==null){n=A}if(n!=null){C=s.get_first_child(n);if(C!=null){return C}else{C=s.get_closest_ancestor_next_sibling(n);return C}}};s.select_next_branch=function(n){var C;if(n==null){n=A}if(n!=null){C=s.get_next_branch(n);if(C!=null){s.select_branch(C);return C}}};s.last_descendant=function(n){var C;if(n==null){}v=n.__children__.length;if(v===0){return n}else{C=n.__children__[v-1];return s.last_descendant(C)}};s.get_prev_branch=function(n){var C,D;if(n==null){n=A}if(n!=null){D=s.get_prev_sibling(n);if(D!=null){return s.last_descendant(D)}else{C=s.get_parent_branch(n);return C}}};s.reload_data=function(){return j()};s.select_prev_branch=function(n){var C;if(n==null){n=A}if(n!=null){C=s.get_prev_branch(n);if(C!=null){s.select_branch(C);return C}}}}}h.get(u.templateUrl||g.getPath(),{cache:c}).success(function(X){l.append(f(X)(k));var R="ontouchstart" in window,Y,N,D,I,C,V,F=true,G=false,E=null,L=document.body,M=document.documentElement,O,H,K,U=function(af){if(!R&&(af.button==2||af.which==3)){return}if(af.uiTreeDragging||(af.originalEvent&&af.originalEvent.uiTreeDragging)){return}var ai=angular.element(af.target);var ad=ai.scope();if(!ad||!ad.$type){return}if(ad.$type!="TreeTableNode"&&ad.$type!="TreeTableNodeHandle"){return}if(ad.$type!="TreeTableNodeHandle"){return}var ab=ai.prop("tagName").toLowerCase(),ah=null;if(ab=="input"||ab=="textarea"||ab=="button"||ab=="select"){return}while(ai&&ai[0]&&ai[0]!=l){if(i.nodrag(ai)){return}ai=ai.parent()}ah=ad.getScopeNode();if(!k.beforeDrag(ah)){return}af.uiTreeDragging=true;if(af.originalEvent){af.originalEvent.uiTreeDragging=true}af.preventDefault();var ag=i.eventObj(af);N=true;D=i.dragInfo(ah);var aa=ah.$element.prop("tagName").toLowerCase();I=i.positionStarted(ag,ah.$element);if(aa==="tr"){V=angular.element(a.document.createElement("table")).addClass(k.config.treeClass).addClass(k.config.dragClass).addClass(k.tree_class)}else{V=angular.element(a.document.createElement("ul")).addClass(k.config.dragClass).addClass("tree-table-rows").addClass(k.tree_class)}V.css({width:i.width(ah.$element)+"px","z-index":9995});k.refreshStatus();k.setPositionStatus(af);K=0;var ac=i.width(ah.$element);if(aa=="tr"){var ae=angular.element(a.document.createElement("tbody"));K=ah.node().__level__-1;var Z=function(an){var aj,al,ao,ak,ap,am;aj=k.getScope(an);al=aj.$element;am=al.clone();i.replaceIndent(aj,am,an.__level__-K,"padding-left");ae.append(am);if(k.config.hiddenClass){al.addClass(k.config.hiddenClass)}ap=an.__children__;ak=ap.length;for(ao=0;ao<ak;ao++){Z(ap[ao])}};Z(ah.node());V.append(ae)}else{V.append(ah.$element.clone());if(k.config.hiddenClass){ah.$element.addClass(k.config.hiddenClass)}}V.css({left:ag.pageX-I.offsetX+k.$callbacks.calsIndent(K+1,true,true)+"px",top:ag.pageY-I.offsetY+"px"});d.find("body").append(V);C=k.initPlace(ah.$element,D.level,V);C.css("width",ac);angular.element(d).bind("touchend",J);angular.element(d).bind("touchcancel",J);angular.element(d).bind("touchmove",Q);angular.element(d).bind("mouseup",J);angular.element(d).bind("mousemove",Q);angular.element(d).bind("mouseleave",W);O=Math.max(L.scrollHeight,L.offsetHeight,M.clientHeight,M.scrollHeight,M.offsetHeight);H=Math.max(L.scrollWidth,L.offsetWidth,M.clientWidth,M.scrollWidth,M.offsetWidth)},T=function(at){if(!G){if(!F){G=true;k.$apply(function(){k.$callbacks.dragStart(D)})}return}var Z=i.eventObj(at);var ao,aw,ag;if(V){at.preventDefault();if(a.getSelection){a.getSelection().removeAllRanges()}else{if(a.document.selection){a.document.selection.empty()}}aw=Z.pageX-I.offsetX;ag=Z.pageY-I.offsetY;if(aw<0){aw=0}if(ag<0){ag=0}if((ag+10)>O){ag=O-10}if((aw+10)>H){aw=H-10}V.css({left:aw+k.$callbacks.calsIndent(K+1,true,true)+"px",top:ag+"px"});k.setPositionStatus(at);var ad=window.pageYOffset||a.document.documentElement.scrollTop;var ai=ad+(window.innerHeight||a.document.clientHeight||a.document.clientHeight);if(ai<Z.pageY&&ai<=O){window.scrollBy(0,10)}if(ad>Z.pageY){window.scrollBy(0,-10)}i.positionMoved(at,I,N);if(N){N=false;return}var al=Z.pageX-a.document.body.scrollLeft;var ak=Z.pageY-(window.pageYOffset||a.document.documentElement.scrollTop);var ac=angular.element(a.document.elementFromPoint(al,ak)),aq=ac.scope(),aa=null,ap,ah=false;if(aq&&angular.isFunction(aq.getScopeNode)){aq=aq.getScopeNode();aa=aq.$element.prop("tagName").toLowerCase();if(D.scope!==aq){D.scope.hidePlace();D.scope=aq;D.scope.showPlace();ah=true}}if(!I.dirAx||ah){if(!aq){return}ac=aq.$element;var ae,av=i.offset(ac);if(aa=="tr"){ae=Z.pageY<(av.top+i.height(ac)/2)}else{var ax=i.height(ac)-i.height(aq.elementChilds);if(Z.pageY>av.top+ax){return}ae=Z.pageY<(av.top+ax/2)}C=aq.initPlace(ac,D.level,V);C.css("width",i.width(ac));if(aq.$callbacks.dragEnabled()){if(aq.accept(D,ae)){D.level=aq.node().__level__;if(ae){var aj=aq.node(),ar=aq.getNode(aj.__parent_real__),af;if(D.drag==aq&&D.isDirty(aq.node().__index_real__-1)){af=aq.getPrevGlobal(D.node.__index_real__)}else{af=aq.prev()}D.target=af;D.scope=aq;if(D.drag==aq&&ar.__index_real__&&D.node.__parent_real__){D.move={parent:-1,pos:-1}}else{D.move={parent:ar,pos:(ar==af)?0:af.__index__+1}}if(aa=="tr"){i.replaceIndent(aq,C,D.level)}ac[0].parentNode.insertBefore(C[0],ac[0])}else{var an=D.level,ab=false;aj=aq.node();D.target=aj;D.scope=aq;if(D.drag==aq&&D.parent.__index_real__==aj.__index_real__&&D.node.__index__==0){ab=true}if(aj.__expanded__&&!ab){D.level=++an;D.move={parent:aj,pos:0};if(aa=="tr"){i.replaceIndent(aq,C,an);ac.after(C)}else{aq.elementChilds.prepend(C)}}else{if(ab){D.move={parent:-1,pos:-1}}else{ar=aq.getNode(aj.__parent_real__);D.move={parent:ar,pos:aj.__index__+1}}if(aa=="tr"){i.replaceIndent(aq,C,an)}ac.after(C)}}}}}else{aq=D.scope;aa=aq.$element.prop("tagName").toLowerCase();if(I.dirAx&&I.distAxX>=aq.config.levelThreshold){I.distAxX=0;aj=D.target;if(aj){if(I.distX>0){var am=aq.visible(aj),au;if(am&&am.__level__>=D.level){ar=am;while(ar.__level__>D.level){ar=aq.getNode(ar.__parent_real__)}au=ar.__children__.length;D.level++;if(D.drag==aq&&D.parent==ar&&D.node.__index__>=au-1){D.target=am;D.move={parent:-1,pos:-1}}else{D.move={parent:ar,pos:au}}if(aa=="tr"){i.replaceIndent(aq,C,D.level)}else{_scope=aq.getScope(am);_scope.elementChilds.append(C)}}}else{if(I.distX<0){var aj=D.canIndent();ar=aq.getNode(aj.__parent_real__);if(aj==null||aj){D.level--;if(D.drag==aq&&D.parent==ar&&D.node.__index__==aj.__index__+1){D.move={parent:-1,pos:-1}}else{D.move={parent:ar,pos:aj.__index__+1}}if(aa=="tr"){i.replaceIndent(aq,C,D.level)}else{_scope=aq.getScope(aj);_scope.$element.after(C)}}}}}}}k.$apply(function(){k.$callbacks.dragMove(D)})}},P=function(ad){ad.preventDefault();if(V){var aa=false;k.$apply(function(){aa=k.$callbacks.beforeDrop(D)});var ab=D.drag.$element.prop("tagName").toLowerCase();if(ab=="tr"){var Z=function(ah){var ae,ag,ai,af,aj;ae=k.getScope(ah);ag=ae.$element;if(k.config.hiddenClass){ag.removeClass(k.config.hiddenClass)}aj=ah.__children__;af=aj.length;for(ai=0;ai<af;ai++){Z(aj[ai])}};Z(D.drag.node())}else{if(k.config.hiddenClass){D.drag.$element.removeClass(k.config.hiddenClass)}}V.remove();V=null;D.scope.hidePlace();D.drag.hideStatus();var ac=false;if(k.$$apply){k.$apply(function(){ac=k.$callbacks.dropped(D,aa,k.enabledMove)})}else{S()}k.$apply(function(){k.$callbacks.dragStop(D,ac)});k.$$apply=false;D=null}angular.element(d).unbind("touchend",J);angular.element(d).unbind("touchcancel",J);angular.element(d).unbind("touchmove",Q);angular.element(d).unbind("mouseup",J);angular.element(d).unbind("mousemove",Q);angular.element(a.document.body).unbind("mouseleave",W)},n=function(Z){if(k.$callbacks.dragEnabled()){U(Z)}},Q=function(Z){T(Z)},J=function(Z){k.$$apply=true;k.dragEnd(Z)},W=function(Z){k.dragEnd(Z)},S=function(){l.bind("touchstart mousedown",function(Z){F=true;G=false;n(Z);E=b(function(){F=false},k.dragDelay)});l.bind("touchend touchcancel mouseup",function(){b.cancel(E)})};k.dragEnd=function(Z){P(Z)};S()})}}}]).directive("treeTableNode",["$window","$document","$timeout","$TreeTableHelper","treeTableTemplate",function(e,d,a,c,b){return{restrict:"A",replace:true,controller:["$scope","$element","$attrs","tgConfig",function(h,g,f,i){h.$modelValue=null;h.$scopeChildren=null;h.elementChilds=null;h.childNodesCount=function(){return h.childNodes().length};h.childNodes=function(){return h.$modelValue.__children__};h.prev=function(){return h.getPrevGlobal(h.$modelValue.__index_real__)};h.prevSibling=function(k){var l=h.getNode(k.__parent_real__),j=k.__index__;if(l){if(j>0){return l.__children__[j-1]}}else{if(j>0){return h.treeData[j-1]}}return null};h.next=function(){return h.getNextGlobal(h.$modelValue.__index_real__)};h.node=function(){return h.$modelValue};h.data=function(){return h.$modelValue};h.visible=function(j){if(j!=null){return j.__visible__?j:h.visible(h.tree_rows[j.__parent_real__])}return null};h.setElementChilds=function(j){h.elementChilds=j};h.getScopeNode=function(){return h}}],link:function(h,g,f){h.$element=g;h.$type="TreeTableNode";h.$iconClass="";if(h.config.nodeClass){g.addClass(h.config.nodeClass)}h.$watch(f.treeTableNode,function(i){h.setScope(i,h);h.$modelValue=i;h.$iconClass=h.classIcon[i.__icon__]},true)}}}]).directive("treeTableNodes",function(){return{restrict:"A",replace:true,controller:["$scope","$element","$attrs","tgConfig",function(c,b,a,d){c.datas=[]}],link:function(c,b,a){c.$type="TreeTableNodes";c.$element=b;if(c.setElementChilds){c.setElementChilds(b)}c.$watch(a.treeTableNodes,function(f,d,e){e.datas=f},true);if(c.config.nodesClass){b.addClass(c.config.nodesClass)}c.$element=b}}}).directive("treeTableNodeHandle",function(){return{restrict:"A",scope:true,controller:["$scope","$element","$attrs","tgConfig",function(c,b,a,d){}],link:function(c,b,a){c.$element=b;c.$type="TreeTableNodeHandle";if(c.config.handleClass){b.addClass(c.config.handleClass)}}}}).factory("treeTableTemplate",["$templateCache",function(a){var c="template/treeTable/treeTable.html";var b="template/treeTable/treeTableStatusCopy.html";var d="template/treeTable/treeTableStatusMove.html";return{setMove:function(e){d=e},setCopy:function(e){b=e},getPath:function(){return c},getCopy:function(){var e=a.get(b);if(e){return e}return a.get("template/treeTable/treeTableStatusCopy.html")},getMove:function(){var e=a.get(d);if(e){return e}return a.get("template/treeTable/treeTableStatusMove.html")}}}]).factory("$TreeTableHelper",["$document","$window",function(b,a){return{calsIndent:null,isUndefinedOrNull:function(c){return angular.isUndefined(c)||c===null},nodrag:function(c){return(typeof c.attr("data-nodrag"))!="undefined"},eventObj:function(d){var c=d;if(d.targetTouches!==undefined){c=d.targetTouches.item(0)}else{if(d.originalEvent!==undefined&&d.originalEvent.targetTouches!==undefined){c=d.originalEvent.targetTouches.item(0)}}return c},dragInfo:function(d){var c=d.node();return{node:c,parent:d.getNode(c.__parent_real__),level:c.__level__,target:d.prev(),scope:d,drag:d,move:{parent:-1,pos:-1},isDirty:function(e){return this.node.__index_real__<=e&&e<=this.node.__index_real__+this.node.__dept__-1},canIndent:function(){if(this.level==1){return false}var e=this.target;var f=e;while(e){if(e.__level__<this.level){if(e.__expanded__){if(e.__children__.length==0){return e}else{if((e.__index_real__==this.target.__parent_real__&&e.__children__.length-1==this.target.__index__)||(e.__index_real__==f.__parent_real__&&e.__children__.length-1==f.__index__)||(this.drag==this.scope&&e.__index_real__==this.node.__parent_real__&&e.__children__.length-1==this.node.__index__)){return e}}return false}return e}else{if(e.__parent_real__==null){return null}else{f=e;e=this.scope.tree_rows[e.__parent_real__]}}}return false},canInsert:function(e){if(e.__children__.length==0){return true}else{if((e.__index_real__==this.target.__parent_real__&&e.__children__.length-1==this.target.__index__)||(e.__index_real__==this.node.__parent_real__&&e.__children__.length-1==this.node.__index__)){return e}}return false}}},height:function(c){return c.prop("scrollHeight")},width:function(c){return c.prop("scrollWidth")},offset:function(c){var d=c[0].getBoundingClientRect();return{width:c.prop("offsetWidth"),height:c.prop("offsetHeight"),top:d.top+(a.pageYOffset||b[0].body.scrollTop||b[0].documentElement.scrollTop),left:d.left+(a.pageXOffset||b[0].body.scrollLeft||b[0].documentElement.scrollLeft)}},positionStarted:function(d,c){var f={};f.offsetX=d.pageX-this.offset(c).left;f.offsetY=d.pageY-this.offset(c).top;f.startX=f.lastX=d.pageX;f.startY=f.lastY=d.pageY;f.nowX=f.nowY=f.distX=f.distY=f.dirAx=0;f.dirX=f.dirY=f.lastDirX=f.lastDirY=f.distAxX=f.distAxY=0;return f},positionMoved:function(f,g,d){g.lastX=g.nowX;g.lastY=g.nowY;g.nowX=f.pageX;g.nowY=f.pageY;g.distX=g.nowX-g.lastX;g.distY=g.nowY-g.lastY;g.lastDirX=g.dirX;g.lastDirY=g.dirY;g.dirX=g.distX===0?0:g.distX>0?1:-1;g.dirY=g.distY===0?0:g.distY>0?1:-1;var c=Math.abs(g.distX)>Math.abs(g.distY)?1:0;if(d){g.dirAx=c;g.moving=true;return}if(g.dirAx!==c){g.distAxX=0;g.distAxY=0}else{g.distAxX+=Math.abs(g.distX);if(g.dirX!==0&&g.dirX!==g.lastDirX){g.distAxX=0}g.distAxY+=Math.abs(g.distY);if(g.dirY!==0&&g.dirY!==g.lastDirY){g.distAxY=0}}g.dirAx=c},replaceIndent:function(f,e,d,c){c=c?c:"left";angular.element(e.children()[0]).css(c,f.$callbacks.calsIndent(d))}}}]).factory("$TreeTableConvert",function(){return{line2tree:function(d,j,h){if(!d||d.length==0||!j||!h){return[]}var m=[],a=[],k=d[0],b=k[j],l={},e,g,f=d.length,c=0;while(c<f){k=d[c++];b=k[j];l[b]=k;e=k[h];if(e){g=l[e];if(g.__children__){g.__children__.push(k)}else{g.__children__=[k]}}else{a.push(b)}}f=a.length;for(c=0;c<f;c++){m.push(l[a[c]])}return m},tree2tree:function(c,a){var b=function(g){var i=[];var f,d=g.length,h,e;for(f=0;f<d;f++){h=angular.copy(g[f]);if(angular.isArray(h[a])&&h[a].length>0){e=b(h[a]);delete (h[a]);h.__children__=e}i.push(h)}return i};return b(c)}}}).constant("tgConfig",{treeClass:"tree-table",emptyTreeClass:"tree-table-empty",hiddenClass:"tree-table-hidden",nodeClass:"tree-table-row",nodesClass:"tree-table-rows",handleClass:"tree-table-handle",placeHolderClass:"tree-table-placeholder",dragClass:"tree-table-drag",statusClass:"tree-table-status",levelThreshold:30})}).call(window);