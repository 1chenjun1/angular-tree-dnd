(function(){angular.module("template/treeTable/treeTable.html",[]).run(["$templateCache",function(a){a.put("template/treeTable/treeTable.html",'<table ng-class="tree_class">\n    <thead>\n  <tr>\n     <th ng-class="expandingProperty.titleClass" ng-style="expandingProperty.titleStyle">\n         {{expandingProperty.displayName || expandingProperty.field || expandingProperty}}\n        </th>\n        <th ng-repeat="col in colDefinitions" ng-class="col.titleClass" ng-style="col.titleStyle">\n         {{col.displayName || col.field}}\n     </th>\n    </tr>\n    </thead>\n <tbody>\n  <tr tree-table-node="row" ng-repeat="row in tree_rows track by row.__hashKey__ " ng-show="row.__visible__"\n     ng-class="(row.__selected__ ? \' active\':\'\')">\n        <td ng-if="!expandingProperty.template" tree-table-node-handle\n         ng-style="expandingProperty.cellStyle ? expandingProperty.cellStyle : {\'padding-left\': $callbacks.calsIndent(row.__level__)}"\n          ng-click="user_clicks_branch(row)" ng-class="expandingProperty.cellClass"\n            compile="expandingProperty.cellTemplate">\n              <a data-nodrag>\n                  <i ng-class="row.__tree_icon__" ng-click="row.__expanded__ = !row.__expanded__"\n                     class="tree-icon"></i>\n              </a>\n             {{row[expandingProperty.field] || row[expandingProperty]}}\n       </td>\n        <td ng-if="expandingProperty.template" compile="expandingProperty.template"></td>\n        <td ng-repeat="col in colDefinitions" ng-class="col.cellClass" ng-style="col.cellStyle"\n            compile="col.cellTemplate">\n            {{row[col.field]}}\n       </td>\n    </tr>\n    </tbody>\n</table>');a.put("template/treeTable/treeTableStatusCopy.html",'<label><i class="fa fa-copy"></i>&nbsp;<b>Copying</b></label>');a.put("template/treeTable/treeTableStatusMove.html",'<label><i class="fa fa-file-text"></i>&nbsp;<b>Moving</b></label>')}]);angular.module("treeTable",["template/treeTable/treeTable.html"]).directive("compile",["$compile",function(a){return{restrict:"A",link:function(d,c,b){d.$watch(b.compile,function(e){if(e!=null){var f=a(e);var g=f(d);c.empty().append(g)}})}}}]).directive("treeTable",["$timeout","$window","$document","treeTableTemplate","tgConfig","$TreeTableHelper","$templateCache",function(b,g,f,e,d,c,a){return{restrict:"E",replace:true,scope:{treeData:"=",onSelect:"&",onClick:"&",tree:"=treeControl",tree_data:"=treeData",expandOn:"=",columnDefs:"=",callbacks:"=",primaryKey:"="},templateUrl:function(h,i){return i.templateUrl||e.getPath()},controller:["$scope","$element","$attrs","tgConfig",function(j,i,h,k){j.dragEnabled=true;j.dragDelay=0;j.indent=20;j.indent_plus=15;j.indent_unit="px";j.tree_class="table";j.primary_key="__uid__";j.enabledMove=true;j.statusMove=true;j.enabledStatus=false;j.enabledHotkey=false;j.$globals={};j.statusElm=null;j.placeElm=null;j.$callbacks={accept:function(m,l){return true},beforeDrag:function(l){return true},dragStart:function(l){},dragMove:function(l){},dragStop:function(l,m){},beforeDrop:function(l){return true},calsIndent:function(p,m,l){var o=0,n=(l)?0:j.indent_plus;if(!m){o=j.indent_unit?j.indent_unit:"px"}if(p-1<1){return n+o}else{return j.indent*(p-1)+n+o}},dragEnabled:function(){return j.dragEnabled}};j.dropped=function(p,r){var u=p.node,l=p.target,n=p.scope;var m=null;var s=null;var t=0;if(u.__parent_real__===null){m=j.treeData;s=null}else{s=j.tree_rows[u.__parent_real__];m=s.__children__}var q=m;if(l!==null){if(l.__level__==p.level){if(u.__parent_real__!==l.__parent_real__){if(l.__parent_real__===null){q=j.treeData;s=null}else{s=j.tree_rows[l.__parent_real__];q=s.__children__}}t=l.__index__+1}else{if(l.__level__<p.level){q=l.__children__;s=l}else{while(l.__level__>p.level){if(l.__parent_real__!==null){l=j.tree_rows[l.__parent_real__]}else{break}}if(l.__parent_real__===null){q=j.treeData;s=null}else{s=j.tree_rows[l.__parent_real__];q=s.__children__}t=l.__index__+1}}}else{q=j.treeData;s=null}if(q!=m||u.__index__!=t){if(q===m){if(t>u.__index__){t--}}if(r==true){var o=m.splice(u.__index__,1)[0];q.splice(t,0,o)}p.move={parent:s,pos:t};return true}return false};j.accept=function(m,l){return j.$callbacks.accept(m,l)};j.beforeDrag=function(l){return j.$callbacks.beforeDrag(l)};j.getPrevGlobal=function(l){if(l>0){return j.tree_rows[l-1]}return null};j.getNextGlobal=function(l){if(l>0){return j.tree_rows[l-1]}return null};j.getHash=function(l){if(j.primary_key=="__uid__"){return"#"+l.__parent_real__+"#"+l.__index__+"#"+l.__uid__}else{return"#"+l.__parent_real__+"#"+l.__index__+"#"+l[j.primary_key]}};j.setScope=function(n,l){var m=j.getHash(n);if(j.$globals[m]!=l){j.$globals[m]=l}};j.getScope=function(l){return j.$globals[j.getHash(l)]};j.getScopeTree=function(){return j};j.enableMove=function(l){if((typeof l)==="boolean"){j.enabledMove=l}else{j.enabledMove=true}};j.setPositionStatus=function(l){if(j.statusElm){j.statusElm.css({left:l.pageX+10+"px",top:l.pageY+15+"px","z-index":9999});j.statusElm.addClass(j.config.statusClass)}};j.hideStatus=function(){if(j.statusElm){j.statusElm.addClass(j.config.hiddenClass)}};j.refreshStatus=function(){if(j.enabledStatus){var l=j.statusElm;if(j.enabledMove){j.statusElm=angular.element(e.getMove())}else{j.statusElm=angular.element(e.getCopy())}if(l){j.statusElm.attr("class",l.attr("class"));j.statusElm.attr("style",l.attr("style"));l.remove()}j.statusElm.removeClass(j.config.hiddenClass);f.find("body").append(j.statusElm)}};j.initPlace=function(n,p,o){var m=n.prop("tagName").toLowerCase();if(!j.placeElm){if(m.toLowerCase()=="tr"){j.placeElm=angular.element(g.document.createElement("tr"));var l=j.colDefinitions.length;j.placeElm.append(angular.element(g.document.createElement("td")).addClass(j.config.emptyTreeClass).addClass("indented").addClass(j.config.placeHolderClass));while(l-->0){j.placeElm.append(angular.element(g.document.createElement("td")).addClass(j.config.emptyTreeClass).addClass(j.config.placeHolderClass))}}else{j.placeElm=angular.element(g.document.createElement("li")).addClass(j.config.emptyTreeClass).addClass(j.config.placeHolderClass)}}else{j.placeElm.removeClass(j.config.hiddenClass)}if(m.toLowerCase()=="tr"){c.replaceIndent(j,j.placeElm,p)}n[0].parentNode.insertBefore(j.placeElm[0],n[0]);j.placeElm.css("height",c.height(o)+"px");return j.placeElm};j.hidePlace=function(){if(j.placeElm){j.placeElm.addClass(j.config.hiddenClass)}};j.showPlace=function(){if(j.placeElm){j.placeElm.removeClass(j.config.hiddenClass)}}}],link:function(i,j,s){i.$type="TreeTable";i.colDefinitions=[];i.$watch(s.enableStatus,function(n){if((typeof n)==="boolean"){i.enabledStatus=n}},true);i.$watch(s.enableMove,function(n){if((typeof n)==="boolean"){i.enabledMove=n;i.statusMove=n}},true);i.$watch(s.templateCopy,function(A){var n=null;if((typeof A)==="string"&&A.trim().length>0){n=A.trim()}else{n=s.templateCopy;if(n){n=n.trim();if(n.length==0&&!a.get(n)){n=null}}}if(n){if(a.get(n)){e.setCopy(n)}}},true);i.$watch(s.templateMove,function(A){var n=null;if((typeof A)==="string"&&A.trim().length>0){n=A.trim()}else{n=s.templateMove;if(n){n=n.trim();if(n.length==0&&!a.get(n)){n=null}}}if(n){if(a.get(n)){e.setMove(n)}}},true);if(!s.primaryKey){i.primary_key=="__uid__"}else{i.$watch(s.primaryKey,function(n){if(typeof n==="string"){i.primary_key=n}else{i.primary_key=s.primaryKey}},true)}i.$watch(s.callbacks,function(n){angular.forEach(n,function(B,A){if(typeof B==="function"){if(i.$callbacks[A]){i.$callbacks[A]=B}}})},true);if((typeof s["class"])==="string"){i.tree_class=s["class"].trim()}if((typeof s.indentUnit)==="string"){i.indent_unit=s.indentUnit}i.$watch(s.enableHotkey,function(n){if((typeof n)==="boolean"){i.enabledHotkey=n}if(i.enabledHotkey){i.enabledMove=false}else{i.enabledMove=i.statusMove}},true);i.$watch(s.enableDrag,function(n){if((typeof n)==="boolean"){i.dragEnabled=n}},true);i.$watch(s.indent,function(n){if((typeof n)=="number"){i.indent=n}},true);i.$watch(s.indentPlus,function(n){if((typeof n)=="number"){i.indent_plus=n}},true);i.$watch(s.dragDelay,function(n){if((typeof n)=="number"){i.dragDelay=n}});i.config={};angular.extend(i.config,d);i.$watch(s.config,function(n){angular.extend(i.config,n)},true);var p,w,t,q;s.iconExpand=s.iconExpand?s.iconExpand:"icon-plus  glyphicon glyphicon-plus  fa fa-plus";s.iconCollapse=s.iconCollapse?s.iconCollapse:"icon-minus glyphicon glyphicon-minus fa fa-minus";s.iconLeaf=s.iconLeaf?s.iconLeaf:"icon-file  glyphicon glyphicon-file  fa fa-file";s.expandLevel=s.expandLevel?s.expandLevel:"3";w=parseInt(s.expandLevel,10);if(!i.treeData){i.treeData=[]}var z=function(){if(i.treeData.length){var D=i.treeData[0],B=Object.keys(D),C=new RegExp("^__([a-zA-Z0-9_-]*)__$");for(var A=0,n=B.length;A<n;A++){if(typeof(D[B[A]])==="string"&&!C.test(B[A])){p=B[A];break}}if(!p){p=B[0]}i.expandingProperty=p}},v=function(){if(i.treeData.length){var A=[],C=i.treeData[0];var B=new RegExp("(^__([a-zA-Z0-9_-]*)__$|^"+p+"$)");for(var n in C){if(!B.test(n)){A.push({field:n})}}i.colDefinitions=A}};if(s.expandOn){p=i.expandOn||[];i.expandingProperty=i.expandOn||[]}if(s.columnDefs){if(!(angular.isArray(i.columnDefs)&&i.columnDefs.length>0)){v()}else{i.colDefinitions=i.columnDefs}}i.on_user_click=function(n){if(i.onClick){i.onClick({branch:n})}};i.user_clicks_branch=function(n){if(n!==y){return u(n)}};i.tree_rows=[];var y=null,o=function(D){var A,C,n,B;A=function(F,I){D(F,I);if(F.__children__!=null){var H,E,G;G=F.__children__;for(H=0,E=G.length;H<E;H++){A(G[H],I+1)}}};B=i.treeData;for(C=0,n=B.length;C<n;C++){A(B[C],1)}},u=function(n){if(!n){if(y!=null){y.__selected__=false}y=null;return}if(n!==y){if(y!=null){y.__selected__=false}n.__selected__=true;y=n;l(n);if(n.onSelect!=null){return b(function(){return n.onSelect(n)})}else{if(i.onSelect!=null){return b(function(){return i.onSelect({branch:n})})}}}},x=function(n){if(n.__parent_real__!==null&&n.__parent_real__>-1&&n.__parent_real__<i.tree_rows.length){return i.tree_rows[n.__parent_real__]}return null},r=function(B,A){var n;n=x(B);if(n!=null){A(n);return r(n,A)}},l=function(n){return r(n,function(A){return A.__expanded__=true})},h=function(){if(!s.expandOn){z()}if(!s.columnDefs){v()}var F,n;n=i.treeData;F=n.length;var A=[];if(F>0){var B,D;D=function(R,S,N,K,L,O){var M,Q,J;if(!angular.isArray(R.__children__)){R.__children__=[]}R.__parent_real__=N;R.__parent__=S;Q=R.__children__.length;if(R.__expanded__==null&&Q>0){R.__expanded__=K<w}if(Q===0){J=s.iconLeaf}else{if(R.__expanded__){J=s.iconCollapse}else{J=s.iconExpand}}var U=A.length;R.__index__=O;R.__index_real__=U;R.__level__=K;R.__tree_icon__=J;R.__visible__=L;if(R.__uid__==null){R.__uid__=""+Math.random()}A.push(R);var P=1;if(Q>0){for(M=0;M<Q;M++){P+=D(R.__children__[M],(i.primary_key=="__uid__")?R.__uid__:R[i.primary_key],U,K+1,L&&R.__expanded__,M)}}var T;if(i.primary_key=="__uid__"){T="#"+S+"#"+O+"#"+R.__uid__}else{T="#"+S+"#"+O+"#"+R[i.primary_key]}if(R.__hashKey__==null||R.__hashKey__!=T){R.__hashKey__=T;i.$globals[T]=null}R.__dept__=P;return P};var H=0;for(B=0;B<F;B++){H+=D(n[B],null,null,1,true,B)}var G,I,E=Object.keys(i.$globals),C=i.$globals.length;G=C-H;if(G!=0){I=C-G;_min=I-Math.abs(G);for(B=_min;B<I;B++){delete (i.$globals[E[B]])}}}i.tree_rows=A;return i.tree_rows},m=function(n){if(n.keyCode==27){i.hideStatus();i.$$apply=false;i.dragEnd(n)}else{if(i.enabledHotkey&&n.shiftKey){i.enableMove(true);i.refreshStatus()}}},k=function(n){if(i.enabledHotkey&&!n.shiftKey){i.enableMove(false);i.refreshStatus()}};i.$watch("treeData",h,true);h();angular.element(g.document.body).bind("keydown",m);angular.element(g.document.body).bind("keyup",k);i.$on("$destroy",function(){angular.element(g.document.body).unbind("keydown",m);angular.element(g.document.body).unbind("keyup",k);if(i.statusElm){i.statusElm.remove()}if(i.placeElm){i.placeElm.remove()}});if(i.tree!=null){if(angular.isObject(i.tree)){q=i.tree;q.expand_all=function(){o(function(n,A){n.__expanded__=true})};q.collapse_all=function(){o(function(n,A){n.__expanded__=false})};q.get_first_branch=function(){t=i.treeData.length;if(t>0){return i.treeData[0]}return null};q.select_first_branch=function(){var n;n=q.get_first_branch();return q.select_branch(n)};q.get_selected_branch=function(){return y};q.get_parent_branch=function(n){return x(n)};q.select_branch=function(n){u(n);return n};q.get_children=function(n){return n.__children__};q.select_parent_branch=function(n){var A;if(n==null){n=q.get_selected_branch()}if(n!=null){A=q.get_parent_branch(n);if(A!=null){q.select_branch(A);return A}}};q.add_branch=function(A,B,n){if((typeof n)!="number"){if(A!=null){A.__children__.push(B);A.__expanded__=true}else{i.treeData.push(B)}}else{if(A!=null){A.__children__.splice(n,0,B);A.__expanded__=true}else{i.treeData.splice(n,0,B)}}return B};q.add_root_branch=function(n){q.add_branch(null,n);return n};q.remove_branch=function(B){B=B||q.get_selected_branch();if(B){var A;if(B.__parent_real__!==null){A=q.get_parent_branch(B).__children__}else{A=i.treeData}var n=A.indexOf(B);A.splice(n,1);y=null}};q.expand_branch=function(n){if(n==null){n=q.get_selected_branch()}if(n!=null){n.__expanded__=true;return n}};q.collapse_branch=function(n){if(n==null){n=y}if(n!=null){n.__expanded__=false;return n}};q.get_siblings=function(n){var A,B;if(n==null){n=y}if(n!=null){A=q.get_parent_branch(n);if(A){B=A.__children__}else{B=i.treeData}return B}};q.get_next_sibling=function(n){var A,B;if(n==null){n=y}if(n!=null){B=q.get_siblings(n);t=B.length;A=B.indexOf(n);if(A<t){return B[A+1]}}};q.get_prev_sibling=function(n){var A,B;if(n==null){n=y}B=q.get_siblings(n);t=B.length;A=B.indexOf(n);if(A>0){return B[A-1]}};q.select_next_sibling=function(n){var A;if(n==null){n=y}if(n!=null){A=q.get_next_sibling(n);if(A!=null){return q.select_branch(A)}}};q.select_prev_sibling=function(n){var A;if(n==null){n=y}if(n!=null){A=q.get_prev_sibling(n);if(A!=null){return q.select_branch(A)}}};q.get_first_child=function(n){var A;if(n==null){n=y}if(n!=null){if(((A=n.__children__)!=null?A.length:void 0)>0){return n.__children__[0]}}};q.get_closest_ancestor_next_sibling=function(n){var B,A;B=q.get_next_sibling(n);if(B!=null){return B}else{A=q.get_parent_branch(n);return q.get_closest_ancestor_next_sibling(A)}};q.get_next_branch=function(n){var A;if(n==null){n=y}if(n!=null){A=q.get_first_child(n);if(A!=null){return A}else{A=q.get_closest_ancestor_next_sibling(n);return A}}};q.select_next_branch=function(n){var A;if(n==null){n=y}if(n!=null){A=q.get_next_branch(n);if(A!=null){q.select_branch(A);return A}}};q.last_descendant=function(n){var A;if(n==null){}t=n.__children__.length;if(t===0){return n}else{A=n.__children__[t-1];return q.last_descendant(A)}};q.get_prev_branch=function(n){var A,B;if(n==null){n=y}if(n!=null){B=q.get_prev_sibling(n);if(B!=null){return q.last_descendant(B)}else{A=q.get_parent_branch(n);return A}}};q.reload_data=function(){return h()};q.select_prev_branch=function(n){var A;if(n==null){n=y}if(n!=null){A=q.get_prev_branch(n);if(A!=null){q.select_branch(A);return A}}}}}angular.element(j).ready(function(){var P="ontouchstart" in window,V,L,B,G,A,S,D=true,E=false,C=null,J=document.body,K=document.documentElement,M,F,I,R=function(ac){if(!P&&(ac.button==2||ac.which==3)){return}if(ac.uiTreeDragging||(ac.originalEvent&&ac.originalEvent.uiTreeDragging)){return}var af=angular.element(ac.target);var aa=af.scope();if(!aa||!aa.$type){return}if(aa.$type!="TreeTableNode"&&aa.$type!="TreeTableNodeHandle"){return}if(aa.$type!="TreeTableNodeHandle"){return}var Y=af.prop("tagName").toLowerCase(),ae=null;if(Y=="input"||Y=="textarea"||Y=="button"||Y=="select"){return}while(af&&af[0]&&af[0]!=j){if(c.nodrag(af)){return}af=af.parent()}ae=aa.getScopeNode();if(!i.beforeDrag(ae)){return}ac.uiTreeDragging=true;if(ac.originalEvent){ac.originalEvent.uiTreeDragging=true}ac.preventDefault();var ad=c.eventObj(ac);L=true;B=c.dragInfo(ae);var X=ae.$element.prop("tagName").toLowerCase();G=c.positionStarted(ad,ae.$element);if(X==="tr"){S=angular.element(g.document.createElement("table")).addClass(i.config.treeClass).addClass(i.config.dragClass).addClass(i.tree_class)}else{S=angular.element(g.document.createElement("ul")).addClass(i.config.dragClass).addClass("tree-table-rows").addClass(i.tree_class)}S.css({width:c.width(ae.$element)+"px","z-index":9995});i.refreshStatus();i.setPositionStatus(ac);I=0;var Z=c.width(ae.$element);if(X=="tr"){var ab=angular.element(g.document.createElement("tbody"));I=ae.node().__level__-1;var W=function(ak){var ag,ai,al,ah,am,aj;ag=i.getScope(ak);ai=ag.$element;aj=ai.clone();c.replaceIndent(ag,aj,ak.__level__-I,"padding-left");ab.append(aj);if(i.config.hiddenClass){ai.addClass(i.config.hiddenClass)}am=ak.__children__;ah=am.length;for(al=0;al<ah;al++){W(am[al])}};W(ae.node());S.append(ab)}else{S.append(ae.$element.clone());if(i.config.hiddenClass){ae.$element.addClass(i.config.hiddenClass)}}S.css({left:ad.pageX-G.offsetX+i.$callbacks.calsIndent(I+1,true,true)+"px",top:ad.pageY-G.offsetY+"px"});f.find("body").append(S);A=i.initPlace(ae.$element,B.level,S);A.css("width",Z);angular.element(f).bind("touchend",H);angular.element(f).bind("touchcancel",H);angular.element(f).bind("touchmove",O);angular.element(f).bind("mouseup",H);angular.element(f).bind("mousemove",O);angular.element(f).bind("mouseleave",U);M=Math.max(J.scrollHeight,J.offsetHeight,K.clientHeight,K.scrollHeight,K.offsetHeight);F=Math.max(J.scrollWidth,J.offsetWidth,K.clientWidth,K.scrollWidth,K.offsetWidth)},T=function(ao){if(!E){if(!D){E=true;i.$apply(function(){i.$callbacks.dragStart(B)})}return}var W=c.eventObj(ao);var ak,aq,ab;if(S){ao.preventDefault();if(g.getSelection){g.getSelection().removeAllRanges()}else{if(g.document.selection){g.document.selection.empty()}}aq=W.pageX-G.offsetX;ab=W.pageY-G.offsetY;if(aq<0){aq=0}if(ab<0){ab=0}if((ab+10)>M){ab=M-10}if((aq+10)>F){aq=F-10}S.css({left:aq+i.$callbacks.calsIndent(I+1,true,true)+"px",top:ab+"px"});i.setPositionStatus(ao);var Z=window.pageYOffset||g.document.documentElement.scrollTop;var ad=Z+(window.innerHeight||g.document.clientHeight||g.document.clientHeight);if(ad<W.pageY&&ad<=M){window.scrollBy(0,10)}if(Z>W.pageY){window.scrollBy(0,-10)}c.positionMoved(ao,G,L);if(L){L=false;return}var ah=W.pageX-g.document.body.scrollLeft;var ag=W.pageY-(window.pageYOffset||g.document.documentElement.scrollTop);var Y=angular.element(g.document.elementFromPoint(ah,ag)),am=Y.scope(),X=null,af,ac=false;if(am&&angular.isFunction(am.getScopeNode)){am=am.getScopeNode();af=am.getScopeTree();X=am.$element.prop("tagName").toLowerCase();if(B.tree!==af){B.tree.hidePlace();B.tree=af;B.tree.showPlace();ac=true}}if(!G.dirAx||ac){if(!am){return}Y=am.$element;var aa,ap=c.offset(Y);if(X=="tr"){aa=W.pageY<(ap.top+c.height(Y)/2)}else{var ar=c.height(Y)-c.height(am.elementChilds);if(W.pageY>ap.top+ar){return}aa=W.pageY<(ap.top+ar/2)}A=am.initPlace(Y,B.level,S);A.css("width",c.width(Y));if(am.$callbacks.dragEnabled()){if(am.accept(B,aa)){B.level=am.node().__level__;if(aa){var ae;if(B.isDirty(am.getScopeTree(),am.node().__index_real__-1)){ae=am.getPrevGlobal(B.node.__index_real__)}else{ae=am.prev()}B.target=ae;B.scope=am.getScope(ae);if(X=="tr"){c.replaceIndent(am,A,B.level)}Y[0].parentNode.insertBefore(A[0],Y[0])}else{B.target=am.node();B.scope=am;var aj=B.level;if(am.data().__expanded__){B.level=++aj;if(X=="tr"){c.replaceIndent(am,A,aj);Y.after(A)}else{am.elementChilds.prepend(A)}}else{if(X=="tr"){c.replaceIndent(am,A,aj)}Y.after(A)}}}}}else{am=B.scope;X=am.$element.prop("tagName").toLowerCase();if(G.dirAx&&G.distAxX>=am.config.levelThreshold){G.distAxX=0;var ae=B.target;if(ae){if(G.distX>0){var ai=am.visible(ae);if(ai!=null&&ai.__level__>=B.level){B.level++;if(X=="tr"){c.replaceIndent(am,A,B.level)}else{var al=am.getScope(ai);al.elementChilds.append(A)}}}else{if(G.distX<0){var an=B.canIndent();if(an==null||an){B.level=B.level-1;if(X=="tr"){c.replaceIndent(am,A,B.level)}else{var al=am.getScope(an);al.$element.after(A)}}}}}}}i.$apply(function(){i.$callbacks.dragMove(B)})}},N=function(aa){aa.preventDefault();if(S){var X=false;i.$apply(function(){X=i.$callbacks.beforeDrop(B)});var Y=B.drag.$element.prop("tagName").toLowerCase();if(Y=="tr"){var W=function(ae){var ab,ad,af,ac,ag;ab=i.getScope(ae);ad=ab.$element;if(i.config.hiddenClass){ad.removeClass(i.config.hiddenClass)}ag=ae.__children__;ac=ag.length;for(af=0;af<ac;af++){W(ag[af])}};W(B.drag.node())}else{if(i.config.hiddenClass){B.drag.$element.removeClass(i.config.hiddenClass)}}S.remove();S=null;B.tree.hidePlace();i.hideStatus();var Z=false;if(i.$$apply){i.$apply(function(){Z=i.dropped(B,X)})}else{Q()}i.$apply(function(){i.$callbacks.dragStop(B,Z)});i.$$apply=false;B=null}angular.element(f).unbind("touchend",H);angular.element(f).unbind("touchcancel",H);angular.element(f).unbind("touchmove",O);angular.element(f).unbind("mouseup",H);angular.element(f).unbind("mousemove",O);angular.element(g.document.body).unbind("mouseleave",U)},n=function(W){if(i.$callbacks.dragEnabled()){R(W)}},O=function(W){T(W)},H=function(W){i.$$apply=true;i.dragEnd(W)},U=function(W){i.dragEnd(W)},Q=function(){j.bind("touchstart mousedown",function(W){D=true;E=false;n(W);C=b(function(){D=false},i.dragDelay)});j.bind("touchend touchcancel mouseup",function(){b.cancel(C)})};i.dragEnd=function(W){N(W)};Q()})}}}]).directive("treeTableNode",["$window","$document","$timeout","$TreeTableHelper","treeTableTemplate",function(e,d,a,c,b){return{restrict:"A",replace:true,controller:["$scope","$element","$attrs","tgConfig",function(h,g,f,i){h.$modelValue=null;h.$scopeChildren=null;h.elementChilds=null;h.childNodesCount=function(){return h.childNodes().length};h.childNodes=function(){return h.$modelValue.__children__};h.expand=function(j){if(j.__children__.length>0){j.__expanded__=!j.__expanded__}};h.prev=function(){return h.getPrevGlobal(h.$modelValue.__index_real__)};h.next=function(){return h.getNextGlobal(h.$modelValue.__index_real__)};h.node=function(){return h.$modelValue};h.data=function(){return h.$modelValue};h.visible=function(j){if(j!=null){return j.__visible__?j:h.visible(h.tree_rows[j.__parent_real__])}return null};h.setElementChilds=function(j){h.elementChilds=j};h.getScopeNode=function(){return h}}],link:function(h,g,f){h.$element=g;h.$type="TreeTableNode";if(h.config.nodeClass){g.addClass(h.config.nodeClass)}h.$watch(f.treeTableNode,function(i){h.setScope(i,h);h.$modelValue=i},true)}}}]).directive("treeTableNodes",function(){return{restrict:"A",replace:true,controller:["$scope","$element","$attrs","tgConfig",function(c,b,a,d){c.datas=[]}],link:function(c,b,a){c.$type="TreeTableNodes";c.$element=b;if(c.setElementChilds){c.setElementChilds(b)}c.$watch(a.treeTableNodes,function(f,d,e){e.datas=f},true);c.$element=b}}}).directive("treeTableNodeHandle",function(){return{restrict:"A",scope:true,controller:["$scope","$element","$attrs","tgConfig",function(c,b,a,d){}],link:function(c,b,a){c.$element=b;c.$type="TreeTableNodeHandle";if(c.config.handleClass){b.addClass(c.config.handleClass)}}}}).factory("treeTableTemplate",["$templateCache",function(a){var c="template/treeTable/treeTable.html";var b="template/treeTable/treeTableStatusCopy.html";var d="template/treeTable/treeTableStatusMove.html";return{setMove:function(e){d=e},setCopy:function(e){b=e},getPath:function(){return c},getCopy:function(){var e=a.get(b);if(e){return e}return a.get("template/treeTable/treeTableStatusCopy.html")},getMove:function(){var e=a.get(d);if(e){return e}return a.get("template/treeTable/treeTableStatusMove.html")}}}]).factory("$TreeTableHelper",["$document","$window",function(b,a){return{calsIndent:null,isUndefinedOrNull:function(c){return angular.isUndefined(c)||c===null},nodrag:function(c){return(typeof c.attr("data-nodrag"))!="undefined"},eventObj:function(d){var c=d;if(d.targetTouches!==undefined){c=d.targetTouches.item(0)}else{if(d.originalEvent!==undefined&&d.originalEvent.targetTouches!==undefined){c=d.originalEvent.targetTouches.item(0)}}return c},dragInfo:function(c){return{node:c.node(),level:c.node().__level__,target:c.prev(),scope:c,drag:c,tree:c.getScopeTree(),move:{parent:-1,pos:-1},isDirty:function(e,d){return(this.tree==e)&&this.node.__index_real__<=d&&d<=this.node.__index_real__+this.node.__dept__-1},canIndent:function(){if(this.level==1){return false}var d=this.target;var e=d;while(d){if(d.__level__<this.level){if(d.__expanded__){if(d.__children__.length==0){return d}else{if((d.__index_real__==this.target.__parent_real__&&d.__children__.length-1==this.target.__index__)||(d.__index_real__==e.__parent_real__&&d.__children__.length-1==e.__index__)||(d.__index_real__==this.node.__parent_real__&&d.__children__.length-1==this.node.__index__)){return d}}return false}return d}else{if(d.__parent_real__==null){return null}else{e=d;d=this.scope.tree_rows[d.__parent_real__]}}}return false},canInsert:function(d){if(d.__children__.length==0){return true}else{if((d.__index_real__==this.target.__parent_real__&&d.__children__.length-1==this.target.__index__)||(d.__index_real__==this.node.__parent_real__&&d.__children__.length-1==this.node.__index__)){return d}}return false}}},height:function(c){return c.prop("scrollHeight")},width:function(c){return c.prop("scrollWidth")},offset:function(c){var d=c[0].getBoundingClientRect();return{width:c.prop("offsetWidth"),height:c.prop("offsetHeight"),top:d.top+(a.pageYOffset||b[0].body.scrollTop||b[0].documentElement.scrollTop),left:d.left+(a.pageXOffset||b[0].body.scrollLeft||b[0].documentElement.scrollLeft)}},positionStarted:function(d,c){var f={};f.offsetX=d.pageX-this.offset(c).left;f.offsetY=d.pageY-this.offset(c).top;f.startX=f.lastX=d.pageX;f.startY=f.lastY=d.pageY;f.nowX=f.nowY=f.distX=f.distY=f.dirAx=0;f.dirX=f.dirY=f.lastDirX=f.lastDirY=f.distAxX=f.distAxY=0;return f},positionMoved:function(f,g,d){g.lastX=g.nowX;g.lastY=g.nowY;g.nowX=f.pageX;g.nowY=f.pageY;g.distX=g.nowX-g.lastX;g.distY=g.nowY-g.lastY;g.lastDirX=g.dirX;g.lastDirY=g.dirY;g.dirX=g.distX===0?0:g.distX>0?1:-1;g.dirY=g.distY===0?0:g.distY>0?1:-1;var c=Math.abs(g.distX)>Math.abs(g.distY)?1:0;if(d){g.dirAx=c;g.moving=true;return}if(g.dirAx!==c){g.distAxX=0;g.distAxY=0}else{g.distAxX+=Math.abs(g.distX);if(g.dirX!==0&&g.dirX!==g.lastDirX){g.distAxX=0}g.distAxY+=Math.abs(g.distY);if(g.dirY!==0&&g.dirY!==g.lastDirY){g.distAxY=0}}g.dirAx=c},replaceIndent:function(f,e,d,c){c=c?c:"left";angular.element(e.children()[0]).css(c,f.$callbacks.calsIndent(d))}}}]).factory("$TreeTableConvert",function(){return{line2tree:function(d,j,h){if(!d||d.length==0||!j||!h){return[]}var m=[],a=[],k=d[0],b=k[j],l={},e,g,f=d.length,c=0;while(c<f){k=d[c++];b=k[j];l[b]=k;e=k[h];if(e){g=l[e];if(g.__children__){g.__children__.push(k)}else{g.__children__=[k]}}else{a.push(b)}}f=a.length;for(c=0;c<f;c++){m.push(l[a[c]])}return m},tree2tree:function(c,a){var b=function(g){var i=[];var f,d=g.length,h,e;for(f=0;f<d;f++){h=angular.copy(g[f]);if(angular.isArray(h[a])&&h[a].length>0){e=b(h[a]);delete (h[a]);h.__children__=e}i.push(h)}return i};return b(c)}}}).constant("tgConfig",{treeClass:"tree-table",emptyTreeClass:"tree-table-empty",hiddenClass:"tree-table-hidden",nodeClass:"tree-table-row",nodesClas:"tree-table-rows",handleClass:"tree-table-handle",placeHolderClass:"tree-table-placeholder",dragClass:"tree-table-drag",statusClass:"tree-table-status",levelThreshold:30})}).call(window);