(function(){angular.module("template/treeTable/treeTable.html",[]).run(["$templateCache",function(a){a.put("template/treeTable/treeTable.html",'<table ng-class="tree_class">\n    <thead>\n  <tr>\n     <th ng-class="expandingProperty.titleClass" ng-style="expandingProperty.titleStyle">\n         {{expandingProperty.displayName || expandingProperty.field || expandingProperty}}\n        </th>\n        <th ng-repeat="col in colDefinitions" ng-class="col.titleClass" ng-style="col.titleStyle">\n         {{col.displayName || col.field}}\n     </th>\n    </tr>\n    </thead>\n <tbody>\n  <tr tree-table-node="row" ng-repeat="row in tree_rows track by row.__hashKey__ " ng-show="row.__visible__"\n     ng-class="(row.__selected__ ? \' active\':\'\')">\n        <td ng-if="!expandingProperty.template" tree-table-node-handle\n         ng-style="expandingProperty.cellStyle ? expandingProperty.cellStyle : {\'padding-left\': $callbacks.calsIndent(row.__level__)}"\n          ng-click="user_clicks_branch(row)" ng-class="expandingProperty.cellClass"\n            compile="expandingProperty.cellTemplate">\n              <a data-nodrag>\n                  <i ng-class="row.__tree_icon__" ng-click="row.__expanded__ = !row.__expanded__"\n                     class="tree-icon"></i>\n              </a>\n             {{row[expandingProperty.field] || row[expandingProperty]}}\n       </td>\n        <td ng-if="expandingProperty.template" compile="expandingProperty.template"></td>\n        <td ng-repeat="col in colDefinitions" ng-class="col.cellClass" ng-style="col.cellStyle"\n            compile="col.cellTemplate">\n            {{row[col.field]}}\n       </td>\n    </tr>\n    </tbody>\n</table>');a.put("template/treeTable/treeTableStatusCopy.html",'<label><i class="fa fa-copy"></i>&nbsp;<b>Copying</b></label>');a.put("template/treeTable/treeTableStatusMove.html",'<label><i class="fa fa-file-text"></i>&nbsp;<b>Moving</b></label>')}]);angular.module("treeTable",["template/treeTable/treeTable.html"]).directive("compile",["$compile",function(a){return{restrict:"A",link:function(d,c,b){d.$watch(b.compile,function(e){if(e!=null){var f=a(e);var g=f(d);c.empty().append(g)}})}}}]).directive("treeTable",["$timeout","$window","treeTableTemplate","tgConfig","$TreeTableHelper","$templateCache",function(b,f,e,d,c,a){return{restrict:"E",replace:true,scope:{treeData:"=",columnDefs:"=",expandOn:"=",onSelect:"&",onClick:"&",treeControl:"=",tree:"=treeControl",tree_data:"=treeData",callbacks:"=",primaryKey:"="},templateUrl:function(g,h){return h.templateUrl||e.getPath()},controller:["$scope","$element","$attrs","tgConfig",function(i,h,g,j){i.dragEnabled=true;i.dragDelay=0;i.indent=20;i.indent_plus=15;i.indent_unit="px";i.tree_class="table";i.primary_key="__uid__";i.enabledMove=true;i.statusMove=true;i.enabledStatus=false;i.enabledHotkey=false;i.$globals={};i.$dragging=null;i.$callbacks={accept:function(l,k){return true},beforeDrag:function(k){return true},dragStart:function(k){},dragMove:function(k){},dragStop:function(k,l){},beforeDrop:function(k){return true},calsIndent:function(o,n,m){var l=i.indent_unit?i.indent_unit:"px";var k=(m)?0:i.indent_plus;if(!n){l=i.indent_unit?i.indent_unit:"px"}else{l=0}if(o-1<1){return k+l}else{return(i.indent*(o-1))+k+l}},dragEnabled:function(){return i.dragEnabled}};i.setDragging=function(k){if(k){i.$dragging=k}else{i.$dragging=null}};i.dropped=function(o,q){var t=o.node,k=o.target,m=o.scope;var l=null;var r=null;var s=0;if(t.__parent_real__===null){l=i.treeData;r=null}else{r=i.tree_rows[t.__parent_real__];l=r.__children__}var p=l;if(k!==null){if(k.__level__==o.level){if(t.__parent_real__!==k.__parent_real__){if(k.__parent_real__===null){p=i.treeData;r=null}else{r=i.tree_rows[k.__parent_real__];p=r.__children__}}s=k.__index__+1}else{if(k.__level__<o.level){p=k.__children__;r=k}else{while(k.__level__>o.level){if(k.__parent_real__!==null){k=i.tree_rows[k.__parent_real__]}else{break}}if(k.__parent_real__===null){p=i.treeData;r=null}else{r=i.tree_rows[k.__parent_real__];p=r.__children__}s=k.__index__+1}}}else{p=i.treeData;r=null}if(p!=l||t.__index__!=s){if(p===l){if(s>t.__index__){s--}}if(q==true){var n=l.splice(t.__index__,1)[0];p.splice(s,0,n)}o.move={parent:r,pos:s};return true}return false};i.accept=function(l,k){return i.$callbacks.accept(l,k)};i.beforeDrag=function(k){return i.$callbacks.beforeDrag(k)};i.safeApply=function(l){var k=this.$root.$$phase;if(k=="$apply"||k=="$digest"){if(l&&(typeof(l)==="function")){l()}}else{this.$apply(l)}};i.getPrevGlobal=function(k){if(k>0){return i.tree_rows[k-1]}return null};i.getNextGlobal=function(k){if(k>0){return i.tree_rows[k-1]}return null};i.getHash=function(k){if(i.primary_key=="__uid__"){return k.__parent__+"#"+k.__index__+"#"+k.__uid__+"#"+k.__children__.length}else{return k.__parent__+"#"+k.__index__+"#"+k[i.primary_key]+"#"+k.__children__.length}};i.setScope=function(m,k){var l=i.getHash(m);if(i.$globals[l]!=k){i.$globals[l]=k}};i.getScope=function(k){return i.$globals[i.getHash(k)]};i.getScopeTree=function(){return i};i.enableMove=function(k){if((typeof k)==="boolean"){i.enabledMove=k}else{i.enabledMove=true}}}],link:function(h,j,u){h.$type="TreeTable";h.$typeTree="table";h.$watch(u.enableStatus,function(i){if((typeof i)==="boolean"){h.enabledStatus=i}},true);h.$watch(u.enableMove,function(i){if((typeof i)==="boolean"){h.enabledMove=i;h.statusMove=i}},true);h.$watch(u.templateCopy,function(n){var i=null;if((typeof n)==="string"&&n.trim().length>0){i=n.trim()}else{i=u.templateCopy;if(i){i=i.trim();if(i.length==0&&!a.get(i)){i=null}}}if(i){if(a.get(i)){e.setCopy(i)}}},true);h.$watch(u.templateMove,function(n){var i=null;if((typeof n)==="string"&&n.trim().length>0){i=n.trim()}else{i=u.templateMove;if(i){i=i.trim();if(i.length==0&&!a.get(i)){i=null}}}if(i){if(a.get(i)){e.setMove(i)}}},true);c.calsIndent=h.$callbacks.calsIndent;h.$watch(u.primaryKey,function(i){if(typeof i==="string"){h.primary_key=i}},true);h.$watch(u.typeTree,function(i){if(typeof i==="string"){h.$typeTree=i}},true);h.$watch(u.callbacks,function(i){angular.forEach(i,function(C,n){if(typeof C==="function"){if(h.$callbacks[n]){h.$callbacks[n]=C}}});c.calsIndent=h.$callbacks.calsIndent},true);if((typeof u["class"])==="string"){h.tree_class=u["class"].trim()}if((typeof u.indentUnit)==="string"){h.indent_unit=u.indentUnit}h.$watch(u.enableHotkey,function(i){if((typeof i)==="boolean"){h.enabledHotkey=i}if(h.enabledHotkey){h.enabledMove=false}else{h.enabledMove=h.statusMove}},true);h.$watch(u.enableDrag,function(i){if((typeof i)==="boolean"){h.dragEnabled=i}},true);h.$watch(u.indent,function(i){if((typeof i)=="number"){h.indent=i}},true);h.$watch(u.indentPlus,function(i){if((typeof i)=="number"){h.indent_plus=i}},true);h.$watch(u.dragDelay,function(i){if((typeof i)=="number"){h.dragDelay=i}});h.config={};angular.extend(h.config,d);h.$watch(u.config,function(i){angular.extend(h.config,i)},true);var r,z,v,s;u.iconExpand=u.iconExpand?u.iconExpand:"icon-plus  glyphicon glyphicon-plus  fa fa-plus";u.iconCollapse=u.iconCollapse?u.iconCollapse:"icon-minus glyphicon glyphicon-minus fa fa-minus";u.iconLeaf=u.iconLeaf?u.iconLeaf:"icon-file  glyphicon glyphicon-file  fa fa-file";u.expandLevel=u.expandLevel?u.expandLevel:"3";z=parseInt(u.expandLevel,10);if(!h.treeData){h.treeData=[]}if(u.expandOn){r=h.expandOn;h.expandingProperty=h.expandOn}else{if(h.treeData.length){var m=h.treeData[0],k=Object.keys(m);for(var w=0,x=k.length;w<x;w++){if(typeof(m[k[w]])==="string"){r=k[w];break}}if(!r){r=k[0]}h.expandingProperty=r}}h.colDefinitions=h.columnDefs||[];var q=function(E){var n,D,i,C;n=function(G,J){E(G,J);if(G.__children__!=null){var I,F,H;H=G.__children__;for(I=0,F=H.length;I<F;I++){n(H[I],J+1)}}};C=h.treeData;for(D=0,i=C.length;D<i;D++){n(C[D],1)}};var B=null;var y=function(i){if(!i){if(B!=null){B.__selected__=false}B=null;return}if(i!==B){if(B!=null){B.__selected__=false}i.__selected__=true;B=i;o(i);if(i.onSelect!=null){return b(function(){return i.onSelect(i)})}else{if(h.onSelect!=null){return b(function(){return h.onSelect({branch:i})})}}}};h.on_user_click=function(i){if(h.onClick){h.onClick({branch:i})}};h.user_clicks_branch=function(i){if(i!==B){return y(i)}};var A=function(i){if(i.__parent_real__!==null&&i.__parent_real__>-1&&i.__parent_real__<h.tree_rows.length){return h.tree_rows[i.__parent_real__]}return null};var t=function(C,n){var i;i=A(C);if(i!=null){n(i);return t(i,n)}};var o=function(i){return t(i,function(n){return n.__expanded__=true})};h.tree_rows=[];var g=function(){var F,i;i=h.treeData;F=i.length;var n=[];if(F>0){var C,D;D=function(R,S,N,K,L,O){var M,Q,J;if(!angular.isArray(R.__children__)){R.__children__=[]}R.__parent_real__=N;R.__parent__=S;Q=R.__children__.length;if(R.__expanded__==null&&Q>0){R.__expanded__=K<z}if(Q===0){J=u.iconLeaf}else{if(R.__expanded__){J=u.iconCollapse}else{J=u.iconExpand}}var U=n.length;R.__index__=O;R.__index_real__=U;R.__level__=K;R.__tree_icon__=J;R.__visible__=L;if(R.__uid__==null){R.__uid__=""+Math.random()}n.push(R);var P=1;if(Q>0){for(M=0;M<Q;M++){P+=D(R.__children__[M],(h.primary_key=="__uid__")?R.__uid__:R[h.primary_key],U,K+1,L&&R.__expanded__,M)}}var T;if(h.primary_key=="__uid__"){T=S+"#"+O+"#"+R.__uid__}else{T=S+"#"+O+"#"+R[h.primary_key]}if(R.__hashKey__==null||R.__hashKey__!=T){R.__hashKey__=T;h.$globals[T]=null}R.__dept__=P;return P};var H=0;for(C=0;C<F;C++){H+=D(i[C],null,null,1,true,C)}F=h.$globals;var G,I,E=Object.keys(h.$globals);G=x-H;if(G!=0){I=x-G;_min=I-Math.abs(G);for(C=_min;C<I;C++){delete (h.$globals[E[C]])}}}h.tree_rows=n;return h.tree_rows};h.$watch("treeData",g,true);g();if(h.treeControl!=null){if(angular.isObject(h.treeControl)){s=h.treeControl;s.expand_all=function(){q(function(i,n){i.__expanded__=true})};s.collapse_all=function(){q(function(i,n){i.__expanded__=false})};s.get_first_branch=function(){v=h.treeData.length;if(v>0){return h.treeData[0]}return null};s.select_first_branch=function(){var i;i=s.get_first_branch();return s.select_branch(i)};s.get_selected_branch=function(){return B};s.get_parent_branch=function(i){return A(i)};s.select_branch=function(i){y(i);return i};s.get_children=function(i){return i.__children__};s.select_parent_branch=function(i){var n;if(i==null){i=s.get_selected_branch()}if(i!=null){n=s.get_parent_branch(i);if(n!=null){s.select_branch(n);return n}}};s.add_branch=function(n,C,i){if((typeof i)!="number"){if(n!=null){n.__children__.push(C);n.__expanded__=true}else{h.treeData.push(C)}}else{if(n!=null){n.__children__.splice(i,0,C);n.__expanded__=true}else{h.treeData.splice(i,0,C)}}return C};s.add_root_branch=function(i){s.add_branch(null,i);return i};s.remove_branch=function(C){C=C||s.get_selected_branch();if(C){var n;if(C.__parent_real__!==null){n=s.get_parent_branch(C).__children__}else{n=h.treeData}var i=n.indexOf(C);n.splice(i,1);B=null}};s.expand_branch=function(i){if(i==null){i=s.get_selected_branch()}if(i!=null){i.__expanded__=true;return i}};s.collapse_branch=function(i){if(i==null){i=B}if(i!=null){i.__expanded__=false;return i}};s.get_siblings=function(i){var n,C;if(i==null){i=B}if(i!=null){n=s.get_parent_branch(i);if(n){C=n.__children__}else{C=h.treeData}return C}};s.get_next_sibling=function(n){var C,D;if(n==null){n=B}if(n!=null){D=s.get_siblings(n);v=D.length;C=D.indexOf(n);if(C<v){return D[C+1]}}};s.get_prev_sibling=function(n){var C,D;if(n==null){n=B}D=s.get_siblings(n);v=D.length;C=D.indexOf(n);if(C>0){return D[C-1]}};s.select_next_sibling=function(i){var n;if(i==null){i=B}if(i!=null){n=s.get_next_sibling(i);if(n!=null){return s.select_branch(n)}}};s.select_prev_sibling=function(i){var n;if(i==null){i=B}if(i!=null){n=s.get_prev_sibling(i);if(n!=null){return s.select_branch(n)}}};s.get_first_child=function(i){var n;if(i==null){i=B}if(i!=null){if(((n=i.__children__)!=null?n.length:void 0)>0){return i.__children__[0]}}};s.get_closest_ancestor_next_sibling=function(i){var C,n;C=s.get_next_sibling(i);if(C!=null){return C}else{n=s.get_parent_branch(i);return s.get_closest_ancestor_next_sibling(n)}};s.get_next_branch=function(i){var n;if(i==null){i=B}if(i!=null){n=s.get_first_child(i);if(n!=null){return n}else{n=s.get_closest_ancestor_next_sibling(i);return n}}};s.select_next_branch=function(i){var n;if(i==null){i=B}if(i!=null){n=s.get_next_branch(i);if(n!=null){s.select_branch(n);return n}}};s.last_descendant=function(i){var n;if(i==null){}v=i.__children__.length;if(v===0){return i}else{n=i.__children__[v-1];return s.last_descendant(n)}};s.get_prev_branch=function(i){var n,C;if(i==null){i=B}if(i!=null){C=s.get_prev_sibling(i);if(C!=null){return s.last_descendant(C)}else{n=s.get_parent_branch(i);return n}}};s.reload_data=function(){return g()};s.select_prev_branch=function(i){var n;if(i==null){i=B}if(i!=null){n=s.get_prev_branch(i);if(n!=null){s.select_branch(n);return n}}}}}var p=function(i){if(h.$dragging){if(i.keyCode==27){h.$dragging.$$apply=false;h.$dragging.dragEnd(i)}if(h.enabledHotkey){h.enableMove(i.shiftKey);h.$dragging.refreshStatus()}}};var l=function(i){if(h.$dragging&&h.enabledHotkey){h.enableMove(i.shiftKey);h.$dragging.refreshStatus()}};angular.element(f.document.body).bind("keydown",p);angular.element(f.document.body).bind("keyup",l);h.$on("$destroy",function(){angular.element(f.document.body).unbind("keydown",p);angular.element(f.document.body).unbind("keyup",l)})}}}]).directive("treeTableNode",["$window","$document","$timeout","$TreeTableHelper","treeTableTemplate",function(e,d,a,c,b){return{restrict:"A",replace:true,controller:["$scope","$element","$attrs","tgConfig",function(h,g,f,i){h.$modelValue=null;h.$nodeScope=h;h.$scopeChildren=null;h.childNodesCount=function(){return h.childNodes().length};h.childNodes=function(){return h.$modelValue.__children__};h.safeApply=function(k){var j=this.$root.$$phase;if(j=="$apply"||j=="$digest"){if(k&&(typeof(k)==="function")){k()}}else{this.$apply(k)}};h.expand=function(j){if(j.__children__.length>0){j.__expanded__=!j.__expanded__}};h.prev=function(){return h.getPrevGlobal(h.$modelValue.__index_real__)};h.next=function(){return h.getNextGlobal(h.$modelValue.__index_real__)};h.node=function(){return h.$modelValue};h.data=function(){return h.$modelValue};h.visible=function(j){if(j!=null){return j.__visible__?j:h.visible(h.tree_rows[j.__parent_real__])}return null};h.elementChilds=null;h.setElementChilds=function(j){h.elementChilds=j}}],link:function(i,k,v){i.$element=k;i.$type="TreeTableNode";if(i.config.nodeClass){k.addClass(i.config.nodeClass)}i.$watch(v.treeTableNode,function(H,F,G){G.setScope(H,G);G.$modelValue=H},true);var y="ontouchstart" in window,E,t,h,o,g,C,u,l=true,m=false,j=null,r=document.body,s=document.documentElement,w,n,q;var B=function(L){if(!y&&(L.button==2||L.which==3)){return}if(L.uiTreeDragging||(L.originalEvent&&L.originalEvent.uiTreeDragging)){return}var O=angular.element(L.target);var J=O.scope();if(!J||!J.$type){return}if(J.$type!="TreeTableNode"&&J.$type!="TreeTableNodeHandle"){return}if(J.$type!="TreeTableNodeHandle"){return}var H=O.prop("tagName").toLowerCase();if(H=="input"||H=="textarea"||H=="button"||H=="select"){return}while(O&&O[0]&&O[0]!=k){if(c.nodrag(O)){return}O=O.parent()}if(!i.beforeDrag(i)){return}L.uiTreeDragging=true;if(L.originalEvent){L.originalEvent.uiTreeDragging=true}L.preventDefault();i.setDragging(i);var M=c.eventObj(L);t=true;h=c.dragInfo(i);var G=i.$element.prop("tagName").toLowerCase();if(G.toLowerCase()=="tr"){g=angular.element(e.document.createElement("tr"));var N=i.colDefinitions.length;g.append(angular.element(e.document.createElement("td")).addClass(i.config.emptyTreeClass).addClass("indented").addClass(i.config.placeHolderClass));while(N-->0){g.append(angular.element(e.document.createElement("td")).addClass(i.config.emptyTreeClass).addClass(i.config.placeHolderClass))}c.replaceIndent(g,h.level)}else{g=angular.element(e.document.createElement("li")).addClass(i.config.emptyTreeClass).addClass(i.config.placeHolderClass)}o=c.positionStarted(M,i.$element);g.css("width",c.width(i.$element)+"px");if(G==="tr"){C=angular.element(e.document.createElement("table")).addClass(i.config.treeClass).addClass(i.config.dragClass).addClass(i.tree_class)}else{C=angular.element(e.document.createElement("ul")).addClass(i.config.dragClass).addClass("tree-table-rows").addClass(i.tree_class)}C.css({width:c.width(i.$element)+"px","z-index":9995});i.refreshStatus();if(u){u.css({left:L.pageX+10+"px",top:L.pageY+15+"px","z-index":9999});u.addClass(i.config.statusClass)}var I=0;q=0;if(G=="tr"){var K=angular.element(e.document.createElement("tbody"));q=i.node().__level__-1;var F=function(T){var P,R,U,Q,V,S;P=i.getScope(T);R=P.$element;I+=c.height(R);S=R.clone();c.replaceIndent(S,T.__level__-q,"padding-left");K.append(S);if(i.config.hiddenClass){R.addClass(i.config.hiddenClass)}V=T.__children__;Q=V.length;for(U=0;U<Q;U++){F(V[U])}};F(i.node());C.append(K)}else{I=c.height(i.$element);C.append(i.$element.clone());if(i.config.hiddenClass){i.$element.addClass(i.config.hiddenClass)}}g.css("height",I+"px");C.css({left:M.pageX-o.offsetX+c.calsIndent(q+1,true,true)+"px",top:M.pageY-o.offsetY+"px"});i.$element[0].parentNode.insertBefore(g[0],i.$element[0]);d.find("body").append(C);angular.element(d).bind("touchend",p);angular.element(d).bind("touchcancel",p);angular.element(d).bind("touchmove",x);angular.element(d).bind("mouseup",p);angular.element(d).bind("mousemove",x);angular.element(d).bind("mouseleave",D);w=Math.max(r.scrollHeight,r.offsetHeight,s.clientHeight,s.scrollHeight,s.offsetHeight);n=Math.max(r.scrollWidth,r.offsetWidth,s.clientWidth,s.scrollWidth,s.offsetWidth)};var A=function(W){if(!m){if(!l){m=true;i.$apply(function(){i.$callbacks.dragStart(h)})}return}var G=c.eventObj(W);var R,Y,L;if(C){W.preventDefault();if(e.getSelection){e.getSelection().removeAllRanges()}else{if(e.document.selection){e.document.selection.empty()}}Y=G.pageX-o.offsetX;L=G.pageY-o.offsetY;if(Y<0){Y=0}if(L<0){L=0}if((L+10)>w){L=w-10}if((Y+10)>n){Y=n-10}C.css({left:Y+c.calsIndent(q+1,true,true)+"px",top:L+"px"});if(u){u.css({left:W.pageX+10+"px",top:W.pageY+15+"px"})}var J=window.pageYOffset||e.document.documentElement.scrollTop;var M=J+(window.innerHeight||e.document.clientHeight||e.document.clientHeight);if(M<G.pageY&&M<=w){window.scrollBy(0,10)}if(J>G.pageY){window.scrollBy(0,-10)}c.positionMoved(W,o,t);if(t){t=false;return}var F=(c.offset(C).left-c.offset(g).left)>=i.config.levelThreshold;var P=G.pageX-e.document.body.scrollLeft;var O=G.pageY-(window.pageYOffset||e.document.documentElement.scrollTop);e.document.elementFromPoint(P,O);var I=angular.element(e.document.elementFromPoint(P,O));var H=i.$element.prop("tagName").toLowerCase();if(!o.dirAx){var K,U;U=I.scope();if(!U){return}if(U.$type=="TreeTable"&&U.$callbacks.dragEnabled()){return}if(U.$type=="TreeTableNodeHandle"){U=I.scope().$nodeScope}if(U.$type!="TreeTableNode"){return}I=U.$element;var X=c.offset(I);if(H=="tr"){K=G.pageY<(X.top+c.height(I)/2)}else{var Z=c.height(I)-c.height(U.elementChilds);if(G.pageY>X.top+Z){return}K=G.pageY<(X.top+Z/2)}if(U.$callbacks.dragEnabled()){if(U.accept(h,K)){h.level=U.node().__level__;if(K){if(h.isDirty(U.node().__index_real__-1)){h.target=U.getPrevGlobal(h.node.__index_real__)}else{h.target=U.prev()}if(H=="tr"){c.replaceIndent(g,h.level)}I[0].parentNode.insertBefore(g[0],I[0])}else{h.target=U.node();h.targetScope=U;var S=h.level;if(U.data().__expanded__){S++;h.level=S;if(H=="tr"){c.replaceIndent(g,S);I.after(g)}else{U.elementChilds.prepend(g)}}else{if(H=="tr"){c.replaceIndent(g,S)}I.after(g)}}h.scope=U}}}else{var U=h.scope;if(o.dirAx&&o.distAxX>=U.config.levelThreshold){o.distAxX=0;var N=h.target;if(N){if(o.distX>0){var Q=U.visible(N);if(Q!=null&&Q.__level__>=h.level){h.level++;if(H=="tr"){c.replaceIndent(g,h.level)}else{var T=U.getScope(Q);T.elementChilds.append(g)}}}else{if(o.distX<0){var V=h.canIndent();if(V==null||V){h.level=h.level-1;if(H=="tr"){c.replaceIndent(g,h.level)}else{var T=U.getScope(V);T.$element.after(g)}}}}}}}i.$apply(function(){i.$callbacks.dragMove(h)})}};i.dragEnd=function(J){J.preventDefault();if(C){i.setDragging();var G=false;i.$apply(function(){G=i.$callbacks.beforeDrop(h)});var H=i.$element.prop("tagName").toLowerCase();if(H=="tr"){var F=function(N){var K,M,O,L,P;K=i.getScope(N);M=K.$element;if(i.config.hiddenClass){M.removeClass(i.config.hiddenClass)}P=N.__children__;L=P.length;for(O=0;O<L;O++){F(P[O])}};F(i.node())}else{if(i.config.hiddenClass){i.$element.removeClass(i.config.hiddenClass)}}g.remove();C.remove();if(u){u.remove()}C=null;u=null;var I=false;if(i.$$apply){i.$apply(function(){I=i.dropped(h,G)})}else{z()}i.$apply(function(){i.$callbacks.dragStop(h,I)});i.$$apply=false;h=null}angular.element(d).unbind("touchend",p);angular.element(d).unbind("touchcancel",p);angular.element(d).unbind("touchmove",x);angular.element(d).unbind("mouseup",p);angular.element(d).unbind("mousemove",x);angular.element(e.document.body).unbind("mouseleave",D)};var f=function(F){if(i.$callbacks.dragEnabled()){B(F)}};var x=function(F){A(F)};var p=function(F){i.$$apply=true;i.dragEnd(F)};var D=function(F){i.dragEnd(F)};var z=function(){k.bind("touchstart mousedown",function(F){l=true;m=false;f(F);j=a(function(){l=false},i.dragDelay)});k.bind("touchend touchcancel mouseup",function(){a.cancel(j)})};i.refreshStatus=function(){if(i.enabledStatus){var F=u;if(i.enabledMove){u=angular.element(b.getMove())}else{u=angular.element(b.getCopy())}if(F){u.attr("class",F.attr("class"));u.attr("style",F.attr("style"));F.remove()}d.find("body").append(u)}};z()}}}]).directive("treeTableNodes",function(){return{restrict:"A",replace:true,controller:["$scope","$element","$attrs","tgConfig",function(c,b,a,d){c.$nodeScope=null;c.datas=[]}],link:function(c,b,a){c.$type="TreeTableNodes";c.$element=b;if(c.setElementChilds){c.setElementChilds(b)}c.$watch(a.treeTableNodes,function(f,d,e){e.datas=f},true);c.$nodeScope=c;c.$element=b}}}).directive("treeTableNodeHandle",function(){return{restrict:"A",scope:true,controller:["$scope","$element","$attrs","tgConfig",function(c,b,a,d){c.$nodeScope=null}],link:function(c,b,a){c.$element=b;c.$type="TreeTableNodeHandle";if(c.$parent.$type=="TreeTableNode"){c.$nodeScope=c.$parent}else{c.$nodeScope=c}if(c.config.handleClass){b.addClass(c.config.handleClass)}}}}).factory("treeTableTemplate",["$templateCache",function(a){var c="template/treeTable/treeTable.html";var b="template/treeTable/treeTableStatusCopy.html";var d="template/treeTable/treeTableStatusMove.html";return{setMove:function(e){d=e},setCopy:function(e){b=e},getPath:function(){return c},getCopy:function(){var e=a.get(b);if(e){return e}return a.get("template/treeTable/treeTableStatusCopy.html")},getMove:function(){var e=a.get(d);if(e){return e}return a.get("template/treeTable/treeTableStatusMove.html")}}}]).factory("$TreeTableHelper",["$document","$window",function(b,a){return{calsIndent:null,isUndefinedOrNull:function(c){return angular.isUndefined(c)||c===null},nodrag:function(c){return(typeof c.attr("data-nodrag"))!="undefined"},eventObj:function(d){var c=d;if(d.targetTouches!==undefined){c=d.targetTouches.item(0)}else{if(d.originalEvent!==undefined&&d.originalEvent.targetTouches!==undefined){c=d.originalEvent.targetTouches.item(0)}}return c},dragInfo:function(c){return{node:c.node(),level:c.node().__level__,target:c.prev(),scope:c,move:{parent:-1,pos:-1},isDirty:function(d){return this.node.__index_real__<=d&&d<=this.node.__index_real__+this.node.__dept__-1},canIndent:function(){if(this.level==1){return false}var d=this.target;var e=d;while(d){if(d.__level__<this.level){if(d.__expanded__){if(d.__children__.length==0){return d}else{if((d.__index_real__==this.target.__parent_real__&&d.__children__.length-1==this.target.__index__)||(d.__index_real__==e.__parent_real__&&d.__children__.length-1==e.__index__)||(d.__index_real__==this.node.__parent_real__&&d.__children__.length-1==this.node.__index__)){return d}}return false}return d}else{if(d.__parent_real__==null){return null}else{e=d;d=this.scope.tree_rows[d.__parent_real__]}}}return false},canInsert:function(d){if(d.__children__.length==0){return true}else{if((d.__index_real__==this.target.__parent_real__&&d.__children__.length-1==this.target.__index__)||(d.__index_real__==this.node.__parent_real__&&d.__children__.length-1==this.node.__index__)){return d}}return false}}},height:function(c){return c.prop("scrollHeight")},width:function(c){return c.prop("scrollWidth")},offset:function(c){var d=c[0].getBoundingClientRect();return{width:c.prop("offsetWidth"),height:c.prop("offsetHeight"),top:d.top+(a.pageYOffset||b[0].body.scrollTop||b[0].documentElement.scrollTop),left:d.left+(a.pageXOffset||b[0].body.scrollLeft||b[0].documentElement.scrollLeft)}},positionStarted:function(d,c){var f={};f.offsetX=d.pageX-this.offset(c).left;f.offsetY=d.pageY-this.offset(c).top;f.startX=f.lastX=d.pageX;f.startY=f.lastY=d.pageY;f.nowX=f.nowY=f.distX=f.distY=f.dirAx=0;f.dirX=f.dirY=f.lastDirX=f.lastDirY=f.distAxX=f.distAxY=0;return f},positionMoved:function(f,g,d){g.lastX=g.nowX;g.lastY=g.nowY;g.nowX=f.pageX;g.nowY=f.pageY;g.distX=g.nowX-g.lastX;g.distY=g.nowY-g.lastY;g.lastDirX=g.dirX;g.lastDirY=g.dirY;g.dirX=g.distX===0?0:g.distX>0?1:-1;g.dirY=g.distY===0?0:g.distY>0?1:-1;var c=Math.abs(g.distX)>Math.abs(g.distY)?1:0;if(d){g.dirAx=c;g.moving=true;return}if(g.dirAx!==c){g.distAxX=0;g.distAxY=0}else{g.distAxX+=Math.abs(g.distX);if(g.dirX!==0&&g.dirX!==g.lastDirX){g.distAxX=0}g.distAxY+=Math.abs(g.distY);if(g.dirY!==0&&g.dirY!==g.lastDirY){g.distAxY=0}}g.dirAx=c},replaceIndent:function(f,d,c){c=c?c:"left";angular.element(f.children()[0]).css(c,this.calsIndent(d))},hidden:function(c){if(angular.isFunction(c.hide)){c.hide()}else{displayElm=c[0].style.display;c[0].style.display="none"}}}}]).factory("$TreeTableConvert",function(){return{line2tree:function(d,j,h){if(!d||d.length==0||!j||!h){return[]}var m=[],a=[],k=d[0],b=k[j],l={},e,g,f=d.length,c=0;while(c<f){k=d[c++];b=k[j];l[b]=k;e=k[h];if(e){g=l[e];if(g.__children__){g.__children__.push(k)}else{g.__children__=[k]}}else{a.push(b)}}f=a.length;for(c=0;c<f;c++){m.push(l[a[c]])}return m},tree2tree:function(c,a){var b=function(g){var i=[];var f,d=g.length,h,e;for(f=0;f<d;f++){h=angular.copy(g[f]);if(angular.isArray(h[a])&&h[a].length>0){e=b(h[a]);delete (h[a]);h.__children__=e}i.push(h)}return i};return b(c)}}}).constant("tgConfig",{treeClass:"tree-table",emptyTreeClass:"tree-table-empty",hiddenClass:"tree-table-hidden",nodeClass:"tree-table-row",nodesClas:"tree-table-rows",handleClass:"tree-table-handle",placeHolderClass:"tree-table-placeholder",dragClass:"tree-table-drag",statusClass:"tree-table-status",levelThreshold:30})}).call(window);