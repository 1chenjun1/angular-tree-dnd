<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
<<<<<<< HEAD
(function(){angular.module("template/treeTable/treeTable.html",[]).run(["$templateCache",function(a){a.put("template/treeTable/treeTable.html",'<table ng-class="tree_class">\n    <thead>\n  <tr>\n     <th ng-class="expandingProperty.titleClass" ng-style="expandingProperty.titleStyle">\n         {{expandingProperty.displayName || expandingProperty.field || expandingProperty}}\n        </th>\n        <th ng-repeat="col in colDefinitions" ng-class="col.titleClass" ng-style="col.titleStyle">\n         {{col.displayName || col.field}}\n     </th>\n    </tr>\n    </thead>\n <tbody>\n  <tr tree-table-node="row" ng-repeat="row in tree_rows track by row.__hashKey__ " ng-show="row.__visible__"\n     ng-class="(row.__selected__ ? \' active\':\'\')">\n        <td ng-if="!expandingProperty.template" tree-table-node-handle\n         ng-style="expandingProperty.cellStyle ? expandingProperty.cellStyle : {\'padding-left\': $callbacks.calsIndent(row.__level__)}"\n          ng-click="user_clicks_branch(row)" ng-class="expandingProperty.cellClass"\n            compile="expandingProperty.cellTemplate">\n              <a data-nodrag>\n                  <i ng-class="row.__tree_icon__" ng-click="row.__expanded__ = !row.__expanded__"\n                     class="tree-icon"></i>\n              </a>\n             {{row[expandingProperty.field] || row[expandingProperty]}}\n       </td>\n        <td ng-if="expandingProperty.template" compile="expandingProperty.template"></td>\n        <td ng-repeat="col in colDefinitions" ng-class="col.cellClass" ng-style="col.cellStyle"\n            compile="col.cellTemplate">\n            {{row[col.field]}}\n       </td>\n    </tr>\n    </tbody>\n</table>')}]);angular.module("treeTable",["template/treeTable/treeTable.html"]).directive("compile",["$compile",function(a){return{restrict:"A",link:function(d,c,b){d.$watch(b.compile,function(e){if(e!=null){var f=a(e);var g=f(d);c.empty().append(g)}})}}}]).directive("treeTable",["$timeout","$window","treeTableTemplate","tgConfig","$TreeTableHelper",function(a,e,d,c,b){return{restrict:"E",replace:true,scope:{treeData:"=",columnDefs:"=",expandOn:"=",onSelect:"&",onClick:"&",treeControl:"=",tree:"=treeControl",tree_data:"=treeData",callbacks:"=",primaryKey:"="},templateUrl:function(f,g){return g.templateUrl||d.getPath()},controller:["$scope","$element","$attrs","tgConfig",function(h,g,f,i){h.dragEnabled=true;h.dragDelay=0;h.indent=20;h.indent_plus=15;h.indent_unit="px";h.tree_class="table";h.primary_key="__uid__";h.$callbacks={accept:function(k,j){return true},beforeDrag:function(j){return true},dragStart:function(j){},dragMove:function(j){},dragStop:function(j,k){},beforeDrop:function(j){return true},calsIndent:function(l,k){var j=h.indent_unit?h.indent_unit:"px";if(!k){j=h.indent_unit?h.indent_unit:"px"}else{j=""}if(l-1<1){return h.indent_plus+j}else{return(h.indent*(l-1))+h.indent_plus+j}},dragEnabled:function(){return h.dragEnabled}};h.dropped=function(m,o){if(o){var r=m.node,j=m.target;var k=null;var p=null;var q=0;if(r.__parent_real__===null){k=h.treeData;p=null}else{p=h.tree_rows[r.__parent_real__];k=p.__children__}var n=k;if(j!==null){if(j.__level__==m.level){if(r.__parent_real__!==j.__parent_real__){if(j.__parent_real__===null){n=h.treeData;p=null}else{p=h.tree_rows[j.__parent_real__];n=p.__children__}}q=j.__index__+1}else{if(j.__level__<m.level){n=j.__children__;p=j}else{while(j.__level__>m.level){if(j.__parent_real__!==null){j=h.tree_rows[j.__parent_real__]}else{break}}if(j.__parent_real__===null){n=h.treeData;p=null}else{p=h.tree_rows[j.__parent_real__];n=p.__children__}q=j.__index__+1}}}else{n=h.treeData;p=null}if(n!=k||r.__index__!=q){if(n===k){if(q>r.__index__){q--}}var l=k.splice(r.__index__,1)[0];n.splice(q,0,l);m.move={parent:p,pos:q};return true}}return false};h.$globals={};h.accept=function(k,j){return h.$callbacks.accept(k,j)};h.beforeDrag=function(j){return h.$callbacks.beforeDrag(j)};h.safeApply=function(k){var j=this.$root.$$phase;if(j=="$apply"||j=="$digest"){if(k&&(typeof(k)==="function")){k()}}else{this.$apply(k)}};h.getPrevGlobal=function(j){if(j>0){return h.tree_rows[j-1]}return null};h.getNextGlobal=function(j){if(j>0){return h.tree_rows[j-1]}return null};h.getHash=function(j){if(h.primary_key=="__uid__"){return j.__parent__+"#"+j.__index__+"#"+j.__uid__+"#"+j.__children__.length}else{return j.__parent__+"#"+j.__index__+"#"+j[h.primary_key]+"#"+j.__children__.length}};h.setScope=function(l,j){var k=h.getHash(l);if(h.$globals[k]!=j){h.$globals[k]=j}};h.getScope=function(j){return h.$globals[h.getHash(j)]}}],link:function(g,h,r){g.$type="TreeTable";g.$typeTree="table";b.calsIndent=g.$callbacks.calsIndent;g.$watch(r.primaryKey,function(i){if(typeof i==="string"){g.primary_key=i}},true);g.$watch(r.typeTree,function(i){if(typeof i==="string"){g.$typeTree=i}},true);g.$watch(r.callbacks,function(i){angular.forEach(i,function(z,n){if(typeof z==="function"){if(g.$callbacks[n]){g.$callbacks[n]=z}}});b.calsIndent=g.$callbacks.calsIndent},true);if(angular.isString(r["class"])){g.tree_class=r["class"].trim()}if(angular.isString(r.indentUnit)){g.indent_unit=r.indentUnit}g.$watch(r.dragEnabled,function(i){if((typeof i)=="boolean"){g.dragEnabled=i}});g.$watch(r.indent,function(i){if((typeof i)=="number"){g.indent=i}});g.$watch(r.indentPlus,function(i){if((typeof i)=="number"){g.indent_plus=i}});g.$watch(r.dragDelay,function(i){if((typeof i)=="number"){g.dragDelay=i}});g.config={};angular.extend(g.config,c);g.$watch(r.config,function(i){angular.extend(g.config,i)},true);var o,w,s,p;r.iconExpand=r.iconExpand?r.iconExpand:"icon-plus  glyphicon glyphicon-plus  fa fa-plus";r.iconCollapse=r.iconCollapse?r.iconCollapse:"icon-minus glyphicon glyphicon-minus fa fa-minus";r.iconLeaf=r.iconLeaf?r.iconLeaf:"icon-file  glyphicon glyphicon-file  fa fa-file";r.expandLevel=r.expandLevel?r.expandLevel:"3";w=parseInt(r.expandLevel,10);if(!g.treeData){g.treeData=[]}if(r.expandOn){o=g.expandOn;g.expandingProperty=g.expandOn}else{if(g.treeData.length){var k=g.treeData[0],j=Object.keys(k);for(var t=0,u=j.length;t<u;t++){if(typeof(k[j[t]])==="string"){o=j[t];break}}if(!o){o=j[0]}g.expandingProperty=o}}g.colDefinitions=g.columnDefs||[];var m=function(B){var n,A,i,z;n=function(D,G){B(D,G);if(D.__children__!=null){var F,C,E;E=D.__children__;for(F=0,C=E.length;F<C;F++){n(E[F],G+1)}}};z=g.treeData;for(A=0,i=z.length;A<i;A++){n(z[A],1)}};var y=null;var v=function(i){if(!i){if(y!=null){y.__selected__=false}y=null;return}if(i!==y){if(y!=null){y.__selected__=false}i.__selected__=true;y=i;l(i);if(i.onSelect!=null){return a(function(){return i.onSelect(i)})}else{if(g.onSelect!=null){return a(function(){return g.onSelect({branch:i})})}}}};g.on_user_click=function(i){if(g.onClick){g.onClick({branch:i})}};g.user_clicks_branch=function(i){if(i!==y){return v(i)}};var x=function(i){if(i.__parent_real__!==null&&i.__parent_real__>-1&&i.__parent_real__<g.tree_rows.length){return g.tree_rows[i.__parent_real__]}return null};var q=function(z,n){var i;i=x(z);if(i!=null){n(i);return q(i,n)}};var l=function(i){return q(i,function(n){return n.__expanded__=true})};g.tree_rows=[];var f=function(){var C,i;i=g.treeData;C=i.length;var n=[];if(C>0){var z,A;A=function(O,P,K,H,I,L){var J,N,G;if(!angular.isArray(O.__children__)){O.__children__=[]}O.__parent_real__=K;O.__parent__=P;N=O.__children__.length;if(O.__expanded__==null&&N>0){O.__expanded__=H<w}if(N===0){G=r.iconLeaf}else{if(O.__expanded__){G=r.iconCollapse}else{G=r.iconExpand}}var R=n.length;O.__index__=L;O.__index_real__=R;O.__level__=H;O.__tree_icon__=G;O.__visible__=I;if(O.__uid__==null){O.__uid__=""+Math.random()}n.push(O);var M=1;if(N>0){for(J=0;J<N;J++){M+=A(O.__children__[J],(g.primary_key=="__uid__")?O.__uid__:O[g.primary_key],R,H+1,I&&O.__expanded__,J)}}var Q;if(g.primary_key=="__uid__"){Q=P+"#"+L+"#"+O.__uid__+"#"+N}else{Q=P+"#"+L+"#"+O[g.primary_key]+"#"+N}if(O.__hashKey__==null||O.__hashKey__!=Q){O.__hashKey__=Q;g.$globals[Q]=null}O.__dept__=M;return M};var E=0;for(z=0;z<C;z++){E+=A(i[z],null,null,1,true,z)}C=g.$globals;var D,F,B=Object.keys(g.$globals);D=u-E;if(D!=0){F=u-D;_min=F-Math.abs(D);for(z=_min;z<F;z++){delete (g.$globals[B[z]])}}}g.tree_rows=n;return g.tree_rows};g.$watch("treeData",f,true);f();if(g.treeControl!=null){if(angular.isObject(g.treeControl)){p=g.treeControl;p.expand_all=function(){m(function(i,n){i.__expanded__=true})};p.collapse_all=function(){m(function(i,n){i.__expanded__=false})};p.get_first_branch=function(){s=g.treeData.length;if(s>0){return g.treeData[0]}return null};p.select_first_branch=function(){var i;i=p.get_first_branch();return p.select_branch(i)};p.get_selected_branch=function(){return y};p.get_parent_branch=function(i){return x(i)};p.select_branch=function(i){v(i);return i};p.get_children=function(i){return i.__children__};p.select_parent_branch=function(i){var n;if(i==null){i=p.get_selected_branch()}if(i!=null){n=p.get_parent_branch(i);if(n!=null){p.select_branch(n);return n}}};p.add_branch=function(n,z,i){if((typeof i)!="number"){if(n!=null){n.__children__.push(z);n.__expanded__=true}else{g.treeData.push(z)}}else{if(n!=null){n.__children__.splice(i,0,z);n.__expanded__=true}else{g.treeData.splice(i,0,z)}}return z};p.add_root_branch=function(i){p.add_branch(null,i);return i};p.remove_branch=function(z){z=z||p.get_selected_branch();if(z){var n;if(z.__parent_real__!==null){n=p.get_parent_branch(z).__children__}else{n=g.treeData}var i=n.indexOf(z);n.splice(i,1);y=null}};p.expand_branch=function(i){if(i==null){i=p.get_selected_branch()}if(i!=null){i.__expanded__=true;return i}};p.collapse_branch=function(i){if(i==null){i=y}if(i!=null){i.__expanded__=false;return i}};p.get_siblings=function(i){var n,z;if(i==null){i=y}if(i!=null){n=p.get_parent_branch(i);if(n){z=n.__children__}else{z=g.treeData}return z}};p.get_next_sibling=function(n){var z,A;if(n==null){n=y}if(n!=null){A=p.get_siblings(n);s=A.length;z=A.indexOf(n);if(z<s){return A[z+1]}}};p.get_prev_sibling=function(n){var z,A;if(n==null){n=y}A=p.get_siblings(n);s=A.length;z=A.indexOf(n);if(z>0){return A[z-1]}};p.select_next_sibling=function(i){var n;if(i==null){i=y}if(i!=null){n=p.get_next_sibling(i);if(n!=null){return p.select_branch(n)}}};p.select_prev_sibling=function(i){var n;if(i==null){i=y}if(i!=null){n=p.get_prev_sibling(i);if(n!=null){return p.select_branch(n)}}};p.get_first_child=function(i){var n;if(i==null){i=y}if(i!=null){if(((n=i.__children__)!=null?n.length:void 0)>0){return i.__children__[0]}}};p.get_closest_ancestor_next_sibling=function(i){var z,n;z=p.get_next_sibling(i);if(z!=null){return z}else{n=p.get_parent_branch(i);return p.get_closest_ancestor_next_sibling(n)}};p.get_next_branch=function(i){var n;if(i==null){i=y}if(i!=null){n=p.get_first_child(i);if(n!=null){return n}else{n=p.get_closest_ancestor_next_sibling(i);return n}}};p.select_next_branch=function(i){var n;if(i==null){i=y}if(i!=null){n=p.get_next_branch(i);if(n!=null){p.select_branch(n);return n}}};p.last_descendant=function(i){var n;if(i==null){}s=i.__children__.length;if(s===0){return i}else{n=i.__children__[s-1];return p.last_descendant(n)}};p.get_prev_branch=function(i){var n,z;if(i==null){i=y}if(i!=null){z=p.get_prev_sibling(i);if(z!=null){return p.last_descendant(z)}else{n=p.get_parent_branch(i);return n}}};p.reload_data=function(){return f()};p.select_prev_branch=function(i){var n;if(i==null){i=y}if(i!=null){n=p.get_prev_branch(i);if(n!=null){p.select_branch(n);return n}}}}}}}}]).directive("treeTableNode",["$window","$document","$timeout","$TreeTableHelper",function(d,c,a,b){return{restrict:"A",replace:true,controller:["$scope","$element","$attrs","tgConfig",function(g,f,e,h){g.$modelValue=null;g.$nodeScope=g;g.$scopeChildren=null;g.childNodesCount=function(){return g.childNodes().length};g.childNodes=function(){return g.$modelValue.__children__};g.safeApply=function(j){var i=this.$root.$$phase;if(i=="$apply"||i=="$digest"){if(j&&(typeof(j)==="function")){j()}}else{this.$apply(j)}};g.expand=function(i){if(i.__children__.length>0){i.__expanded__=!i.__expanded__}};g.prev=function(){return g.getPrevGlobal(g.$modelValue.__index_real__)};g.next=function(){return g.getNextGlobal(g.$modelValue.__index_real__)};g.node=function(){return g.$modelValue};g.data=function(){return g.$modelValue};g.visible=function(i){if(i!=null){return i.__visible__?i:g.visible(g.tree_rows[i.__parent_real__])}return null};g.elementChilds=null;g.setElementChilds=function(i){g.elementChilds=i}}],link:function(h,j,t){h.$element=j;h.$type="TreeTableNode";if(h.config.nodeClass){j.addClass(h.config.nodeClass)}h.$watch(t.treeTableNode,function(G,E,F){F.setScope(G,F);F.$modelValue=G},true);var x="ontouchstart" in window;var D,s,g,n;var f,B;var k=true;var l=false;var i=null;var q=document.body,r=document.documentElement,u,m;var A=function(K){if(!x&&(K.button==2||K.which==3)){return}if(K.uiTreeDragging||(K.originalEvent&&K.originalEvent.uiTreeDragging)){return}var N=angular.element(K.target);var I=N.scope();if(!I||!I.$type){return}if(I.$type!="TreeTableNode"&&I.$type!="TreeTableNodeHandle"){return}if(I.$type!="TreeTableNodeHandle"){return}var G=N.prop("tagName").toLowerCase();if(G=="input"||G=="textarea"||G=="button"||G=="select"){return}while(N&&N[0]&&N[0]!=j){if(b.nodrag(N)){return}N=N.parent()}if(!h.beforeDrag(h)){return}K.uiTreeDragging=true;if(K.originalEvent){K.originalEvent.uiTreeDragging=true}K.preventDefault();var L=b.eventObj(K);s=true;g=b.dragInfo(h);var F=h.$element.prop("tagName").toLowerCase();if(F.toLowerCase()=="tr"){f=angular.element(d.document.createElement("tr"));var M=h.colDefinitions.length,H;f.append(angular.element(d.document.createElement("td")).addClass(h.config.emptyTreeClass).addClass("indented").addClass(h.config.placeHolderClass));while(M-->0){f.append(angular.element(d.document.createElement("td")).addClass(h.config.emptyTreeClass).addClass(h.config.placeHolderClass))}b.replaceIndent(f,g.level)}else{f=angular.element(d.document.createElement("li")).addClass(h.config.emptyTreeClass).addClass(h.config.placeHolderClass)}n=b.positionStarted(L,h.$element);f.css("width",b.width(h.$element)+"px");if(F==="tr"){B=angular.element(d.document.createElement("table")).addClass(h.config.tree_class+" table "+h.config.dragClass)}else{B=angular.element(d.document.createElement("ul")).addClass(h.config.dragClass+" tree-table-rows")}B.css("width",(b.width(h.$element)+10)+"px");B.css("z-index",9999);var O=0;if(F=="tr"){var J=angular.element(d.document.createElement("tbody"));var E=function(Q,P){var R;for(R=0;R<P;R++){O=O+b.height(Q);J.append(Q.clone());if(h.config.hiddenClass){Q.addClass(h.config.hiddenClass)}Q=Q.next()}};E(h.$element,h.node().__dept__);B.append(J)}else{O=b.height(h.$element);B.append(h.$element.clone());if(h.config.hiddenClass){h.$element.addClass(h.config.hiddenClass)}}f.css("height",O+"px");h.$element[0].parentNode.insertBefore(f[0],h.$element[0]);c.find("body").append(B);B.css({left:L.pageX-n.offsetX+"px",top:L.pageY-n.offsetY+"px"});angular.element(c).bind("touchend",p);angular.element(c).bind("touchcancel",p);angular.element(c).bind("touchmove",w);angular.element(c).bind("mouseup",p);angular.element(c).bind("mousemove",w);angular.element(c).bind("mouseleave",C);u=Math.max(q.scrollHeight,q.offsetHeight,r.clientHeight,r.scrollHeight,r.offsetHeight);m=Math.max(q.scrollWidth,q.offsetWidth,r.clientWidth,r.scrollWidth,r.offsetWidth)};var z=function(W){if(!l){if(!k){l=true;h.$apply(function(){h.$callbacks.dragStart(g)})}return}var F=b.eventObj(W);var T,Y,L;if(B){W.preventDefault();if(d.getSelection){d.getSelection().removeAllRanges()}else{if(d.document.selection){d.document.selection.empty()}}Y=F.pageX-n.offsetX;L=F.pageY-n.offsetY;if(Y<0){Y=0}if(L<0){L=0}if((L+10)>u){L=u-10}if((Y+10)>m){Y=m-10}B.css({left:Y+"px",top:L+"px"});var I=window.pageYOffset||d.document.documentElement.scrollTop;var M=I+(window.innerHeight||d.document.clientHeight||d.document.clientHeight);if(M<F.pageY&&M<=u){window.scrollBy(0,10)}if(I>F.pageY){window.scrollBy(0,-10)}b.positionMoved(W,n,s);if(s){s=false;return}var E=(b.offset(B).left-b.offset(f).left)>=h.config.threshold;var Q=F.pageX-d.document.body.scrollLeft;var P=F.pageY-(window.pageYOffset||d.document.documentElement.scrollTop);var N;if(angular.isFunction(B.hide)){B.hide()}else{N=B[0].style.display;B[0].style.display="none"}d.document.elementFromPoint(Q,P);var H=angular.element(d.document.elementFromPoint(Q,P));if(angular.isFunction(B.show)){B.show()}else{B[0].style.display=N}var G=h.$element.prop("tagName").toLowerCase();if(!n.dirAx){var K,J;J=H.scope();if(!J){return}if(J.$type=="TreeTable"&&J.$callbacks.dragEnabled()){return}if(J.$type=="TreeTableNodeHandle"){J=H.scope().$nodeScope}if(J.$type!="TreeTableNode"){return}H=J.$element;var X=b.offset(H);if(G=="tr"){K=F.pageY<(X.top+b.height(H)/2)}else{var Z=b.height(H)-b.height(J.elementChilds);if(F.pageY>X.top+Z){return}K=F.pageY<(X.top+Z/2)}if(J.$callbacks.dragEnabled()){if(J.accept(g,K)){g.level=J.node().__level__;if(K){if(g.isDirty(J.node().__index_real__-1)){g.target=J.getPrevGlobal(g.node.__index_real__)}else{g.target=J.prev()}if(G=="tr"){b.replaceIndent(f,g.level)}H[0].parentNode.insertBefore(f[0],H[0])}else{g.target=J.node();var S=g.level;if(J.data().__expanded__){S++;g.level=S;if(G=="tr"){b.replaceIndent(f,S);H.after(f)}else{J.elementChilds.prepend(f)}}else{if(G=="tr"){b.replaceIndent(f,S)}H.after(f)}}g.scope=J}}}else{var J=g.scope;if(n.dirAx&&n.distAxX>=J.config.levelThreshold){n.distAxX=0;var O=g.target;if(O){if(n.distX>0){var R=J.visible(O);if(R!=null&&R.__level__>=g.level){g.level++;if(G=="tr"){b.replaceIndent(f,g.level)}else{var U=J.getScope(R);U.elementChilds.append(f)}}}else{if(n.distX<0){var V=g.canIndent();if(V==null||V){g.level=g.level-1;if(G=="tr"){b.replaceIndent(f,g.level)}else{var U=J.getScope(V);U.$element.after(f)}}}}}}}h.$apply(function(){h.$callbacks.dragMove(g)})}};var v=function(I){I.preventDefault();if(B){var F=false;h.$apply(function(){F=h.$callbacks.beforeDrop(g)});var G=h.$element.prop("tagName").toLowerCase();if(G=="tr"){var E=function(K,J){var L;for(L=0;L<J;L++){if(h.config.hiddenClass){K.removeClass(h.config.hiddenClass)}K=K.next()}};E(h.$element,h.node().__dept__)}else{if(h.config.hiddenClass){h.$element.removeClass(h.config.hiddenClass)}}f.remove();B.remove();B=null;var H=false;if(h.$$apply){h.$apply(function(){H=h.dropped(g,F)})}else{y()}h.$apply(function(){h.$callbacks.dragStop(g,H)});h.$$apply=false;g=null}angular.element(c).unbind("touchend",p);angular.element(c).unbind("touchcancel",p);angular.element(c).unbind("touchmove",w);angular.element(c).unbind("mouseup",p);angular.element(c).unbind("mousemove",w);angular.element(d.document.body).unbind("mouseleave",C)};var e=function(E){if(h.$callbacks.dragEnabled()){A(E)}};var w=function(E){z(E)};var p=function(E){h.$$apply=true;v(E)};var C=function(E){v(E)};var y=function(){j.bind("touchstart mousedown",function(E){k=true;l=false;e(E);i=a(function(){k=false},h.dragDelay)});j.bind("touchend touchcancel mouseup",function(){a.cancel(i)})};y();var o=function(E){if(E.keyCode==27){h.$$apply=false;v(E)}};angular.element(d.document.body).bind("keydown",o);h.$on("$destroy",function(){angular.element(d.document.body).unbind("keydown",o)})}}}]).directive("treeTableNodes",function(){return{restrict:"A",replace:true,controller:["$scope","$element","$attrs","tgConfig",function(c,b,a,d){c.$nodeScope=null;c.datas=[]}],link:function(c,b,a){c.$type="TreeTableNodes";c.$element=b;if(c.setElementChilds){c.setElementChilds(b)}c.$watch(a.treeTableNodes,function(f,d,e){e.datas=f},true);c.$nodeScope=c;c.$element=b}}}).directive("treeTableNodeHandle",function(){return{restrict:"A",scope:true,controller:["$scope","$element","$attrs","tgConfig",function(c,b,a,d){c.$nodeScope=null}],link:function(c,b,a){c.$element=b;c.$type="TreeTableNodeHandle";if(c.$parent.$type=="TreeTableNode"){c.$nodeScope=c.$parent}else{c.$nodeScope=c}if(c.config.handleClass){b.addClass(c.config.handleClass)}}}}).provider("treeTableTemplate",function(){var a="template/treeTable/treeTable.html";this.setPath=function(b){a=b};this.$get=function(){return{getPath:function(){return a}}}}).factory("$TreeTableHelper",["$document","$window",function(b,a){return{calsIndent:null,isUndefinedOrNull:function(c){return angular.isUndefined(c)||c===null},nodrag:function(c){return(typeof c.attr("data-nodrag"))!="undefined"},eventObj:function(d){var c=d;if(d.targetTouches!==undefined){c=d.targetTouches.item(0)}else{if(d.originalEvent!==undefined&&d.originalEvent.targetTouches!==undefined){c=d.originalEvent.targetTouches.item(0)}}return c},dragInfo:function(c){return{node:c.node(),level:c.node().__level__,target:c.prev(),scope:c,move:{parent:-1,pos:-1},isDirty:function(d){return this.node.__index_real__<=d&&d<=this.node.__index_real__+this.node.__dept__-1},canIndent:function(){if(this.level==1){return false}var d=this.target;var e=d;while(d){if(d.__level__<this.level){if(d.__expanded__){if(d.__children__.length==0){return d}else{if((d.__index_real__==this.target.__parent_real__&&d.__children__.length-1==this.target.__index__)||(d.__index_real__==e.__parent_real__&&d.__children__.length-1==e.__index__)||(d.__index_real__==this.node.__parent_real__&&d.__children__.length-1==this.node.__index__)){return d}}return false}return d}else{if(d.__parent_real__==null){return null}else{e=d;d=this.scope.tree_rows[d.__parent_real__]}}}return false},canInsert:function(d){if(d.__children__.length==0){return true}else{if((d.__index_real__==this.target.__parent_real__&&d.__children__.length-1==this.target.__index__)||(d.__index_real__==this.node.__parent_real__&&d.__children__.length-1==this.node.__index__)){return d}}return false}}},height:function(c){return c.prop("scrollHeight")},width:function(c){return c.prop("scrollWidth")},offset:function(c){var d=c[0].getBoundingClientRect();return{width:c.prop("offsetWidth"),height:c.prop("offsetHeight"),top:d.top+(a.pageYOffset||b[0].body.scrollTop||b[0].documentElement.scrollTop),left:d.left+(a.pageXOffset||b[0].body.scrollLeft||b[0].documentElement.scrollLeft)}},positionStarted:function(d,c){var f={};f.offsetX=d.pageX-this.offset(c).left;f.offsetY=d.pageY-this.offset(c).top;f.startX=f.lastX=d.pageX;f.startY=f.lastY=d.pageY;f.nowX=f.nowY=f.distX=f.distY=f.dirAx=0;f.dirX=f.dirY=f.lastDirX=f.lastDirY=f.distAxX=f.distAxY=0;return f},positionMoved:function(f,g,d){g.lastX=g.nowX;g.lastY=g.nowY;g.nowX=f.pageX;g.nowY=f.pageY;g.distX=g.nowX-g.lastX;g.distY=g.nowY-g.lastY;g.lastDirX=g.dirX;g.lastDirY=g.dirY;g.dirX=g.distX===0?0:g.distX>0?1:-1;g.dirY=g.distY===0?0:g.distY>0?1:-1;var c=Math.abs(g.distX)>Math.abs(g.distY)?1:0;if(d){g.dirAx=c;g.moving=true;return}if(g.dirAx!==c){g.distAxX=0;g.distAxY=0}else{g.distAxX+=Math.abs(g.distX);if(g.dirX!==0&&g.dirX!==g.lastDirX){g.distAxX=0}g.distAxY+=Math.abs(g.distY);if(g.dirY!==0&&g.dirY!==g.lastDirY){g.distAxY=0}}g.dirAx=c},replaceIndent:function(f,d,c){c=c?c:"left";angular.element(f.children()[0]).css(c,this.calsIndent(d))},hidden:function(c){if(angular.isFunction(c.hide)){c.hide()}else{displayElm=c[0].style.display;c[0].style.display="none"}}}}]).factory("$TreeTableConvert",function(){return{line2tree:function(d,j,h){if(!d||d.length==0||!j||!h){return[]}var m=[],a=[],k=d[0],b=k[j],l={},e,g,f=d.length,c=0;while(c<f){k=d[c++];b=k[j];l[b]=k;e=k[h];if(e){g=l[e];if(g.__children__){g.__children__.push(k)}else{g.__children__=[k]}}else{a.push(b)}}f=a.length;for(c=0;c<f;c++){m.push(l[a[c]])}return m},tree2tree:function(c,a){var b=function(g){var i=[];var f,d=g.length,h,e;for(f=0;f<d;f++){h=angular.copy(g[f]);if(angular.isArray(h[a])&&h[a].length>0){e=b(h[a]);delete (h[a]);h.__children__=e}i.push(h)}return i};return b(c)}}}).constant("tgConfig",{treeClass:"tree-table",emptyTreeClass:"tree-table-empty",hiddenClass:"tree-table-hidden",nodeClass:"tree-table-row",nodesClas:"tree-table-rows",handleClass:"tree-table-handle",placeHolderClass:"tree-table-placeholder",dragClass:"tree-table-drag",levelThreshold:30})}).call(window);
=======
(function(){angular.module("template/treeTable/treeTable.html",[]).run(["$templateCache",function(a){a.put("template/treeTable/treeTable.html",'<table ng-class="tree_class">\n    <thead>\n  <tr>\n     <th ng-class="expandingProperty.titleClass" ng-style="expandingProperty.titleStyle">\n         {{expandingProperty.displayName || expandingProperty.field || expandingProperty}}\n        </th>\n        <th ng-repeat="col in colDefinitions" ng-class="col.titleClass" ng-style="col.titleStyle">\n         {{col.displayName || col.field}}\n     </th>\n    </tr>\n    </thead>\n <tbody>\n  <tr tree-table-node="row" ng-repeat="row in tree_rows track by row.__hashKey__ " ng-show="row.__visible__"\n     ng-class="(row.__selected__ ? \' active\':\'\')">\n        <td ng-if="!expandingProperty.template" tree-table-node-handle\n         ng-style="expandingProperty.cellStyle ? expandingProperty.cellStyle : {\'padding-left\': $callbacks.calsIndent(row.__level__)}"\n          ng-click="user_clicks_branch(row)" ng-class="expandingProperty.cellClass"\n            compile="expandingProperty.cellTemplate">\n              <a data-nodrag>\n                  <i ng-class="row.__tree_icon__" ng-click="row.__expanded__ = !row.__expanded__"\n                     class="tree-icon"></i>\n              </a>\n             {{row[expandingProperty.field] || row[expandingProperty]}}\n       </td>\n        <td ng-if="expandingProperty.template" compile="expandingProperty.template"></td>\n        <td ng-repeat="col in colDefinitions" ng-class="col.cellClass" ng-style="col.cellStyle"\n            compile="col.cellTemplate">\n            {{row[col.field]}}\n       </td>\n    </tr>\n    </tbody>\n</table>')}]);angular.module("treeTable",["template/treeTable/treeTable.html"]).directive("compile",["$compile",function(a){return{restrict:"A",link:function(d,c,b){d.$watch(b.compile,function(e){if(e!=null){var f=a(e);var g=f(d);c.empty().append(g)}})}}}]).directive("treeTable",["$timeout","$window","treeTableTemplate","tgConfig","$TreeTableHelper",function(a,e,d,c,b){return{restrict:"E",replace:true,scope:{treeData:"=",columnDefs:"=",expandOn:"=",onSelect:"&",onClick:"&",treeControl:"=",tree:"=treeControl",tree_data:"=treeData",callbacks:"=",primaryKey:"="},templateUrl:function(f,g){return g.templateUrl||d.getPath()},controller:["$scope","$element","$attrs","tgConfig",function(h,g,f,i){h.dragEnabled=true;h.dragDelay=0;h.indent=20;h.indent_plus=15;h.indent_unit="px";h.tree_class="table";h.primary_key="__uid__";h.$callbacks={accept:function(k,j){return true},beforeDrag:function(j){return true},dragStart:function(j){},dragMove:function(j){},dragStop:function(j,k){},beforeDrop:function(j){return true},calsIndent:function(l,k){var j=h.indent_unit?h.indent_unit:"px";if(!k){j=h.indent_unit?h.indent_unit:"px"}else{j=""}if(l-1<1){return h.indent_plus+j}else{return(h.indent*(l-1))+h.indent_plus+j}},dragEnabled:function(){return h.dragEnabled}};h.dropped=function(m,o){if(o){var r=m.node,j=m.target;var k=null;var p=null;var q=0;if(r.__parent_real__===null){k=h.treeData;p=null}else{p=h.tree_rows[r.__parent_real__];k=p.__children__}var n=k;if(j!==null){if(j.__level__==m.level){if(r.__parent_real__!==j.__parent_real__){if(j.__parent_real__===null){n=h.treeData;p=null}else{p=h.tree_rows[j.__parent_real__];n=p.__children__}}q=j.__index__+1}else{if(j.__level__<m.level){n=j.__children__;p=j}else{while(j.__level__>m.level){if(j.__parent_real__!==null){j=h.tree_rows[j.__parent_real__]}else{break}}if(j.__parent_real__===null){n=h.treeData;p=null}else{p=h.tree_rows[j.__parent_real__];n=p.__children__}q=j.__index__+1}}}else{n=h.treeData;p=null}if(n!=k||r.__index__!=q){if(n===k){if(q>r.__index__){q--}}var l=k.splice(r.__index__,1)[0];n.splice(q,0,l);m.move={parent:p,pos:q};return true}}return false};h.$globals={};h.accept=function(k,j){return h.$callbacks.accept(k,j)};h.beforeDrag=function(j){return h.$callbacks.beforeDrag(j)};h.safeApply=function(k){var j=this.$root.$$phase;if(j=="$apply"||j=="$digest"){if(k&&(typeof(k)==="function")){k()}}else{this.$apply(k)}};h.getPrevGlobal=function(j){if(j>0){return h.tree_rows[j-1]}return null};h.getNextGlobal=function(j){if(j>0){return h.tree_rows[j-1]}return null};h.getHash=function(j){if(h.primary_key=="__uid__"){return j.__parent__+"#"+j.__index__+"#"+j.__uid__+"#"+j.__children__.length}else{return j.__parent__+"#"+j.__index__+"#"+j[h.primary_key]+"#"+j.__children__.length}};h.setScope=function(l,j){var k=h.getHash(l);if(h.$globals[k]!=j){h.$globals[k]=j}};h.getScope=function(j){return h.$globals[h.getHash(j)]}}],link:function(g,h,r){g.$type="TreeTable";g.$typeTree="table";b.calsIndent=g.$callbacks.calsIndent;g.$watch(r.primaryKey,function(i){if(typeof i==="string"){g.primary_key=i}},true);g.$watch(r.typeTree,function(i){if(typeof i==="string"){g.$typeTree=i}},true);g.$watch(r.callbacks,function(i){angular.forEach(i,function(z,n){if(typeof z==="function"){if(g.$callbacks[n]){g.$callbacks[n]=z}}});b.calsIndent=g.$callbacks.calsIndent},true);if(angular.isString(r["class"])){g.tree_class=r["class"].trim()}if(angular.isString(r.indentUnit)){g.indent_unit=r.indentUnit}g.$watch(r.dragEnabled,function(i){if((typeof i)=="boolean"){g.dragEnabled=i}});g.$watch(r.indent,function(i){if((typeof i)=="number"){g.indent=i}});g.$watch(r.indentPlus,function(i){if((typeof i)=="number"){g.indent_plus=i}});g.$watch(r.dragDelay,function(i){if((typeof i)=="number"){g.dragDelay=i}});g.config={};angular.extend(g.config,c);g.$watch(r.config,function(i){angular.extend(g.config,i)},true);var o,w,s,p;r.iconExpand=r.iconExpand?r.iconExpand:"icon-plus  glyphicon glyphicon-plus  fa fa-plus";r.iconCollapse=r.iconCollapse?r.iconCollapse:"icon-minus glyphicon glyphicon-minus fa fa-minus";r.iconLeaf=r.iconLeaf?r.iconLeaf:"icon-file  glyphicon glyphicon-file  fa fa-file";r.expandLevel=r.expandLevel?r.expandLevel:"3";w=parseInt(r.expandLevel,10);if(!g.treeData){g.treeData=[]}if(r.expandOn){o=g.expandOn;g.expandingProperty=g.expandOn}else{if(g.treeData.length){var k=g.treeData[0],j=Object.keys(k);for(var t=0,u=j.length;t<u;t++){if(typeof(k[j[t]])==="string"){o=j[t];break}}if(!o){o=j[0]}g.expandingProperty=o}}g.colDefinitions=g.columnDefs||[];var m=function(B){var n,A,i,z;n=function(D,G){B(D,G);if(D.__children__!=null){var F,C,E;E=D.__children__;for(F=0,C=E.length;F<C;F++){n(E[F],G+1)}}};z=g.treeData;for(A=0,i=z.length;A<i;A++){n(z[A],1)}};var y=null;var v=function(i){if(!i){if(y!=null){y.__selected__=false}y=null;return}if(i!==y){if(y!=null){y.__selected__=false}i.__selected__=true;y=i;l(i);if(i.onSelect!=null){return a(function(){return i.onSelect(i)})}else{if(g.onSelect!=null){return a(function(){return g.onSelect({branch:i})})}}}};g.on_user_click=function(i){if(g.onClick){g.onClick({branch:i})}};g.user_clicks_branch=function(i){if(i!==y){return v(i)}};var x=function(i){if(i.__parent_real__!==null&&i.__parent_real__>-1&&i.__parent_real__<g.tree_rows.length){return g.tree_rows[i.__parent_real__]}return null};var q=function(z,n){var i;i=x(z);if(i!=null){n(i);return q(i,n)}};var l=function(i){return q(i,function(n){return n.__expanded__=true})};g.tree_rows=[];var f=function(){var C,i;i=g.treeData;C=i.length;var n=[];if(C>0){var z,A;A=function(O,P,K,H,I,L){var J,N,G;if(!angular.isArray(O.__children__)){O.__children__=[]}O.__parent_real__=K;O.__parent__=P;N=O.__children__.length;if(O.__expanded__==null&&N>0){O.__expanded__=H<w}if(N===0){G=r.iconLeaf}else{if(O.__expanded__){G=r.iconCollapse}else{G=r.iconExpand}}var R=n.length;O.__index__=L;O.__index_real__=R;O.__level__=H;O.__tree_icon__=G;O.__visible__=I;if(O.__uid__==null){O.__uid__=""+Math.random()}n.push(O);var M=1;if(N>0){for(J=0;J<N;J++){M+=A(O.__children__[J],(g.primary_key=="__uid__")?O.__uid__:O[g.primary_key],R,H+1,I&&O.__expanded__,J)}}var Q;if(g.primary_key=="__uid__"){Q=P+"#"+L+"#"+O.__uid__}else{Q=P+"#"+L+"#"+O[g.primary_key]}if(O.__hashKey__==null||O.__hashKey__!=Q){O.__hashKey__=Q;g.$globals[Q]=null}O.__dept__=M;return M};var E=0;for(z=0;z<C;z++){E+=A(i[z],null,null,1,true,z)}C=g.$globals;var D,F,B=Object.keys(g.$globals);D=u-E;if(D!=0){F=u-D;_min=F-Math.abs(D);for(z=_min;z<F;z++){delete (g.$globals[B[z]])}}}g.tree_rows=n;return g.tree_rows};g.$watch("treeData",f,true);f();if(g.treeControl!=null){if(angular.isObject(g.treeControl)){p=g.treeControl;p.expand_all=function(){m(function(i,n){i.__expanded__=true})};p.collapse_all=function(){m(function(i,n){i.__expanded__=false})};p.get_first_branch=function(){s=g.treeData.length;if(s>0){return g.treeData[0]}return null};p.select_first_branch=function(){var i;i=p.get_first_branch();return p.select_branch(i)};p.get_selected_branch=function(){return y};p.get_parent_branch=function(i){return x(i)};p.select_branch=function(i){v(i);return i};p.get_children=function(i){return i.__children__};p.select_parent_branch=function(i){var n;if(i==null){i=p.get_selected_branch()}if(i!=null){n=p.get_parent_branch(i);if(n!=null){p.select_branch(n);return n}}};p.add_branch=function(n,z,i){if((typeof i)!="number"){if(n!=null){n.__children__.push(z);n.__expanded__=true}else{g.treeData.push(z)}}else{if(n!=null){n.__children__.splice(i,0,z);n.__expanded__=true}else{g.treeData.splice(i,0,z)}}return z};p.add_root_branch=function(i){p.add_branch(null,i);return i};p.remove_branch=function(z){z=z||p.get_selected_branch();if(z){var n;if(z.__parent_real__!==null){n=p.get_parent_branch(z).__children__}else{n=g.treeData}var i=n.indexOf(z);n.splice(i,1);y=null}};p.expand_branch=function(i){if(i==null){i=p.get_selected_branch()}if(i!=null){i.__expanded__=true;return i}};p.collapse_branch=function(i){if(i==null){i=y}if(i!=null){i.__expanded__=false;return i}};p.get_siblings=function(i){var n,z;if(i==null){i=y}if(i!=null){n=p.get_parent_branch(i);if(n){z=n.__children__}else{z=g.treeData}return z}};p.get_next_sibling=function(n){var z,A;if(n==null){n=y}if(n!=null){A=p.get_siblings(n);s=A.length;z=A.indexOf(n);if(z<s){return A[z+1]}}};p.get_prev_sibling=function(n){var z,A;if(n==null){n=y}A=p.get_siblings(n);s=A.length;z=A.indexOf(n);if(z>0){return A[z-1]}};p.select_next_sibling=function(i){var n;if(i==null){i=y}if(i!=null){n=p.get_next_sibling(i);if(n!=null){return p.select_branch(n)}}};p.select_prev_sibling=function(i){var n;if(i==null){i=y}if(i!=null){n=p.get_prev_sibling(i);if(n!=null){return p.select_branch(n)}}};p.get_first_child=function(i){var n;if(i==null){i=y}if(i!=null){if(((n=i.__children__)!=null?n.length:void 0)>0){return i.__children__[0]}}};p.get_closest_ancestor_next_sibling=function(i){var z,n;z=p.get_next_sibling(i);if(z!=null){return z}else{n=p.get_parent_branch(i);return p.get_closest_ancestor_next_sibling(n)}};p.get_next_branch=function(i){var n;if(i==null){i=y}if(i!=null){n=p.get_first_child(i);if(n!=null){return n}else{n=p.get_closest_ancestor_next_sibling(i);return n}}};p.select_next_branch=function(i){var n;if(i==null){i=y}if(i!=null){n=p.get_next_branch(i);if(n!=null){p.select_branch(n);return n}}};p.last_descendant=function(i){var n;if(i==null){}s=i.__children__.length;if(s===0){return i}else{n=i.__children__[s-1];return p.last_descendant(n)}};p.get_prev_branch=function(i){var n,z;if(i==null){i=y}if(i!=null){z=p.get_prev_sibling(i);if(z!=null){return p.last_descendant(z)}else{n=p.get_parent_branch(i);return n}}};p.reload_data=function(){return f()};p.select_prev_branch=function(i){var n;if(i==null){i=y}if(i!=null){n=p.get_prev_branch(i);if(n!=null){p.select_branch(n);return n}}}}}}}}]).directive("treeTableNode",["$window","$document","$timeout","$TreeTableHelper",function(d,c,a,b){return{restrict:"A",replace:true,controller:["$scope","$element","$attrs","tgConfig",function(g,f,e,h){g.$modelValue=null;g.$nodeScope=g;g.$scopeChildren=null;g.childNodesCount=function(){return g.childNodes().length};g.childNodes=function(){return g.$modelValue.__children__};g.safeApply=function(j){var i=this.$root.$$phase;if(i=="$apply"||i=="$digest"){if(j&&(typeof(j)==="function")){j()}}else{this.$apply(j)}};g.expand=function(i){if(i.__children__.length>0){i.__expanded__=!i.__expanded__}};g.prev=function(){return g.getPrevGlobal(g.$modelValue.__index_real__)};g.next=function(){return g.getNextGlobal(g.$modelValue.__index_real__)};g.node=function(){return g.$modelValue};g.data=function(){return g.$modelValue};g.visible=function(i){if(i!=null){return i.__visible__?i:g.visible(g.tree_rows[i.__parent_real__])}return null};g.elementChilds=null;g.setElementChilds=function(i){g.elementChilds=i}}],link:function(h,j,t){h.$element=j;h.$type="TreeTableNode";if(h.config.nodeClass){j.addClass(h.config.nodeClass)}h.$watch(t.treeTableNode,function(G,E,F){F.setScope(G,F);F.$modelValue=G},true);var x="ontouchstart" in window;var D,s,g,n;var f,B;var k=true;var l=false;var i=null;var q=document.body,r=document.documentElement,u,m;var A=function(L){if(!x&&(L.button==2||L.which==3)){return}if(L.uiTreeDragging||(L.originalEvent&&L.originalEvent.uiTreeDragging)){return}var O=angular.element(L.target);var J=O.scope();if(!J||!J.$type){return}if(J.$type!="TreeTableNode"&&J.$type!="TreeTableNodeHandle"){return}if(J.$type!="TreeTableNodeHandle"){return}var G=O.prop("tagName").toLowerCase();if(G=="input"||G=="textarea"||G=="button"||G=="select"){return}while(O&&O[0]&&O[0]!=j){if(b.nodrag(O)){return}O=O.parent()}if(!h.beforeDrag(h)){return}L.uiTreeDragging=true;if(L.originalEvent){L.originalEvent.uiTreeDragging=true}L.preventDefault();var M=b.eventObj(L);s=true;g=b.dragInfo(h);var F=h.$element.prop("tagName").toLowerCase();if(F.toLowerCase()=="tr"){f=angular.element(d.document.createElement("tr"));var N=h.colDefinitions.length,I;f.append(angular.element(d.document.createElement("td")).addClass(h.config.emptyTreeClass).addClass("indented").addClass(h.config.placeHolderClass));while(N-->0){f.append(angular.element(d.document.createElement("td")).addClass(h.config.emptyTreeClass).addClass(h.config.placeHolderClass))}b.replaceIndent(f,g.level)}else{f=angular.element(d.document.createElement("li")).addClass(h.config.emptyTreeClass).addClass(h.config.placeHolderClass)}n=b.positionStarted(M,h.$element);f.css("width",b.width(h.$element)+"px");if(F==="tr"){B=angular.element(d.document.createElement("table")).addClass(h.config.tree_class+" table "+h.config.dragClass)}else{B=angular.element(d.document.createElement("ul")).addClass(h.config.dragClass+" tree-table-rows")}B.css("width",(b.width(h.$element)+10)+"px");B.css("z-index",9999);var H=0;if(F=="tr"){var K=angular.element(d.document.createElement("tbody"));var E=function(S){var P,R,T,Q,U;P=h.getScope(S);R=P.$element;H+=b.height(R);K.append(R.clone());if(h.config.hiddenClass){R.addClass(h.config.hiddenClass)}U=S.__children__;Q=U.length;for(T=0;T<Q;T++){E(U[T])}};E(h.node());B.append(K)}else{H=b.height(h.$element);B.append(h.$element.clone());if(h.config.hiddenClass){h.$element.addClass(h.config.hiddenClass)}}f.css("height",H+"px");h.$element[0].parentNode.insertBefore(f[0],h.$element[0]);c.find("body").append(B);B.css({left:M.pageX-n.offsetX+"px",top:M.pageY-n.offsetY+"px"});angular.element(c).bind("touchend",p);angular.element(c).bind("touchcancel",p);angular.element(c).bind("touchmove",w);angular.element(c).bind("mouseup",p);angular.element(c).bind("mousemove",w);angular.element(c).bind("mouseleave",C);u=Math.max(q.scrollHeight,q.offsetHeight,r.clientHeight,r.scrollHeight,r.offsetHeight);m=Math.max(q.scrollWidth,q.offsetWidth,r.clientWidth,r.scrollWidth,r.offsetWidth)};var z=function(W){if(!l){if(!k){l=true;h.$apply(function(){h.$callbacks.dragStart(g)})}return}var F=b.eventObj(W);var T,Y,L;if(B){W.preventDefault();if(d.getSelection){d.getSelection().removeAllRanges()}else{if(d.document.selection){d.document.selection.empty()}}Y=F.pageX-n.offsetX;L=F.pageY-n.offsetY;if(Y<0){Y=0}if(L<0){L=0}if((L+10)>u){L=u-10}if((Y+10)>m){Y=m-10}B.css({left:Y+"px",top:L+"px"});var I=window.pageYOffset||d.document.documentElement.scrollTop;var M=I+(window.innerHeight||d.document.clientHeight||d.document.clientHeight);if(M<F.pageY&&M<=u){window.scrollBy(0,10)}if(I>F.pageY){window.scrollBy(0,-10)}b.positionMoved(W,n,s);if(s){s=false;return}var E=(b.offset(B).left-b.offset(f).left)>=h.config.threshold;var Q=F.pageX-d.document.body.scrollLeft;var P=F.pageY-(window.pageYOffset||d.document.documentElement.scrollTop);var N;if(angular.isFunction(B.hide)){B.hide()}else{N=B[0].style.display;B[0].style.display="none"}d.document.elementFromPoint(Q,P);var H=angular.element(d.document.elementFromPoint(Q,P));if(angular.isFunction(B.show)){B.show()}else{B[0].style.display=N}var G=h.$element.prop("tagName").toLowerCase();if(!n.dirAx){var K,J;J=H.scope();if(!J){return}if(J.$type=="TreeTable"&&J.$callbacks.dragEnabled()){return}if(J.$type=="TreeTableNodeHandle"){J=H.scope().$nodeScope}if(J.$type!="TreeTableNode"){return}H=J.$element;var X=b.offset(H);if(G=="tr"){K=F.pageY<(X.top+b.height(H)/2)}else{var Z=b.height(H)-b.height(J.elementChilds);if(F.pageY>X.top+Z){return}K=F.pageY<(X.top+Z/2)}if(J.$callbacks.dragEnabled()){if(J.accept(g,K)){g.level=J.node().__level__;if(K){if(g.isDirty(J.node().__index_real__-1)){g.target=J.getPrevGlobal(g.node.__index_real__)}else{g.target=J.prev()}if(G=="tr"){b.replaceIndent(f,g.level)}H[0].parentNode.insertBefore(f[0],H[0])}else{g.target=J.node();var S=g.level;if(J.data().__expanded__){S++;g.level=S;if(G=="tr"){b.replaceIndent(f,S);H.after(f)}else{J.elementChilds.prepend(f)}}else{if(G=="tr"){b.replaceIndent(f,S)}H.after(f)}}g.scope=J}}}else{var J=g.scope;if(n.dirAx&&n.distAxX>=J.config.levelThreshold){n.distAxX=0;var O=g.target;if(O){if(n.distX>0){var R=J.visible(O);if(R!=null&&R.__level__>=g.level){g.level++;if(G=="tr"){b.replaceIndent(f,g.level)}else{var U=J.getScope(R);U.elementChilds.append(f)}}}else{if(n.distX<0){var V=g.canIndent();if(V==null||V){g.level=g.level-1;if(G=="tr"){b.replaceIndent(f,g.level)}else{var U=J.getScope(V);U.$element.after(f)}}}}}}}h.$apply(function(){h.$callbacks.dragMove(g)})}};var v=function(I){I.preventDefault();if(B){var F=false;h.$apply(function(){F=h.$callbacks.beforeDrop(g)});var G=h.$element.prop("tagName").toLowerCase();if(G=="tr"){var E=function(M){var J,L,N,K,O;J=h.getScope(M);L=J.$element;if(h.config.hiddenClass){L.removeClass(h.config.hiddenClass)}O=M.__children__;K=O.length;for(N=0;N<K;N++){E(O[N])}};E(h.node())}else{if(h.config.hiddenClass){h.$element.removeClass(h.config.hiddenClass)}}f.remove();B.remove();B=null;var H=false;if(h.$$apply){h.$apply(function(){H=h.dropped(g,F)})}else{y()}h.$apply(function(){h.$callbacks.dragStop(g,H)});h.$$apply=false;g=null}angular.element(c).unbind("touchend",p);angular.element(c).unbind("touchcancel",p);angular.element(c).unbind("touchmove",w);angular.element(c).unbind("mouseup",p);angular.element(c).unbind("mousemove",w);angular.element(d.document.body).unbind("mouseleave",C)};var e=function(E){if(h.$callbacks.dragEnabled()){A(E)}};var w=function(E){z(E)};var p=function(E){h.$$apply=true;v(E)};var C=function(E){v(E)};var y=function(){j.bind("touchstart mousedown",function(E){k=true;l=false;e(E);i=a(function(){k=false},h.dragDelay)});j.bind("touchend touchcancel mouseup",function(){a.cancel(i)})};y();var o=function(E){if(E.keyCode==27){h.$$apply=false;v(E)}};angular.element(d.document.body).bind("keydown",o);h.$on("$destroy",function(){angular.element(d.document.body).unbind("keydown",o)})}}}]).directive("treeTableNodes",function(){return{restrict:"A",replace:true,controller:["$scope","$element","$attrs","tgConfig",function(c,b,a,d){c.$nodeScope=null;c.datas=[]}],link:function(c,b,a){c.$type="TreeTableNodes";c.$element=b;if(c.setElementChilds){c.setElementChilds(b)}c.$watch(a.treeTableNodes,function(f,d,e){e.datas=f},true);c.$nodeScope=c;c.$element=b}}}).directive("treeTableNodeHandle",function(){return{restrict:"A",scope:true,controller:["$scope","$element","$attrs","tgConfig",function(c,b,a,d){c.$nodeScope=null}],link:function(c,b,a){c.$element=b;c.$type="TreeTableNodeHandle";if(c.$parent.$type=="TreeTableNode"){c.$nodeScope=c.$parent}else{c.$nodeScope=c}if(c.config.handleClass){b.addClass(c.config.handleClass)}}}}).provider("treeTableTemplate",function(){var a="template/treeTable/treeTable.html";this.setPath=function(b){a=b};this.$get=function(){return{getPath:function(){return a}}}}).factory("$TreeTableHelper",["$document","$window",function(b,a){return{calsIndent:null,isUndefinedOrNull:function(c){return angular.isUndefined(c)||c===null},nodrag:function(c){return(typeof c.attr("data-nodrag"))!="undefined"},eventObj:function(d){var c=d;if(d.targetTouches!==undefined){c=d.targetTouches.item(0)}else{if(d.originalEvent!==undefined&&d.originalEvent.targetTouches!==undefined){c=d.originalEvent.targetTouches.item(0)}}return c},dragInfo:function(c){return{node:c.node(),level:c.node().__level__,target:c.prev(),scope:c,move:{parent:-1,pos:-1},isDirty:function(d){return this.node.__index_real__<=d&&d<=this.node.__index_real__+this.node.__dept__-1},canIndent:function(){if(this.level==1){return false}var d=this.target;var e=d;while(d){if(d.__level__<this.level){if(d.__expanded__){if(d.__children__.length==0){return d}else{if((d.__index_real__==this.target.__parent_real__&&d.__children__.length-1==this.target.__index__)||(d.__index_real__==e.__parent_real__&&d.__children__.length-1==e.__index__)||(d.__index_real__==this.node.__parent_real__&&d.__children__.length-1==this.node.__index__)){return d}}return false}return d}else{if(d.__parent_real__==null){return null}else{e=d;d=this.scope.tree_rows[d.__parent_real__]}}}return false},canInsert:function(d){if(d.__children__.length==0){return true}else{if((d.__index_real__==this.target.__parent_real__&&d.__children__.length-1==this.target.__index__)||(d.__index_real__==this.node.__parent_real__&&d.__children__.length-1==this.node.__index__)){return d}}return false}}},height:function(c){return c.prop("scrollHeight")},width:function(c){return c.prop("scrollWidth")},offset:function(c){var d=c[0].getBoundingClientRect();return{width:c.prop("offsetWidth"),height:c.prop("offsetHeight"),top:d.top+(a.pageYOffset||b[0].body.scrollTop||b[0].documentElement.scrollTop),left:d.left+(a.pageXOffset||b[0].body.scrollLeft||b[0].documentElement.scrollLeft)}},positionStarted:function(d,c){var f={};f.offsetX=d.pageX-this.offset(c).left;f.offsetY=d.pageY-this.offset(c).top;f.startX=f.lastX=d.pageX;f.startY=f.lastY=d.pageY;f.nowX=f.nowY=f.distX=f.distY=f.dirAx=0;f.dirX=f.dirY=f.lastDirX=f.lastDirY=f.distAxX=f.distAxY=0;return f},positionMoved:function(f,g,d){g.lastX=g.nowX;g.lastY=g.nowY;g.nowX=f.pageX;g.nowY=f.pageY;g.distX=g.nowX-g.lastX;g.distY=g.nowY-g.lastY;g.lastDirX=g.dirX;g.lastDirY=g.dirY;g.dirX=g.distX===0?0:g.distX>0?1:-1;g.dirY=g.distY===0?0:g.distY>0?1:-1;var c=Math.abs(g.distX)>Math.abs(g.distY)?1:0;if(d){g.dirAx=c;g.moving=true;return}if(g.dirAx!==c){g.distAxX=0;g.distAxY=0}else{g.distAxX+=Math.abs(g.distX);if(g.dirX!==0&&g.dirX!==g.lastDirX){g.distAxX=0}g.distAxY+=Math.abs(g.distY);if(g.dirY!==0&&g.dirY!==g.lastDirY){g.distAxY=0}}g.dirAx=c},replaceIndent:function(f,d,c){c=c?c:"left";angular.element(f.children()[0]).css(c,this.calsIndent(d))},hidden:function(c){if(angular.isFunction(c.hide)){c.hide()}else{displayElm=c[0].style.display;c[0].style.display="none"}}}}]).factory("$TreeTableConvert",function(){return{line2tree:function(d,j,h){if(!d||d.length==0||!j||!h){return[]}var m=[],a=[],k=d[0],b=k[j],l={},e,g,f=d.length,c=0;while(c<f){k=d[c++];b=k[j];l[b]=k;e=k[h];if(e){g=l[e];if(g.__children__){g.__children__.push(k)}else{g.__children__=[k]}}else{a.push(b)}}f=a.length;for(c=0;c<f;c++){m.push(l[a[c]])}return m},tree2tree:function(c,a){var b=function(g){var i=[];var f,d=g.length,h,e;for(f=0;f<d;f++){h=angular.copy(g[f]);if(angular.isArray(h[a])&&h[a].length>0){e=b(h[a]);delete (h[a]);h.__children__=e}i.push(h)}return i};return b(c)}}}).constant("tgConfig",{treeClass:"tree-table",emptyTreeClass:"tree-table-empty",hiddenClass:"tree-table-hidden",nodeClass:"tree-table-row",nodesClas:"tree-table-rows",handleClass:"tree-table-handle",placeHolderClass:"tree-table-placeholder",dragClass:"tree-table-drag",levelThreshold:30})}).call(window);
>>>>>>> master
=======
(function(){angular.module("template/treeTable/treeTable.html",[]).run(["$templateCache",function(a){a.put("template/treeTable/treeTable.html",'<table ng-class="tree_class">\n    <thead>\n  <tr>\n     <th ng-class="expandingProperty.titleClass" ng-style="expandingProperty.titleStyle">\n         {{expandingProperty.displayName || expandingProperty.field || expandingProperty}}\n        </th>\n        <th ng-repeat="col in colDefinitions" ng-class="col.titleClass" ng-style="col.titleStyle">\n         {{col.displayName || col.field}}\n     </th>\n    </tr>\n    </thead>\n <tbody>\n  <tr tree-table-node="row" ng-repeat="row in tree_rows track by row.__hashKey__ " ng-show="row.__visible__"\n     ng-class="(row.__selected__ ? \' active\':\'\')">\n        <td ng-if="!expandingProperty.template" tree-table-node-handle\n         ng-style="expandingProperty.cellStyle ? expandingProperty.cellStyle : {\'padding-left\': $callbacks.calsIndent(row.__level__)}"\n          ng-click="user_clicks_branch(row)" ng-class="expandingProperty.cellClass"\n            compile="expandingProperty.cellTemplate">\n              <a data-nodrag>\n                  <i ng-class="row.__tree_icon__" ng-click="row.__expanded__ = !row.__expanded__"\n                     class="tree-icon"></i>\n              </a>\n             {{row[expandingProperty.field] || row[expandingProperty]}}\n       </td>\n        <td ng-if="expandingProperty.template" compile="expandingProperty.template"></td>\n        <td ng-repeat="col in colDefinitions" ng-class="col.cellClass" ng-style="col.cellStyle"\n            compile="col.cellTemplate">\n            {{row[col.field]}}\n       </td>\n    </tr>\n    </tbody>\n</table>');a.put("template/treeTable/treeTableStatusCopy.html",'<label><i class="fa fa-copy"></i>&nbsp;<b>Copying</b></label>');a.put("template/treeTable/treeTableStatusMove.html",'<label><i class="fa fa-file-text"></i>&nbsp;<b>Moving</b></label>')}]);angular.module("treeTable",["template/treeTable/treeTable.html"]).directive("compile",["$compile",function(a){return{restrict:"A",link:function(d,c,b){d.$watch(b.compile,function(e){if(e!=null){var f=a(e);var g=f(d);c.empty().append(g)}})}}}]).directive("treeTable",["$timeout","$window","treeTableTemplate","tgConfig","$TreeTableHelper","$templateCache",function(b,f,e,d,c,a){return{restrict:"E",replace:true,scope:{treeData:"=",columnDefs:"=",expandOn:"=",onSelect:"&",onClick:"&",treeControl:"=",tree:"=treeControl",tree_data:"=treeData",callbacks:"=",primaryKey:"="},templateUrl:function(g,h){return h.templateUrl||e.getPath()},controller:["$scope","$element","$attrs","tgConfig",function(i,h,g,j){i.dragEnabled=true;i.dragDelay=0;i.indent=20;i.indent_plus=15;i.indent_unit="px";i.tree_class="table";i.primary_key="__uid__";i.enabledMove=true;i.statusMove=true;i.enabledStatus=false;i.enabledHotkey=false;i.$globals={};i.$dragging=null;i.$callbacks={accept:function(l,k){return true},beforeDrag:function(k){return true},dragStart:function(k){},dragMove:function(k){},dragStop:function(k,l){},beforeDrop:function(k){return true},calsIndent:function(o,n,m){var l=i.indent_unit?i.indent_unit:"px";var k=(m)?0:i.indent_plus;if(!n){l=i.indent_unit?i.indent_unit:"px"}else{l=0}if(o-1<1){return k+l}else{return(i.indent*(o-1))+k+l}},dragEnabled:function(){return i.dragEnabled}};i.setDragging=function(k){if(k){i.$dragging=k}else{i.$dragging=null}};i.dropped=function(o,q){var t=o.node,k=o.target,m=o.scope;var l=null;var r=null;var s=0;if(t.__parent_real__===null){l=i.treeData;r=null}else{r=i.tree_rows[t.__parent_real__];l=r.__children__}var p=l;if(k!==null){if(k.__level__==o.level){if(t.__parent_real__!==k.__parent_real__){if(k.__parent_real__===null){p=i.treeData;r=null}else{r=i.tree_rows[k.__parent_real__];p=r.__children__}}s=k.__index__+1}else{if(k.__level__<o.level){p=k.__children__;r=k}else{while(k.__level__>o.level){if(k.__parent_real__!==null){k=i.tree_rows[k.__parent_real__]}else{break}}if(k.__parent_real__===null){p=i.treeData;r=null}else{r=i.tree_rows[k.__parent_real__];p=r.__children__}s=k.__index__+1}}}else{p=i.treeData;r=null}if(p!=l||t.__index__!=s){if(p===l){if(s>t.__index__){s--}}if(q==true){var n=l.splice(t.__index__,1)[0];p.splice(s,0,n)}o.move={parent:r,pos:s};return true}return false};i.accept=function(l,k){return i.$callbacks.accept(l,k)};i.beforeDrag=function(k){return i.$callbacks.beforeDrag(k)};i.safeApply=function(l){var k=this.$root.$$phase;if(k=="$apply"||k=="$digest"){if(l&&(typeof(l)==="function")){l()}}else{this.$apply(l)}};i.getPrevGlobal=function(k){if(k>0){return i.tree_rows[k-1]}return null};i.getNextGlobal=function(k){if(k>0){return i.tree_rows[k-1]}return null};i.getHash=function(k){if(i.primary_key=="__uid__"){return k.__parent__+"#"+k.__index__+"#"+k.__uid__+"#"+k.__children__.length}else{return k.__parent__+"#"+k.__index__+"#"+k[i.primary_key]+"#"+k.__children__.length}};i.setScope=function(m,k){var l=i.getHash(m);if(i.$globals[l]!=k){i.$globals[l]=k}};i.getScope=function(k){return i.$globals[i.getHash(k)]};i.getScopeTree=function(){return i};i.enableMove=function(k){if((typeof k)==="boolean"){i.enabledMove=k}else{i.enabledMove=true}}}],link:function(h,j,u){h.$type="TreeTable";h.$typeTree="table";h.$watch(u.enableStatus,function(i){if((typeof i)==="boolean"){h.enabledStatus=i}},true);h.$watch(u.enableMove,function(i){if((typeof i)==="boolean"){h.enabledMove=i;h.statusMove=i}},true);h.$watch(u.templateCopy,function(n){var i=null;if((typeof n)==="string"&&n.trim().length>0){i=n.trim()}else{i=u.templateCopy;if(i){i=i.trim();if(i.length==0&&!a.get(i)){i=null}}}if(i){if(a.get(i)){e.setCopy(i)}}},true);h.$watch(u.templateMove,function(n){var i=null;if((typeof n)==="string"&&n.trim().length>0){i=n.trim()}else{i=u.templateMove;if(i){i=i.trim();if(i.length==0&&!a.get(i)){i=null}}}if(i){if(a.get(i)){e.setMove(i)}}},true);c.calsIndent=h.$callbacks.calsIndent;h.$watch(u.primaryKey,function(i){if(typeof i==="string"){h.primary_key=i}},true);h.$watch(u.typeTree,function(i){if(typeof i==="string"){h.$typeTree=i}},true);h.$watch(u.callbacks,function(i){angular.forEach(i,function(C,n){if(typeof C==="function"){if(h.$callbacks[n]){h.$callbacks[n]=C}}});c.calsIndent=h.$callbacks.calsIndent},true);if((typeof u["class"])==="string"){h.tree_class=u["class"].trim()}if((typeof u.indentUnit)==="string"){h.indent_unit=u.indentUnit}h.$watch(u.enableHotkey,function(i){if((typeof i)==="boolean"){h.enabledHotkey=i}if(h.enabledHotkey){h.enabledMove=false}else{h.enabledMove=h.statusMove}},true);h.$watch(u.enableDrag,function(i){if((typeof i)==="boolean"){h.dragEnabled=i}},true);h.$watch(u.indent,function(i){if((typeof i)=="number"){h.indent=i}},true);h.$watch(u.indentPlus,function(i){if((typeof i)=="number"){h.indent_plus=i}},true);h.$watch(u.dragDelay,function(i){if((typeof i)=="number"){h.dragDelay=i}});h.config={};angular.extend(h.config,d);h.$watch(u.config,function(i){angular.extend(h.config,i)},true);var r,z,v,s;u.iconExpand=u.iconExpand?u.iconExpand:"icon-plus  glyphicon glyphicon-plus  fa fa-plus";u.iconCollapse=u.iconCollapse?u.iconCollapse:"icon-minus glyphicon glyphicon-minus fa fa-minus";u.iconLeaf=u.iconLeaf?u.iconLeaf:"icon-file  glyphicon glyphicon-file  fa fa-file";u.expandLevel=u.expandLevel?u.expandLevel:"3";z=parseInt(u.expandLevel,10);if(!h.treeData){h.treeData=[]}if(u.expandOn){r=h.expandOn;h.expandingProperty=h.expandOn}else{if(h.treeData.length){var m=h.treeData[0],k=Object.keys(m);for(var w=0,x=k.length;w<x;w++){if(typeof(m[k[w]])==="string"){r=k[w];break}}if(!r){r=k[0]}h.expandingProperty=r}}h.colDefinitions=h.columnDefs||[];var q=function(E){var n,D,i,C;n=function(G,J){E(G,J);if(G.__children__!=null){var I,F,H;H=G.__children__;for(I=0,F=H.length;I<F;I++){n(H[I],J+1)}}};C=h.treeData;for(D=0,i=C.length;D<i;D++){n(C[D],1)}};var B=null;var y=function(i){if(!i){if(B!=null){B.__selected__=false}B=null;return}if(i!==B){if(B!=null){B.__selected__=false}i.__selected__=true;B=i;o(i);if(i.onSelect!=null){return b(function(){return i.onSelect(i)})}else{if(h.onSelect!=null){return b(function(){return h.onSelect({branch:i})})}}}};h.on_user_click=function(i){if(h.onClick){h.onClick({branch:i})}};h.user_clicks_branch=function(i){if(i!==B){return y(i)}};var A=function(i){if(i.__parent_real__!==null&&i.__parent_real__>-1&&i.__parent_real__<h.tree_rows.length){return h.tree_rows[i.__parent_real__]}return null};var t=function(C,n){var i;i=A(C);if(i!=null){n(i);return t(i,n)}};var o=function(i){return t(i,function(n){return n.__expanded__=true})};h.tree_rows=[];var g=function(){var F,i;i=h.treeData;F=i.length;var n=[];if(F>0){var C,D;D=function(R,S,N,K,L,O){var M,Q,J;if(!angular.isArray(R.__children__)){R.__children__=[]}R.__parent_real__=N;R.__parent__=S;Q=R.__children__.length;if(R.__expanded__==null&&Q>0){R.__expanded__=K<z}if(Q===0){J=u.iconLeaf}else{if(R.__expanded__){J=u.iconCollapse}else{J=u.iconExpand}}var U=n.length;R.__index__=O;R.__index_real__=U;R.__level__=K;R.__tree_icon__=J;R.__visible__=L;if(R.__uid__==null){R.__uid__=""+Math.random()}n.push(R);var P=1;if(Q>0){for(M=0;M<Q;M++){P+=D(R.__children__[M],(h.primary_key=="__uid__")?R.__uid__:R[h.primary_key],U,K+1,L&&R.__expanded__,M)}}var T;if(h.primary_key=="__uid__"){T=S+"#"+O+"#"+R.__uid__}else{T=S+"#"+O+"#"+R[h.primary_key]}if(R.__hashKey__==null||R.__hashKey__!=T){R.__hashKey__=T;h.$globals[T]=null}R.__dept__=P;return P};var H=0;for(C=0;C<F;C++){H+=D(i[C],null,null,1,true,C)}F=h.$globals;var G,I,E=Object.keys(h.$globals);G=x-H;if(G!=0){I=x-G;_min=I-Math.abs(G);for(C=_min;C<I;C++){delete (h.$globals[E[C]])}}}h.tree_rows=n;return h.tree_rows};h.$watch("treeData",g,true);g();if(h.treeControl!=null){if(angular.isObject(h.treeControl)){s=h.treeControl;s.expand_all=function(){q(function(i,n){i.__expanded__=true})};s.collapse_all=function(){q(function(i,n){i.__expanded__=false})};s.get_first_branch=function(){v=h.treeData.length;if(v>0){return h.treeData[0]}return null};s.select_first_branch=function(){var i;i=s.get_first_branch();return s.select_branch(i)};s.get_selected_branch=function(){return B};s.get_parent_branch=function(i){return A(i)};s.select_branch=function(i){y(i);return i};s.get_children=function(i){return i.__children__};s.select_parent_branch=function(i){var n;if(i==null){i=s.get_selected_branch()}if(i!=null){n=s.get_parent_branch(i);if(n!=null){s.select_branch(n);return n}}};s.add_branch=function(n,C,i){if((typeof i)!="number"){if(n!=null){n.__children__.push(C);n.__expanded__=true}else{h.treeData.push(C)}}else{if(n!=null){n.__children__.splice(i,0,C);n.__expanded__=true}else{h.treeData.splice(i,0,C)}}return C};s.add_root_branch=function(i){s.add_branch(null,i);return i};s.remove_branch=function(C){C=C||s.get_selected_branch();if(C){var n;if(C.__parent_real__!==null){n=s.get_parent_branch(C).__children__}else{n=h.treeData}var i=n.indexOf(C);n.splice(i,1);B=null}};s.expand_branch=function(i){if(i==null){i=s.get_selected_branch()}if(i!=null){i.__expanded__=true;return i}};s.collapse_branch=function(i){if(i==null){i=B}if(i!=null){i.__expanded__=false;return i}};s.get_siblings=function(i){var n,C;if(i==null){i=B}if(i!=null){n=s.get_parent_branch(i);if(n){C=n.__children__}else{C=h.treeData}return C}};s.get_next_sibling=function(n){var C,D;if(n==null){n=B}if(n!=null){D=s.get_siblings(n);v=D.length;C=D.indexOf(n);if(C<v){return D[C+1]}}};s.get_prev_sibling=function(n){var C,D;if(n==null){n=B}D=s.get_siblings(n);v=D.length;C=D.indexOf(n);if(C>0){return D[C-1]}};s.select_next_sibling=function(i){var n;if(i==null){i=B}if(i!=null){n=s.get_next_sibling(i);if(n!=null){return s.select_branch(n)}}};s.select_prev_sibling=function(i){var n;if(i==null){i=B}if(i!=null){n=s.get_prev_sibling(i);if(n!=null){return s.select_branch(n)}}};s.get_first_child=function(i){var n;if(i==null){i=B}if(i!=null){if(((n=i.__children__)!=null?n.length:void 0)>0){return i.__children__[0]}}};s.get_closest_ancestor_next_sibling=function(i){var C,n;C=s.get_next_sibling(i);if(C!=null){return C}else{n=s.get_parent_branch(i);return s.get_closest_ancestor_next_sibling(n)}};s.get_next_branch=function(i){var n;if(i==null){i=B}if(i!=null){n=s.get_first_child(i);if(n!=null){return n}else{n=s.get_closest_ancestor_next_sibling(i);return n}}};s.select_next_branch=function(i){var n;if(i==null){i=B}if(i!=null){n=s.get_next_branch(i);if(n!=null){s.select_branch(n);return n}}};s.last_descendant=function(i){var n;if(i==null){}v=i.__children__.length;if(v===0){return i}else{n=i.__children__[v-1];return s.last_descendant(n)}};s.get_prev_branch=function(i){var n,C;if(i==null){i=B}if(i!=null){C=s.get_prev_sibling(i);if(C!=null){return s.last_descendant(C)}else{n=s.get_parent_branch(i);return n}}};s.reload_data=function(){return g()};s.select_prev_branch=function(i){var n;if(i==null){i=B}if(i!=null){n=s.get_prev_branch(i);if(n!=null){s.select_branch(n);return n}}}}}var p=function(i){if(h.$dragging){if(i.keyCode==27){h.$dragging.$$apply=false;h.$dragging.dragEnd(i)}if(h.enabledHotkey){h.enableMove(i.shiftKey);h.$dragging.refreshStatus()}}};var l=function(i){if(h.$dragging&&h.enabledHotkey){h.enableMove(i.shiftKey);h.$dragging.refreshStatus()}};angular.element(f.document.body).bind("keydown",p);angular.element(f.document.body).bind("keyup",l);h.$on("$destroy",function(){angular.element(f.document.body).unbind("keydown",p);angular.element(f.document.body).unbind("keyup",l)})}}}]).directive("treeTableNode",["$window","$document","$timeout","$TreeTableHelper","treeTableTemplate",function(e,d,a,c,b){return{restrict:"A",replace:true,controller:["$scope","$element","$attrs","tgConfig",function(h,g,f,i){h.$modelValue=null;h.$nodeScope=h;h.$scopeChildren=null;h.childNodesCount=function(){return h.childNodes().length};h.childNodes=function(){return h.$modelValue.__children__};h.safeApply=function(k){var j=this.$root.$$phase;if(j=="$apply"||j=="$digest"){if(k&&(typeof(k)==="function")){k()}}else{this.$apply(k)}};h.expand=function(j){if(j.__children__.length>0){j.__expanded__=!j.__expanded__}};h.prev=function(){return h.getPrevGlobal(h.$modelValue.__index_real__)};h.next=function(){return h.getNextGlobal(h.$modelValue.__index_real__)};h.node=function(){return h.$modelValue};h.data=function(){return h.$modelValue};h.visible=function(j){if(j!=null){return j.__visible__?j:h.visible(h.tree_rows[j.__parent_real__])}return null};h.elementChilds=null;h.setElementChilds=function(j){h.elementChilds=j}}],link:function(i,k,v){i.$element=k;i.$type="TreeTableNode";if(i.config.nodeClass){k.addClass(i.config.nodeClass)}i.$watch(v.treeTableNode,function(H,F,G){G.setScope(H,G);G.$modelValue=H},true);var y="ontouchstart" in window,E,t,h,o,g,C,u,l=true,m=false,j=null,r=document.body,s=document.documentElement,w,n,q;var B=function(L){if(!y&&(L.button==2||L.which==3)){return}if(L.uiTreeDragging||(L.originalEvent&&L.originalEvent.uiTreeDragging)){return}var O=angular.element(L.target);var J=O.scope();if(!J||!J.$type){return}if(J.$type!="TreeTableNode"&&J.$type!="TreeTableNodeHandle"){return}if(J.$type!="TreeTableNodeHandle"){return}var H=O.prop("tagName").toLowerCase();if(H=="input"||H=="textarea"||H=="button"||H=="select"){return}while(O&&O[0]&&O[0]!=k){if(c.nodrag(O)){return}O=O.parent()}if(!i.beforeDrag(i)){return}L.uiTreeDragging=true;if(L.originalEvent){L.originalEvent.uiTreeDragging=true}L.preventDefault();i.setDragging(i);var M=c.eventObj(L);t=true;h=c.dragInfo(i);var G=i.$element.prop("tagName").toLowerCase();if(G.toLowerCase()=="tr"){g=angular.element(e.document.createElement("tr"));var N=i.colDefinitions.length;g.append(angular.element(e.document.createElement("td")).addClass(i.config.emptyTreeClass).addClass("indented").addClass(i.config.placeHolderClass));while(N-->0){g.append(angular.element(e.document.createElement("td")).addClass(i.config.emptyTreeClass).addClass(i.config.placeHolderClass))}c.replaceIndent(g,h.level)}else{g=angular.element(e.document.createElement("li")).addClass(i.config.emptyTreeClass).addClass(i.config.placeHolderClass)}o=c.positionStarted(M,i.$element);g.css("width",c.width(i.$element)+"px");if(G==="tr"){C=angular.element(e.document.createElement("table")).addClass(i.config.treeClass).addClass(i.config.dragClass).addClass(i.tree_class)}else{C=angular.element(e.document.createElement("ul")).addClass(i.config.dragClass).addClass("tree-table-rows").addClass(i.tree_class)}C.css({width:c.width(i.$element)+"px","z-index":9995});i.refreshStatus();if(u){u.css({left:L.pageX+10+"px",top:L.pageY+15+"px","z-index":9999});u.addClass(i.config.statusClass)}var I=0;q=0;if(G=="tr"){var K=angular.element(e.document.createElement("tbody"));q=i.node().__level__-1;var F=function(T){var P,R,U,Q,V,S;P=i.getScope(T);R=P.$element;I+=c.height(R);S=R.clone();c.replaceIndent(S,T.__level__-q,"padding-left");K.append(S);if(i.config.hiddenClass){R.addClass(i.config.hiddenClass)}V=T.__children__;Q=V.length;for(U=0;U<Q;U++){F(V[U])}};F(i.node());C.append(K)}else{I=c.height(i.$element);C.append(i.$element.clone());if(i.config.hiddenClass){i.$element.addClass(i.config.hiddenClass)}}g.css("height",I+"px");C.css({left:M.pageX-o.offsetX+c.calsIndent(q+1,true,true)+"px",top:M.pageY-o.offsetY+"px"});i.$element[0].parentNode.insertBefore(g[0],i.$element[0]);d.find("body").append(C);angular.element(d).bind("touchend",p);angular.element(d).bind("touchcancel",p);angular.element(d).bind("touchmove",x);angular.element(d).bind("mouseup",p);angular.element(d).bind("mousemove",x);angular.element(d).bind("mouseleave",D);w=Math.max(r.scrollHeight,r.offsetHeight,s.clientHeight,s.scrollHeight,s.offsetHeight);n=Math.max(r.scrollWidth,r.offsetWidth,s.clientWidth,s.scrollWidth,s.offsetWidth)};var A=function(W){if(!m){if(!l){m=true;i.$apply(function(){i.$callbacks.dragStart(h)})}return}var G=c.eventObj(W);var R,Y,L;if(C){W.preventDefault();if(e.getSelection){e.getSelection().removeAllRanges()}else{if(e.document.selection){e.document.selection.empty()}}Y=G.pageX-o.offsetX;L=G.pageY-o.offsetY;if(Y<0){Y=0}if(L<0){L=0}if((L+10)>w){L=w-10}if((Y+10)>n){Y=n-10}C.css({left:Y+c.calsIndent(q+1,true,true)+"px",top:L+"px"});if(u){u.css({left:W.pageX+10+"px",top:W.pageY+15+"px"})}var J=window.pageYOffset||e.document.documentElement.scrollTop;var M=J+(window.innerHeight||e.document.clientHeight||e.document.clientHeight);if(M<G.pageY&&M<=w){window.scrollBy(0,10)}if(J>G.pageY){window.scrollBy(0,-10)}c.positionMoved(W,o,t);if(t){t=false;return}var F=(c.offset(C).left-c.offset(g).left)>=i.config.levelThreshold;var P=G.pageX-e.document.body.scrollLeft;var O=G.pageY-(window.pageYOffset||e.document.documentElement.scrollTop);e.document.elementFromPoint(P,O);var I=angular.element(e.document.elementFromPoint(P,O));var H=i.$element.prop("tagName").toLowerCase();if(!o.dirAx){var K,U;U=I.scope();if(!U){return}if(U.$type=="TreeTable"&&U.$callbacks.dragEnabled()){return}if(U.$type=="TreeTableNodeHandle"){U=I.scope().$nodeScope}if(U.$type!="TreeTableNode"){return}I=U.$element;var X=c.offset(I);if(H=="tr"){K=G.pageY<(X.top+c.height(I)/2)}else{var Z=c.height(I)-c.height(U.elementChilds);if(G.pageY>X.top+Z){return}K=G.pageY<(X.top+Z/2)}if(U.$callbacks.dragEnabled()){if(U.accept(h,K)){h.level=U.node().__level__;if(K){if(h.isDirty(U.node().__index_real__-1)){h.target=U.getPrevGlobal(h.node.__index_real__)}else{h.target=U.prev()}if(H=="tr"){c.replaceIndent(g,h.level)}I[0].parentNode.insertBefore(g[0],I[0])}else{h.target=U.node();h.targetScope=U;var S=h.level;if(U.data().__expanded__){S++;h.level=S;if(H=="tr"){c.replaceIndent(g,S);I.after(g)}else{U.elementChilds.prepend(g)}}else{if(H=="tr"){c.replaceIndent(g,S)}I.after(g)}}h.scope=U}}}else{var U=h.scope;if(o.dirAx&&o.distAxX>=U.config.levelThreshold){o.distAxX=0;var N=h.target;if(N){if(o.distX>0){var Q=U.visible(N);if(Q!=null&&Q.__level__>=h.level){h.level++;if(H=="tr"){c.replaceIndent(g,h.level)}else{var T=U.getScope(Q);T.elementChilds.append(g)}}}else{if(o.distX<0){var V=h.canIndent();if(V==null||V){h.level=h.level-1;if(H=="tr"){c.replaceIndent(g,h.level)}else{var T=U.getScope(V);T.$element.after(g)}}}}}}}i.$apply(function(){i.$callbacks.dragMove(h)})}};i.dragEnd=function(J){J.preventDefault();if(C){i.setDragging();var G=false;i.$apply(function(){G=i.$callbacks.beforeDrop(h)});var H=i.$element.prop("tagName").toLowerCase();if(H=="tr"){var F=function(N){var K,M,O,L,P;K=i.getScope(N);M=K.$element;if(i.config.hiddenClass){M.removeClass(i.config.hiddenClass)}P=N.__children__;L=P.length;for(O=0;O<L;O++){F(P[O])}};F(i.node())}else{if(i.config.hiddenClass){i.$element.removeClass(i.config.hiddenClass)}}g.remove();C.remove();if(u){u.remove()}C=null;u=null;var I=false;if(i.$$apply){i.$apply(function(){I=i.dropped(h,G)})}else{z()}i.$apply(function(){i.$callbacks.dragStop(h,I)});i.$$apply=false;h=null}angular.element(d).unbind("touchend",p);angular.element(d).unbind("touchcancel",p);angular.element(d).unbind("touchmove",x);angular.element(d).unbind("mouseup",p);angular.element(d).unbind("mousemove",x);angular.element(e.document.body).unbind("mouseleave",D)};var f=function(F){if(i.$callbacks.dragEnabled()){B(F)}};var x=function(F){A(F)};var p=function(F){i.$$apply=true;i.dragEnd(F)};var D=function(F){i.dragEnd(F)};var z=function(){k.bind("touchstart mousedown",function(F){l=true;m=false;f(F);j=a(function(){l=false},i.dragDelay)});k.bind("touchend touchcancel mouseup",function(){a.cancel(j)})};i.refreshStatus=function(){if(i.enabledStatus){var F=u;if(i.enabledMove){u=angular.element(b.getMove())}else{u=angular.element(b.getCopy())}if(F){u.attr("class",F.attr("class"));u.attr("style",F.attr("style"));F.remove()}d.find("body").append(u)}};z()}}}]).directive("treeTableNodes",function(){return{restrict:"A",replace:true,controller:["$scope","$element","$attrs","tgConfig",function(c,b,a,d){c.$nodeScope=null;c.datas=[]}],link:function(c,b,a){c.$type="TreeTableNodes";c.$element=b;if(c.setElementChilds){c.setElementChilds(b)}c.$watch(a.treeTableNodes,function(f,d,e){e.datas=f},true);c.$nodeScope=c;c.$element=b}}}).directive("treeTableNodeHandle",function(){return{restrict:"A",scope:true,controller:["$scope","$element","$attrs","tgConfig",function(c,b,a,d){c.$nodeScope=null}],link:function(c,b,a){c.$element=b;c.$type="TreeTableNodeHandle";if(c.$parent.$type=="TreeTableNode"){c.$nodeScope=c.$parent}else{c.$nodeScope=c}if(c.config.handleClass){b.addClass(c.config.handleClass)}}}}).factory("treeTableTemplate",["$templateCache",function(a){var c="template/treeTable/treeTable.html";var b="template/treeTable/treeTableStatusCopy.html";var d="template/treeTable/treeTableStatusMove.html";return{setMove:function(e){d=e},setCopy:function(e){b=e},getPath:function(){return c},getCopy:function(){var e=a.get(b);if(e){return e}return a.get("template/treeTable/treeTableStatusCopy.html")},getMove:function(){var e=a.get(d);if(e){return e}return a.get("template/treeTable/treeTableStatusMove.html")}}}]).factory("$TreeTableHelper",["$document","$window",function(b,a){return{calsIndent:null,isUndefinedOrNull:function(c){return angular.isUndefined(c)||c===null},nodrag:function(c){return(typeof c.attr("data-nodrag"))!="undefined"},eventObj:function(d){var c=d;if(d.targetTouches!==undefined){c=d.targetTouches.item(0)}else{if(d.originalEvent!==undefined&&d.originalEvent.targetTouches!==undefined){c=d.originalEvent.targetTouches.item(0)}}return c},dragInfo:function(c){return{node:c.node(),level:c.node().__level__,target:c.prev(),scope:c,move:{parent:-1,pos:-1},isDirty:function(d){return this.node.__index_real__<=d&&d<=this.node.__index_real__+this.node.__dept__-1},canIndent:function(){if(this.level==1){return false}var d=this.target;var e=d;while(d){if(d.__level__<this.level){if(d.__expanded__){if(d.__children__.length==0){return d}else{if((d.__index_real__==this.target.__parent_real__&&d.__children__.length-1==this.target.__index__)||(d.__index_real__==e.__parent_real__&&d.__children__.length-1==e.__index__)||(d.__index_real__==this.node.__parent_real__&&d.__children__.length-1==this.node.__index__)){return d}}return false}return d}else{if(d.__parent_real__==null){return null}else{e=d;d=this.scope.tree_rows[d.__parent_real__]}}}return false},canInsert:function(d){if(d.__children__.length==0){return true}else{if((d.__index_real__==this.target.__parent_real__&&d.__children__.length-1==this.target.__index__)||(d.__index_real__==this.node.__parent_real__&&d.__children__.length-1==this.node.__index__)){return d}}return false}}},height:function(c){return c.prop("scrollHeight")},width:function(c){return c.prop("scrollWidth")},offset:function(c){var d=c[0].getBoundingClientRect();return{width:c.prop("offsetWidth"),height:c.prop("offsetHeight"),top:d.top+(a.pageYOffset||b[0].body.scrollTop||b[0].documentElement.scrollTop),left:d.left+(a.pageXOffset||b[0].body.scrollLeft||b[0].documentElement.scrollLeft)}},positionStarted:function(d,c){var f={};f.offsetX=d.pageX-this.offset(c).left;f.offsetY=d.pageY-this.offset(c).top;f.startX=f.lastX=d.pageX;f.startY=f.lastY=d.pageY;f.nowX=f.nowY=f.distX=f.distY=f.dirAx=0;f.dirX=f.dirY=f.lastDirX=f.lastDirY=f.distAxX=f.distAxY=0;return f},positionMoved:function(f,g,d){g.lastX=g.nowX;g.lastY=g.nowY;g.nowX=f.pageX;g.nowY=f.pageY;g.distX=g.nowX-g.lastX;g.distY=g.nowY-g.lastY;g.lastDirX=g.dirX;g.lastDirY=g.dirY;g.dirX=g.distX===0?0:g.distX>0?1:-1;g.dirY=g.distY===0?0:g.distY>0?1:-1;var c=Math.abs(g.distX)>Math.abs(g.distY)?1:0;if(d){g.dirAx=c;g.moving=true;return}if(g.dirAx!==c){g.distAxX=0;g.distAxY=0}else{g.distAxX+=Math.abs(g.distX);if(g.dirX!==0&&g.dirX!==g.lastDirX){g.distAxX=0}g.distAxY+=Math.abs(g.distY);if(g.dirY!==0&&g.dirY!==g.lastDirY){g.distAxY=0}}g.dirAx=c},replaceIndent:function(f,d,c){c=c?c:"left";angular.element(f.children()[0]).css(c,this.calsIndent(d))},hidden:function(c){if(angular.isFunction(c.hide)){c.hide()}else{displayElm=c[0].style.display;c[0].style.display="none"}}}}]).factory("$TreeTableConvert",function(){return{line2tree:function(d,j,h){if(!d||d.length==0||!j||!h){return[]}var m=[],a=[],k=d[0],b=k[j],l={},e,g,f=d.length,c=0;while(c<f){k=d[c++];b=k[j];l[b]=k;e=k[h];if(e){g=l[e];if(g.__children__){g.__children__.push(k)}else{g.__children__=[k]}}else{a.push(b)}}f=a.length;for(c=0;c<f;c++){m.push(l[a[c]])}return m},tree2tree:function(c,a){var b=function(g){var i=[];var f,d=g.length,h,e;for(f=0;f<d;f++){h=angular.copy(g[f]);if(angular.isArray(h[a])&&h[a].length>0){e=b(h[a]);delete (h[a]);h.__children__=e}i.push(h)}return i};return b(c)}}}).constant("tgConfig",{treeClass:"tree-table",emptyTreeClass:"tree-table-empty",hiddenClass:"tree-table-hidden",nodeClass:"tree-table-row",nodesClas:"tree-table-rows",handleClass:"tree-table-handle",placeHolderClass:"tree-table-placeholder",dragClass:"tree-table-drag",statusClass:"tree-table-status",levelThreshold:30})}).call(window);
>>>>>>> master
=======
(function(){angular.module("template/treeTable/treeTable.html",[]).run(["$templateCache",function(a){a.put("template/treeTable/treeTable.html",'<table ng-class="tree_class">\n    <thead>\n  <tr>\n     <th ng-class="expandingProperty.titleClass" ng-style="expandingProperty.titleStyle">\n         {{expandingProperty.displayName || expandingProperty.field || expandingProperty}}\n        </th>\n        <th ng-repeat="col in colDefinitions" ng-class="col.titleClass" ng-style="col.titleStyle">\n         {{col.displayName || col.field}}\n     </th>\n    </tr>\n    </thead>\n <tbody>\n  <tr tree-table-node="row" ng-repeat="row in tree_rows track by row.__hashKey__ " ng-show="row.__visible__"\n     ng-class="(row.__selected__ ? \' active\':\'\')">\n        <td ng-if="!expandingProperty.template" tree-table-node-handle\n         ng-style="expandingProperty.cellStyle ? expandingProperty.cellStyle : {\'padding-left\': $callbacks.calsIndent(row.__level__)}"\n          ng-click="user_clicks_branch(row)" ng-class="expandingProperty.cellClass"\n            compile="expandingProperty.cellTemplate">\n              <a data-nodrag>\n                  <i ng-class="row.__tree_icon__" ng-click="row.__expanded__ = !row.__expanded__"\n                     class="tree-icon"></i>\n              </a>\n             {{row[expandingProperty.field] || row[expandingProperty]}}\n       </td>\n        <td ng-if="expandingProperty.template" compile="expandingProperty.template"></td>\n        <td ng-repeat="col in colDefinitions" ng-class="col.cellClass" ng-style="col.cellStyle"\n            compile="col.cellTemplate">\n            {{row[col.field]}}\n       </td>\n    </tr>\n    </tbody>\n</table>');a.put("template/treeTable/treeTableStatusCopy.html",'<label><i class="fa fa-copy"></i>&nbsp;<b>Copying</b></label>');a.put("template/treeTable/treeTableStatusMove.html",'<label><i class="fa fa-file-text"></i>&nbsp;<b>Moving</b></label>')}]);angular.module("treeTable",["template/treeTable/treeTable.html"]).directive("compile",["$compile",function(a){return{restrict:"A",link:function(d,c,b){d.$watch(b.compile,function(e){if(e!=null){var f=a(e);var g=f(d);c.empty().append(g)}})}}}]).directive("treeTable",["$timeout","$window","$document","treeTableTemplate","tgConfig","$TreeTableHelper","$templateCache",function(b,g,f,e,d,c,a){return{restrict:"E",replace:true,scope:{treeData:"=",onSelect:"&",onClick:"&",tree:"=treeControl",tree_data:"=treeData",expandOn:"=",columnDefs:"=",callbacks:"=",primaryKey:"="},templateUrl:function(h,i){return i.templateUrl||e.getPath()},controller:["$scope","$element","$attrs","tgConfig",function(j,i,h,k){j.dragEnabled=true;j.dragDelay=0;j.indent=20;j.indent_plus=15;j.indent_unit="px";j.tree_class="table";j.primary_key="__uid__";j.enabledMove=true;j.statusMove=true;j.enabledStatus=false;j.enabledHotkey=false;j.$globals={};j.statusElm=null;j.placeElm=null;j.$callbacks={accept:function(m,l){return true},beforeDrag:function(l){return true},dragStart:function(l){},dragMove:function(l){},dragStop:function(l,m){},beforeDrop:function(l){return true},calsIndent:function(p,m,l){var o=0,n=(l)?0:j.indent_plus;if(!m){o=j.indent_unit?j.indent_unit:"px"}if(p-1<1){return n+o}else{return j.indent*(p-1)+n+o}},dragEnabled:function(){return j.dragEnabled}};j.dropped=function(p,r){var u=p.node,l=p.target,n=p.scope;var m=null;var s=null;var t=0;if(u.__parent_real__===null){m=j.treeData;s=null}else{s=j.tree_rows[u.__parent_real__];m=s.__children__}var q=m;if(l!==null){if(l.__level__==p.level){if(u.__parent_real__!==l.__parent_real__){if(l.__parent_real__===null){q=j.treeData;s=null}else{s=j.tree_rows[l.__parent_real__];q=s.__children__}}t=l.__index__+1}else{if(l.__level__<p.level){q=l.__children__;s=l}else{while(l.__level__>p.level){if(l.__parent_real__!==null){l=j.tree_rows[l.__parent_real__]}else{break}}if(l.__parent_real__===null){q=j.treeData;s=null}else{s=j.tree_rows[l.__parent_real__];q=s.__children__}t=l.__index__+1}}}else{q=j.treeData;s=null}if(q!=m||u.__index__!=t){if(q===m){if(t>u.__index__){t--}}if(r==true){var o=m.splice(u.__index__,1)[0];q.splice(t,0,o)}p.move={parent:s,pos:t};return true}return false};j.accept=function(m,l){return j.$callbacks.accept(m,l)};j.beforeDrag=function(l){return j.$callbacks.beforeDrag(l)};j.getPrevGlobal=function(l){if(l>0){return j.tree_rows[l-1]}return null};j.getNextGlobal=function(l){if(l>0){return j.tree_rows[l-1]}return null};j.getHash=function(l){if(j.primary_key=="__uid__"){return"#"+l.__parent_real__+"#"+l.__index__+"#"+l.__uid__}else{return"#"+l.__parent_real__+"#"+l.__index__+"#"+l[j.primary_key]}};j.setScope=function(n,l){var m=j.getHash(n);if(j.$globals[m]!=l){j.$globals[m]=l}};j.getScope=function(l){return j.$globals[j.getHash(l)]};j.getScopeTree=function(){return j};j.enableMove=function(l){if((typeof l)==="boolean"){j.enabledMove=l}else{j.enabledMove=true}};j.setPositionStatus=function(l){if(j.statusElm){j.statusElm.css({left:l.pageX+10+"px",top:l.pageY+15+"px","z-index":9999});j.statusElm.addClass(j.config.statusClass)}};j.hideStatus=function(){if(j.statusElm){j.statusElm.addClass(j.config.hiddenClass)}};j.refreshStatus=function(){if(j.enabledStatus){var l=j.statusElm;if(j.enabledMove){j.statusElm=angular.element(e.getMove())}else{j.statusElm=angular.element(e.getCopy())}if(l){j.statusElm.attr("class",l.attr("class"));j.statusElm.attr("style",l.attr("style"));l.remove()}j.statusElm.removeClass(j.config.hiddenClass);f.find("body").append(j.statusElm)}};j.initPlace=function(n,p,o){var m=n.prop("tagName").toLowerCase();if(!j.placeElm){if(m.toLowerCase()=="tr"){j.placeElm=angular.element(g.document.createElement("tr"));var l=j.colDefinitions.length;j.placeElm.append(angular.element(g.document.createElement("td")).addClass(j.config.emptyTreeClass).addClass("indented").addClass(j.config.placeHolderClass));while(l-->0){j.placeElm.append(angular.element(g.document.createElement("td")).addClass(j.config.emptyTreeClass).addClass(j.config.placeHolderClass))}}else{j.placeElm=angular.element(g.document.createElement("li")).addClass(j.config.emptyTreeClass).addClass(j.config.placeHolderClass)}}else{j.placeElm.removeClass(j.config.hiddenClass)}if(m.toLowerCase()=="tr"){c.replaceIndent(j,j.placeElm,p)}n[0].parentNode.insertBefore(j.placeElm[0],n[0]);j.placeElm.css("height",c.height(o)+"px");return j.placeElm};j.hidePlace=function(){if(j.placeElm){j.placeElm.addClass(j.config.hiddenClass)}};j.showPlace=function(){if(j.placeElm){j.placeElm.removeClass(j.config.hiddenClass)}}}],link:function(i,j,s){i.$type="TreeTable";i.colDefinitions=[];i.$watch(s.enableStatus,function(n){if((typeof n)==="boolean"){i.enabledStatus=n}},true);i.$watch(s.enableMove,function(n){if((typeof n)==="boolean"){i.enabledMove=n;i.statusMove=n}},true);i.$watch(s.templateCopy,function(A){var n=null;if((typeof A)==="string"&&A.trim().length>0){n=A.trim()}else{n=s.templateCopy;if(n){n=n.trim();if(n.length==0&&!a.get(n)){n=null}}}if(n){if(a.get(n)){e.setCopy(n)}}},true);i.$watch(s.templateMove,function(A){var n=null;if((typeof A)==="string"&&A.trim().length>0){n=A.trim()}else{n=s.templateMove;if(n){n=n.trim();if(n.length==0&&!a.get(n)){n=null}}}if(n){if(a.get(n)){e.setMove(n)}}},true);if(!s.primaryKey){i.primary_key=="__uid__"}else{i.$watch(s.primaryKey,function(n){if(typeof n==="string"){i.primary_key=n}else{i.primary_key=s.primaryKey}},true)}i.$watch(s.callbacks,function(n){angular.forEach(n,function(B,A){if(typeof B==="function"){if(i.$callbacks[A]){i.$callbacks[A]=B}}})},true);if((typeof s["class"])==="string"){i.tree_class=s["class"].trim()}if((typeof s.indentUnit)==="string"){i.indent_unit=s.indentUnit}i.$watch(s.enableHotkey,function(n){if((typeof n)==="boolean"){i.enabledHotkey=n}if(i.enabledHotkey){i.enabledMove=false}else{i.enabledMove=i.statusMove}},true);i.$watch(s.enableDrag,function(n){if((typeof n)==="boolean"){i.dragEnabled=n}},true);i.$watch(s.indent,function(n){if((typeof n)=="number"){i.indent=n}},true);i.$watch(s.indentPlus,function(n){if((typeof n)=="number"){i.indent_plus=n}},true);i.$watch(s.dragDelay,function(n){if((typeof n)=="number"){i.dragDelay=n}});i.config={};angular.extend(i.config,d);i.$watch(s.config,function(n){angular.extend(i.config,n)},true);var p,w,t,q;s.iconExpand=s.iconExpand?s.iconExpand:"icon-plus  glyphicon glyphicon-plus  fa fa-plus";s.iconCollapse=s.iconCollapse?s.iconCollapse:"icon-minus glyphicon glyphicon-minus fa fa-minus";s.iconLeaf=s.iconLeaf?s.iconLeaf:"icon-file  glyphicon glyphicon-file  fa fa-file";s.expandLevel=s.expandLevel?s.expandLevel:"3";w=parseInt(s.expandLevel,10);if(!i.treeData){i.treeData=[]}var z=function(){if(i.treeData.length){var D=i.treeData[0],B=Object.keys(D),C=new RegExp("^__([a-zA-Z0-9_-]*)__$");for(var A=0,n=B.length;A<n;A++){if(typeof(D[B[A]])==="string"&&!C.test(B[A])){p=B[A];break}}if(!p){p=B[0]}i.expandingProperty=p}},v=function(){if(i.treeData.length){var A=[],C=i.treeData[0];var B=new RegExp("(^__([a-zA-Z0-9_-]*)__$|^"+p+"$)");for(var n in C){if(!B.test(n)){A.push({field:n})}}i.colDefinitions=A}};if(s.expandOn){p=i.expandOn||[];i.expandingProperty=i.expandOn||[]}if(s.columnDefs){if(!(angular.isArray(i.columnDefs)&&i.columnDefs.length>0)){v()}else{i.colDefinitions=i.columnDefs}}i.on_user_click=function(n){if(i.onClick){i.onClick({branch:n})}};i.user_clicks_branch=function(n){if(n!==y){return u(n)}};i.tree_rows=[];var y=null,o=function(D){var A,C,n,B;A=function(F,I){D(F,I);if(F.__children__!=null){var H,E,G;G=F.__children__;for(H=0,E=G.length;H<E;H++){A(G[H],I+1)}}};B=i.treeData;for(C=0,n=B.length;C<n;C++){A(B[C],1)}},u=function(n){if(!n){if(y!=null){y.__selected__=false}y=null;return}if(n!==y){if(y!=null){y.__selected__=false}n.__selected__=true;y=n;l(n);if(n.onSelect!=null){return b(function(){return n.onSelect(n)})}else{if(i.onSelect!=null){return b(function(){return i.onSelect({branch:n})})}}}},x=function(n){if(n.__parent_real__!==null&&n.__parent_real__>-1&&n.__parent_real__<i.tree_rows.length){return i.tree_rows[n.__parent_real__]}return null},r=function(B,A){var n;n=x(B);if(n!=null){A(n);return r(n,A)}},l=function(n){return r(n,function(A){return A.__expanded__=true})},h=function(){if(!s.expandOn){z()}if(!s.columnDefs){v()}var F,n;n=i.treeData;F=n.length;var A=[];if(F>0){var B,D;D=function(R,S,N,K,L,O){var M,Q,J;if(!angular.isArray(R.__children__)){R.__children__=[]}R.__parent_real__=N;R.__parent__=S;Q=R.__children__.length;if(R.__expanded__==null&&Q>0){R.__expanded__=K<w}if(Q===0){J=s.iconLeaf}else{if(R.__expanded__){J=s.iconCollapse}else{J=s.iconExpand}}var U=A.length;R.__index__=O;R.__index_real__=U;R.__level__=K;R.__tree_icon__=J;R.__visible__=L;if(R.__uid__==null){R.__uid__=""+Math.random()}A.push(R);var P=1;if(Q>0){for(M=0;M<Q;M++){P+=D(R.__children__[M],(i.primary_key=="__uid__")?R.__uid__:R[i.primary_key],U,K+1,L&&R.__expanded__,M)}}var T;if(i.primary_key=="__uid__"){T="#"+S+"#"+O+"#"+R.__uid__}else{T="#"+S+"#"+O+"#"+R[i.primary_key]}if(R.__hashKey__==null||R.__hashKey__!=T){R.__hashKey__=T;i.$globals[T]=null}R.__dept__=P;return P};var H=0;for(B=0;B<F;B++){H+=D(n[B],null,null,1,true,B)}var G,I,E=Object.keys(i.$globals),C=i.$globals.length;G=C-H;if(G!=0){I=C-G;_min=I-Math.abs(G);for(B=_min;B<I;B++){delete (i.$globals[E[B]])}}}i.tree_rows=A;return i.tree_rows},m=function(n){if(n.keyCode==27){i.hideStatus();i.$$apply=false;i.dragEnd(n)}else{if(i.enabledHotkey&&n.shiftKey){i.enableMove(true);i.refreshStatus()}}},k=function(n){if(i.enabledHotkey&&!n.shiftKey){i.enableMove(false);i.refreshStatus()}};i.$watch("treeData",h,true);h();angular.element(g.document.body).bind("keydown",m);angular.element(g.document.body).bind("keyup",k);i.$on("$destroy",function(){angular.element(g.document.body).unbind("keydown",m);angular.element(g.document.body).unbind("keyup",k);if(i.statusElm){i.statusElm.remove()}if(i.placeElm){i.placeElm.remove()}});if(i.tree!=null){if(angular.isObject(i.tree)){q=i.tree;q.expand_all=function(){o(function(n,A){n.__expanded__=true})};q.collapse_all=function(){o(function(n,A){n.__expanded__=false})};q.get_first_branch=function(){t=i.treeData.length;if(t>0){return i.treeData[0]}return null};q.select_first_branch=function(){var n;n=q.get_first_branch();return q.select_branch(n)};q.get_selected_branch=function(){return y};q.get_parent_branch=function(n){return x(n)};q.select_branch=function(n){u(n);return n};q.get_children=function(n){return n.__children__};q.select_parent_branch=function(n){var A;if(n==null){n=q.get_selected_branch()}if(n!=null){A=q.get_parent_branch(n);if(A!=null){q.select_branch(A);return A}}};q.add_branch=function(A,B,n){if((typeof n)!="number"){if(A!=null){A.__children__.push(B);A.__expanded__=true}else{i.treeData.push(B)}}else{if(A!=null){A.__children__.splice(n,0,B);A.__expanded__=true}else{i.treeData.splice(n,0,B)}}return B};q.add_root_branch=function(n){q.add_branch(null,n);return n};q.remove_branch=function(B){B=B||q.get_selected_branch();if(B){var A;if(B.__parent_real__!==null){A=q.get_parent_branch(B).__children__}else{A=i.treeData}var n=A.indexOf(B);A.splice(n,1);y=null}};q.expand_branch=function(n){if(n==null){n=q.get_selected_branch()}if(n!=null){n.__expanded__=true;return n}};q.collapse_branch=function(n){if(n==null){n=y}if(n!=null){n.__expanded__=false;return n}};q.get_siblings=function(n){var A,B;if(n==null){n=y}if(n!=null){A=q.get_parent_branch(n);if(A){B=A.__children__}else{B=i.treeData}return B}};q.get_next_sibling=function(n){var A,B;if(n==null){n=y}if(n!=null){B=q.get_siblings(n);t=B.length;A=B.indexOf(n);if(A<t){return B[A+1]}}};q.get_prev_sibling=function(n){var A,B;if(n==null){n=y}B=q.get_siblings(n);t=B.length;A=B.indexOf(n);if(A>0){return B[A-1]}};q.select_next_sibling=function(n){var A;if(n==null){n=y}if(n!=null){A=q.get_next_sibling(n);if(A!=null){return q.select_branch(A)}}};q.select_prev_sibling=function(n){var A;if(n==null){n=y}if(n!=null){A=q.get_prev_sibling(n);if(A!=null){return q.select_branch(A)}}};q.get_first_child=function(n){var A;if(n==null){n=y}if(n!=null){if(((A=n.__children__)!=null?A.length:void 0)>0){return n.__children__[0]}}};q.get_closest_ancestor_next_sibling=function(n){var B,A;B=q.get_next_sibling(n);if(B!=null){return B}else{A=q.get_parent_branch(n);return q.get_closest_ancestor_next_sibling(A)}};q.get_next_branch=function(n){var A;if(n==null){n=y}if(n!=null){A=q.get_first_child(n);if(A!=null){return A}else{A=q.get_closest_ancestor_next_sibling(n);return A}}};q.select_next_branch=function(n){var A;if(n==null){n=y}if(n!=null){A=q.get_next_branch(n);if(A!=null){q.select_branch(A);return A}}};q.last_descendant=function(n){var A;if(n==null){}t=n.__children__.length;if(t===0){return n}else{A=n.__children__[t-1];return q.last_descendant(A)}};q.get_prev_branch=function(n){var A,B;if(n==null){n=y}if(n!=null){B=q.get_prev_sibling(n);if(B!=null){return q.last_descendant(B)}else{A=q.get_parent_branch(n);return A}}};q.reload_data=function(){return h()};q.select_prev_branch=function(n){var A;if(n==null){n=y}if(n!=null){A=q.get_prev_branch(n);if(A!=null){q.select_branch(A);return A}}}}}angular.element(j).ready(function(){var P="ontouchstart" in window,V,L,B,G,A,S,D=true,E=false,C=null,J=document.body,K=document.documentElement,M,F,I,R=function(ac){if(!P&&(ac.button==2||ac.which==3)){return}if(ac.uiTreeDragging||(ac.originalEvent&&ac.originalEvent.uiTreeDragging)){return}var af=angular.element(ac.target);var aa=af.scope();if(!aa||!aa.$type){return}if(aa.$type!="TreeTableNode"&&aa.$type!="TreeTableNodeHandle"){return}if(aa.$type!="TreeTableNodeHandle"){return}var Y=af.prop("tagName").toLowerCase(),ae=null;if(Y=="input"||Y=="textarea"||Y=="button"||Y=="select"){return}while(af&&af[0]&&af[0]!=j){if(c.nodrag(af)){return}af=af.parent()}ae=aa.getScopeNode();if(!i.beforeDrag(ae)){return}ac.uiTreeDragging=true;if(ac.originalEvent){ac.originalEvent.uiTreeDragging=true}ac.preventDefault();var ad=c.eventObj(ac);L=true;B=c.dragInfo(ae);var X=ae.$element.prop("tagName").toLowerCase();G=c.positionStarted(ad,ae.$element);if(X==="tr"){S=angular.element(g.document.createElement("table")).addClass(i.config.treeClass).addClass(i.config.dragClass).addClass(i.tree_class)}else{S=angular.element(g.document.createElement("ul")).addClass(i.config.dragClass).addClass("tree-table-rows").addClass(i.tree_class)}S.css({width:c.width(ae.$element)+"px","z-index":9995});i.refreshStatus();i.setPositionStatus(ac);I=0;var Z=c.width(ae.$element);if(X=="tr"){var ab=angular.element(g.document.createElement("tbody"));I=ae.node().__level__-1;var W=function(ak){var ag,ai,al,ah,am,aj;ag=i.getScope(ak);ai=ag.$element;aj=ai.clone();c.replaceIndent(ag,aj,ak.__level__-I,"padding-left");ab.append(aj);if(i.config.hiddenClass){ai.addClass(i.config.hiddenClass)}am=ak.__children__;ah=am.length;for(al=0;al<ah;al++){W(am[al])}};W(ae.node());S.append(ab)}else{S.append(ae.$element.clone());if(i.config.hiddenClass){ae.$element.addClass(i.config.hiddenClass)}}S.css({left:ad.pageX-G.offsetX+i.$callbacks.calsIndent(I+1,true,true)+"px",top:ad.pageY-G.offsetY+"px"});f.find("body").append(S);A=i.initPlace(ae.$element,B.level,S);A.css("width",Z);angular.element(f).bind("touchend",H);angular.element(f).bind("touchcancel",H);angular.element(f).bind("touchmove",O);angular.element(f).bind("mouseup",H);angular.element(f).bind("mousemove",O);angular.element(f).bind("mouseleave",U);M=Math.max(J.scrollHeight,J.offsetHeight,K.clientHeight,K.scrollHeight,K.offsetHeight);F=Math.max(J.scrollWidth,J.offsetWidth,K.clientWidth,K.scrollWidth,K.offsetWidth)},T=function(ao){if(!E){if(!D){E=true;i.$apply(function(){i.$callbacks.dragStart(B)})}return}var W=c.eventObj(ao);var ak,aq,ab;if(S){ao.preventDefault();if(g.getSelection){g.getSelection().removeAllRanges()}else{if(g.document.selection){g.document.selection.empty()}}aq=W.pageX-G.offsetX;ab=W.pageY-G.offsetY;if(aq<0){aq=0}if(ab<0){ab=0}if((ab+10)>M){ab=M-10}if((aq+10)>F){aq=F-10}S.css({left:aq+i.$callbacks.calsIndent(I+1,true,true)+"px",top:ab+"px"});i.setPositionStatus(ao);var Z=window.pageYOffset||g.document.documentElement.scrollTop;var ad=Z+(window.innerHeight||g.document.clientHeight||g.document.clientHeight);if(ad<W.pageY&&ad<=M){window.scrollBy(0,10)}if(Z>W.pageY){window.scrollBy(0,-10)}c.positionMoved(ao,G,L);if(L){L=false;return}var ah=W.pageX-g.document.body.scrollLeft;var ag=W.pageY-(window.pageYOffset||g.document.documentElement.scrollTop);var Y=angular.element(g.document.elementFromPoint(ah,ag)),am=Y.scope(),X=null,af,ac=false;if(am&&angular.isFunction(am.getScopeNode)){am=am.getScopeNode();af=am.getScopeTree();X=am.$element.prop("tagName").toLowerCase();if(B.tree!==af){B.tree.hidePlace();B.tree=af;B.tree.showPlace();ac=true}}if(!G.dirAx||ac){if(!am){return}Y=am.$element;var aa,ap=c.offset(Y);if(X=="tr"){aa=W.pageY<(ap.top+c.height(Y)/2)}else{var ar=c.height(Y)-c.height(am.elementChilds);if(W.pageY>ap.top+ar){return}aa=W.pageY<(ap.top+ar/2)}A=am.initPlace(Y,B.level,S);A.css("width",c.width(Y));if(am.$callbacks.dragEnabled()){if(am.accept(B,aa)){B.level=am.node().__level__;if(aa){var ae;if(B.isDirty(am.getScopeTree(),am.node().__index_real__-1)){ae=am.getPrevGlobal(B.node.__index_real__)}else{ae=am.prev()}B.target=ae;B.scope=am.getScope(ae);if(X=="tr"){c.replaceIndent(am,A,B.level)}Y[0].parentNode.insertBefore(A[0],Y[0])}else{B.target=am.node();B.scope=am;var aj=B.level;if(am.data().__expanded__){B.level=++aj;if(X=="tr"){c.replaceIndent(am,A,aj);Y.after(A)}else{am.elementChilds.prepend(A)}}else{if(X=="tr"){c.replaceIndent(am,A,aj)}Y.after(A)}}}}}else{am=B.scope;X=am.$element.prop("tagName").toLowerCase();if(G.dirAx&&G.distAxX>=am.config.levelThreshold){G.distAxX=0;var ae=B.target;if(ae){if(G.distX>0){var ai=am.visible(ae);if(ai!=null&&ai.__level__>=B.level){B.level++;if(X=="tr"){c.replaceIndent(am,A,B.level)}else{var al=am.getScope(ai);al.elementChilds.append(A)}}}else{if(G.distX<0){var an=B.canIndent();if(an==null||an){B.level=B.level-1;if(X=="tr"){c.replaceIndent(am,A,B.level)}else{var al=am.getScope(an);al.$element.after(A)}}}}}}}i.$apply(function(){i.$callbacks.dragMove(B)})}},N=function(aa){aa.preventDefault();if(S){var X=false;i.$apply(function(){X=i.$callbacks.beforeDrop(B)});var Y=B.drag.$element.prop("tagName").toLowerCase();if(Y=="tr"){var W=function(ae){var ab,ad,af,ac,ag;ab=i.getScope(ae);ad=ab.$element;if(i.config.hiddenClass){ad.removeClass(i.config.hiddenClass)}ag=ae.__children__;ac=ag.length;for(af=0;af<ac;af++){W(ag[af])}};W(B.drag.node())}else{if(i.config.hiddenClass){B.drag.$element.removeClass(i.config.hiddenClass)}}S.remove();S=null;B.tree.hidePlace();i.hideStatus();var Z=false;if(i.$$apply){i.$apply(function(){Z=i.dropped(B,X)})}else{Q()}i.$apply(function(){i.$callbacks.dragStop(B,Z)});i.$$apply=false;B=null}angular.element(f).unbind("touchend",H);angular.element(f).unbind("touchcancel",H);angular.element(f).unbind("touchmove",O);angular.element(f).unbind("mouseup",H);angular.element(f).unbind("mousemove",O);angular.element(g.document.body).unbind("mouseleave",U)},n=function(W){if(i.$callbacks.dragEnabled()){R(W)}},O=function(W){T(W)},H=function(W){i.$$apply=true;i.dragEnd(W)},U=function(W){i.dragEnd(W)},Q=function(){j.bind("touchstart mousedown",function(W){D=true;E=false;n(W);C=b(function(){D=false},i.dragDelay)});j.bind("touchend touchcancel mouseup",function(){b.cancel(C)})};i.dragEnd=function(W){N(W)};Q()})}}}]).directive("treeTableNode",["$window","$document","$timeout","$TreeTableHelper","treeTableTemplate",function(e,d,a,c,b){return{restrict:"A",replace:true,controller:["$scope","$element","$attrs","tgConfig",function(h,g,f,i){h.$modelValue=null;h.$scopeChildren=null;h.elementChilds=null;h.childNodesCount=function(){return h.childNodes().length};h.childNodes=function(){return h.$modelValue.__children__};h.expand=function(j){if(j.__children__.length>0){j.__expanded__=!j.__expanded__}};h.prev=function(){return h.getPrevGlobal(h.$modelValue.__index_real__)};h.next=function(){return h.getNextGlobal(h.$modelValue.__index_real__)};h.node=function(){return h.$modelValue};h.data=function(){return h.$modelValue};h.visible=function(j){if(j!=null){return j.__visible__?j:h.visible(h.tree_rows[j.__parent_real__])}return null};h.setElementChilds=function(j){h.elementChilds=j};h.getScopeNode=function(){return h}}],link:function(h,g,f){h.$element=g;h.$type="TreeTableNode";if(h.config.nodeClass){g.addClass(h.config.nodeClass)}h.$watch(f.treeTableNode,function(i){h.setScope(i,h);h.$modelValue=i},true)}}}]).directive("treeTableNodes",function(){return{restrict:"A",replace:true,controller:["$scope","$element","$attrs","tgConfig",function(c,b,a,d){c.datas=[]}],link:function(c,b,a){c.$type="TreeTableNodes";c.$element=b;if(c.setElementChilds){c.setElementChilds(b)}c.$watch(a.treeTableNodes,function(f,d,e){e.datas=f},true);c.$element=b}}}).directive("treeTableNodeHandle",function(){return{restrict:"A",scope:true,controller:["$scope","$element","$attrs","tgConfig",function(c,b,a,d){}],link:function(c,b,a){c.$element=b;c.$type="TreeTableNodeHandle";if(c.config.handleClass){b.addClass(c.config.handleClass)}}}}).factory("treeTableTemplate",["$templateCache",function(a){var c="template/treeTable/treeTable.html";var b="template/treeTable/treeTableStatusCopy.html";var d="template/treeTable/treeTableStatusMove.html";return{setMove:function(e){d=e},setCopy:function(e){b=e},getPath:function(){return c},getCopy:function(){var e=a.get(b);if(e){return e}return a.get("template/treeTable/treeTableStatusCopy.html")},getMove:function(){var e=a.get(d);if(e){return e}return a.get("template/treeTable/treeTableStatusMove.html")}}}]).factory("$TreeTableHelper",["$document","$window",function(b,a){return{calsIndent:null,isUndefinedOrNull:function(c){return angular.isUndefined(c)||c===null},nodrag:function(c){return(typeof c.attr("data-nodrag"))!="undefined"},eventObj:function(d){var c=d;if(d.targetTouches!==undefined){c=d.targetTouches.item(0)}else{if(d.originalEvent!==undefined&&d.originalEvent.targetTouches!==undefined){c=d.originalEvent.targetTouches.item(0)}}return c},dragInfo:function(c){return{node:c.node(),level:c.node().__level__,target:c.prev(),scope:c,drag:c,tree:c.getScopeTree(),move:{parent:-1,pos:-1},isDirty:function(e,d){return(this.tree==e)&&this.node.__index_real__<=d&&d<=this.node.__index_real__+this.node.__dept__-1},canIndent:function(){if(this.level==1){return false}var d=this.target;var e=d;while(d){if(d.__level__<this.level){if(d.__expanded__){if(d.__children__.length==0){return d}else{if((d.__index_real__==this.target.__parent_real__&&d.__children__.length-1==this.target.__index__)||(d.__index_real__==e.__parent_real__&&d.__children__.length-1==e.__index__)||(d.__index_real__==this.node.__parent_real__&&d.__children__.length-1==this.node.__index__)){return d}}return false}return d}else{if(d.__parent_real__==null){return null}else{e=d;d=this.scope.tree_rows[d.__parent_real__]}}}return false},canInsert:function(d){if(d.__children__.length==0){return true}else{if((d.__index_real__==this.target.__parent_real__&&d.__children__.length-1==this.target.__index__)||(d.__index_real__==this.node.__parent_real__&&d.__children__.length-1==this.node.__index__)){return d}}return false}}},height:function(c){return c.prop("scrollHeight")},width:function(c){return c.prop("scrollWidth")},offset:function(c){var d=c[0].getBoundingClientRect();return{width:c.prop("offsetWidth"),height:c.prop("offsetHeight"),top:d.top+(a.pageYOffset||b[0].body.scrollTop||b[0].documentElement.scrollTop),left:d.left+(a.pageXOffset||b[0].body.scrollLeft||b[0].documentElement.scrollLeft)}},positionStarted:function(d,c){var f={};f.offsetX=d.pageX-this.offset(c).left;f.offsetY=d.pageY-this.offset(c).top;f.startX=f.lastX=d.pageX;f.startY=f.lastY=d.pageY;f.nowX=f.nowY=f.distX=f.distY=f.dirAx=0;f.dirX=f.dirY=f.lastDirX=f.lastDirY=f.distAxX=f.distAxY=0;return f},positionMoved:function(f,g,d){g.lastX=g.nowX;g.lastY=g.nowY;g.nowX=f.pageX;g.nowY=f.pageY;g.distX=g.nowX-g.lastX;g.distY=g.nowY-g.lastY;g.lastDirX=g.dirX;g.lastDirY=g.dirY;g.dirX=g.distX===0?0:g.distX>0?1:-1;g.dirY=g.distY===0?0:g.distY>0?1:-1;var c=Math.abs(g.distX)>Math.abs(g.distY)?1:0;if(d){g.dirAx=c;g.moving=true;return}if(g.dirAx!==c){g.distAxX=0;g.distAxY=0}else{g.distAxX+=Math.abs(g.distX);if(g.dirX!==0&&g.dirX!==g.lastDirX){g.distAxX=0}g.distAxY+=Math.abs(g.distY);if(g.dirY!==0&&g.dirY!==g.lastDirY){g.distAxY=0}}g.dirAx=c},replaceIndent:function(f,e,d,c){c=c?c:"left";angular.element(e.children()[0]).css(c,f.$callbacks.calsIndent(d))}}}]).factory("$TreeTableConvert",function(){return{line2tree:function(d,j,h){if(!d||d.length==0||!j||!h){return[]}var m=[],a=[],k=d[0],b=k[j],l={},e,g,f=d.length,c=0;while(c<f){k=d[c++];b=k[j];l[b]=k;e=k[h];if(e){g=l[e];if(g.__children__){g.__children__.push(k)}else{g.__children__=[k]}}else{a.push(b)}}f=a.length;for(c=0;c<f;c++){m.push(l[a[c]])}return m},tree2tree:function(c,a){var b=function(g){var i=[];var f,d=g.length,h,e;for(f=0;f<d;f++){h=angular.copy(g[f]);if(angular.isArray(h[a])&&h[a].length>0){e=b(h[a]);delete (h[a]);h.__children__=e}i.push(h)}return i};return b(c)}}}).constant("tgConfig",{treeClass:"tree-table",emptyTreeClass:"tree-table-empty",hiddenClass:"tree-table-hidden",nodeClass:"tree-table-row",nodesClas:"tree-table-rows",handleClass:"tree-table-handle",placeHolderClass:"tree-table-placeholder",dragClass:"tree-table-drag",statusClass:"tree-table-status",levelThreshold:30})}).call(window);
>>>>>>> master
=======
(function(){angular.module("template/treeTable/treeTable.html",[]).run(["$templateCache",function(a){a.put("template/treeTable/treeTable.html",'<table ng-class="tree_class">\n    <thead>\n  <tr>\n     <th ng-class="expandingProperty.titleClass" ng-style="expandingProperty.titleStyle">\n         {{expandingProperty.displayName || expandingProperty.field || expandingProperty}}\n        </th>\n        <th ng-repeat="col in colDefinitions" ng-class="col.titleClass" ng-style="col.titleStyle">\n         {{col.displayName || col.field}}\n     </th>\n    </tr>\n    </thead>\n <tbody>\n  <tr tree-table-node="row" ng-repeat="row in tree_rows track by row.__hashKey__ " ng-show="row.__visible__"\n     ng-class="(row.__selected__ ? \' active\':\'\')">\n        <td ng-if="!expandingProperty.template" tree-table-node-handle\n         ng-style="expandingProperty.cellStyle ? expandingProperty.cellStyle : {\'padding-left\': $callbacks.calsIndent(row.__level__)}"\n          ng-click="onSelect(row)" ng-class="expandingProperty.cellClass"\n            compile="expandingProperty.cellTemplate">\n              <a data-nodrag>\n                  <i ng-class="$iconClass" ng-click="row.__expanded__ = !row.__expanded__"\n                     class="tree-icon"></i>\n              </a>\n             {{row[expandingProperty.field] || row[expandingProperty]}}\n       </td>\n        <td ng-if="expandingProperty.template" compile="expandingProperty.template"></td>\n        <td ng-repeat="col in colDefinitions" ng-class="col.cellClass" ng-style="col.cellStyle"\n            compile="col.cellTemplate">\n            {{row[col.field]}}\n       </td>\n    </tr>\n    </tbody>\n</table>');a.put("template/treeTable/treeTableStatusCopy.html",'<label><i class="fa fa-copy"></i>&nbsp;<b>Copying</b></label>');a.put("template/treeTable/treeTableStatusMove.html",'<label><i class="fa fa-file-text"></i>&nbsp;<b>Moving</b></label>')}]);angular.module("treeTable",["template/treeTable/treeTable.html"]).directive("compile",["$compile",function(a){return{restrict:"A",link:function(d,c,b){d.$watch(b.compile,function(e){if(e!=null){var f=a(e);var g=f(d);c.empty().append(g)}})}}}]).directive("treeTable",["$timeout","$http","$compile","$window","$document","treeTableTemplate","tgConfig","$TreeTableHelper","$templateCache",function(b,h,f,a,d,g,e,i,c){return{restrict:"E",replace:true,scope:{treeData:"=",on_select:"&onSelect",on_click:"&onClick",tree:"=treeControl",tree_data:"=treeData",expandOn:"=",columnDefs:"=",callbacks:"=",primaryKey:"="},controller:["$scope","$element","$attrs","tgConfig",function(l,k,j,m){l.dragEnabled=true;l.dragDelay=0;l.indent=20;l.indent_plus=15;l.indent_unit="px";l.tree_class="table";l.primary_key="__uid__";l.enabledMove=true;l.statusMove=true;l.enabledStatus=false;l.enabledHotkey=false;l.$globals={};l.config={};l.statusElm=null;l.placeElm=null;l.toggleExpand=function(n){if(n.__children__.length>0){n.__expanded__=!n.__expanded__}};l.classIcon={};l.$callbacks={accept:function(o,n){return true},beforeDrag:function(n){return true},dragStart:function(n){},dragMove:function(n){},dragStop:function(n,o){},beforeDrop:function(n){return true},calsIndent:function(r,o,n){var q=0,p=(n)?0:l.indent_plus;if(!o){q=l.indent_unit?l.indent_unit:"px"}if(r-1<1){return p+q}else{return l.indent*(r-1)+p+q}},dragEnabled:function(){return l.dragEnabled},dropped:function(t,s,n){var p=t.node,u=t.parent||t.drag.treeData,o=t.move,q=o.parent||t.scope.treeData,r;if(q!=-1){if(n==true){r=u;if(r.__children__){r=r.__children__}p=r.splice(p.__index__,1)[0]}else{p=angular.copy(p);p.__uid__=null}if(t.drag==t.scope&&u==q&&o.pos>=t.node.__index__){o.pos--}if(o.pos>-1){r=q;if(r.__children__){r=r.__children__}r.splice(o.pos,0,p)}else{}return true}return false}};l.accept=function(o,n){return l.$callbacks.accept(o,n)};l.beforeDrag=function(n){return l.$callbacks.beforeDrag(n)};l.getPrevGlobal=function(n){if(n>0){return l.tree_rows[n-1]}return null};l.getNextGlobal=function(n){if(n>0){return l.tree_rows[n-1]}return null};l.getNode=function(n){if(n==null){return null}return l.tree_rows[n]};l.getHash=function(n){if(l.primary_key=="__uid__"){return"#"+n.__parent__+"#"+n.__index__+"#"+n.__uid__}else{return"#"+n.__parent__+"#"+n.__index__+"#"+n[l.primary_key]}};l.setScope=function(p,n){var o=l.getHash(p);if(l.$globals[o]!=n){l.$globals[o]=n}};l.getScope=function(n){if(n){return l.$globals[l.getHash(n)]}else{return l}};l.enableMove=function(n){if((typeof n)==="boolean"){l.enabledMove=n}else{l.enabledMove=true}};l.setPositionStatus=function(n){if(l.statusElm){l.statusElm.css({left:n.pageX+10+"px",top:n.pageY+15+"px","z-index":9999});l.statusElm.addClass(l.config.statusClass)}};l.hideStatus=function(){if(l.statusElm){l.statusElm.addClass(l.config.hiddenClass)}};l.refreshStatus=function(){if(l.enabledStatus){var n=l.statusElm;if(l.enabledMove){l.statusElm=angular.element(g.getMove())}else{l.statusElm=angular.element(g.getCopy())}if(n==l.statusElm){l.statusElm.removeClass(l.config.hiddenClass)}else{if(n){l.statusElm.attr("class",n.attr("class"));l.statusElm.attr("style",n.attr("style"));n.remove()}l.statusElm.removeClass(l.config.hiddenClass);d.find("body").append(l.statusElm)}}};l.initPlace=function(p,r,q){var o=p.prop("tagName").toLowerCase();if(!l.placeElm){if(o.toLowerCase()=="tr"){l.placeElm=angular.element(a.document.createElement("tr"));var n=l.colDefinitions.length;l.placeElm.append(angular.element(a.document.createElement("td")).addClass(l.config.emptyTreeClass).addClass("indented").addClass(l.config.placeHolderClass));while(n-->0){l.placeElm.append(angular.element(a.document.createElement("td")).addClass(l.config.emptyTreeClass).addClass(l.config.placeHolderClass))}}else{l.placeElm=angular.element(a.document.createElement("li")).addClass(l.config.emptyTreeClass).addClass(l.config.placeHolderClass)}}else{l.placeElm.removeClass(l.config.hiddenClass)}if(o.toLowerCase()=="tr"){i.replaceIndent(l,l.placeElm,r)}p[0].parentNode.insertBefore(l.placeElm[0],p[0]);l.placeElm.css("height",i.height(q)+"px");return l.placeElm};l.onClick=function(n){if(angular.isFunction(l.on_click)){l.on_click({branch:n})}};l.onSelect=function(n){if(n!==selected_branch){select_branch(n)}if(angular.isFunction(l.on_select)){l.on_select({branch:n})}};l.hidePlace=function(){if(l.placeElm){l.placeElm.addClass(l.config.hiddenClass)}};l.showPlace=function(){if(l.placeElm){l.placeElm.removeClass(l.config.hiddenClass)}}}],link:function(k,l,u){k.$type="TreeTable";k.colDefinitions=[];k.$watch(u.enableStatus,function(n){if((typeof n)==="boolean"){k.enabledStatus=n}},true);k.$watch(u.enableMove,function(n){if((typeof n)==="boolean"){k.enabledMove=n;k.statusMove=n}},true);k.$watch(u.templateCopy,function(C){var n=null;if((typeof C)==="string"&&C.trim().length>0){n=C.trim()}else{n=u.templateCopy;if(n){n=n.trim();if(n.length==0&&!c.get(n)){n=null}}}if(n){if(c.get(n)){g.setCopy(n)}}},true);k.$watch(u.templateMove,function(C){var n=null;if((typeof C)==="string"&&C.trim().length>0){n=C.trim()}else{n=u.templateMove;if(n){n=n.trim();if(n.length==0&&!c.get(n)){n=null}}}if(n){if(c.get(n)){g.setMove(n)}}},true);if(!u.primaryKey){k.primary_key=="__uid__"}else{k.$watch(u.primaryKey,function(n){if(typeof n==="string"){k.primary_key=n}else{k.primary_key=u.primaryKey}},true)}k.$watch(u.callbacks,function(n){angular.forEach(n,function(D,C){if(typeof D==="function"){if(k.$callbacks[C]){k.$callbacks[C]=D}}})},true);if((typeof u["class"])==="string"){k.tree_class=u["class"].trim()}if((typeof u.indentUnit)==="string"){k.indent_unit=u.indentUnit}k.$watch(u.enableHotkey,function(n){if((typeof n)==="boolean"){k.enabledHotkey=n}if(k.enabledHotkey){k.enabledMove=false}else{k.enabledMove=k.statusMove}},true);k.$watch(u.enableDrag,function(n){if((typeof n)==="boolean"){k.dragEnabled=n}},true);k.$watch(u.indent,function(n){if((typeof n)=="number"){k.indent=n}else{if((typeof u.indent)=="number"){k.indent=n}}},true);k.$watch(u.indentPlus,function(n){if((typeof n)=="number"){k.indent_plus=n}else{if((typeof u.indentPlus)=="number"){k.indent_plus=n}}},true);k.$watch(u.dragDelay,function(n){if((typeof n)=="number"){k.dragDelay=n}else{if((typeof u.dragDelay)=="number"){k.dragDelay=n}}},true);k.config={};angular.extend(k.config,e);k.$watch(u.config,function(n){angular.extend(k.config,n)},true);var r,y,v,s;k.classIcon={"1":u.iconExpand?u.iconExpand:"glyphicon glyphicon-minus","0":u.iconCollapse?u.iconCollapse:"glyphicon glyphicon-plus","-1":u.iconLeaf?u.iconLeaf:"glyphicon glyphicon-file"};u.expandLevel=u.expandLevel?u.expandLevel:"3";y=parseInt(u.expandLevel,10);if(!k.treeData){k.treeData=[]}var B=function(){if(k.treeData.length){var F=k.treeData[0],D=Object.keys(F),E=new RegExp("^__([a-zA-Z0-9_-]*)__$");for(var C=0,n=D.length;C<n;C++){if(typeof(F[D[C]])==="string"&&!E.test(D[C])){r=D[C];break}}if(!r){r=D[0]}k.expandingProperty=r}},x=function(){if(k.treeData.length){var C=[],E=k.treeData[0];var D=new RegExp("(^__([a-zA-Z0-9_-]*)__$|^"+r+"$)");for(var n in E){if(!D.test(n)){C.push({field:n})}}k.colDefinitions=C}};if(u.expandOn){r=k.expandOn||[];k.expandingProperty=k.expandOn||[]}if(u.columnDefs){if(!(angular.isArray(k.columnDefs))){x()}else{k.colDefinitions=k.columnDefs}}k.tree_rows=[];var A=null,q=function(F){var C,E,n,D;C=function(H,K){F(H,K);if(H.__children__!=null){var J,G,I;I=H.__children__;for(J=0,G=I.length;J<G;J++){C(I[J],K+1)}}};D=k.treeData;for(E=0,n=D.length;E<n;E++){C(D[E],1)}},w=function(n){if(!n){if(A!=null){A.__selected__=false}A=null;return}if(n!==A){if(A!=null){A.__selected__=false}n.__selected__=true;A=n;o(n);if(angular.isFunction(k.onSelect)){return b(function(){return k.onSelect(n)})}}},z=function(n){if(n.__parent_real__!==null&&n.__parent_real__>-1&&n.__parent_real__<k.tree_rows.length){return k.tree_rows[n.__parent_real__]}return null},t=function(D,C){var n;n=z(D);if(n!=null){C(n);return t(n,C)}},o=function(n){return t(n,function(C){return C.__expanded__=true})},j=function(){if(!u.expandOn){B()}if(!u.columnDefs){x()}var H,n;n=k.treeData;H=n.length;var C=[];if(H>0){var D,F;F=function(T,U,P,L,M,Q){var N,S,O;if(!angular.isArray(T.__children__)){T.__children__=[]}T.__parent_real__=P;T.__parent__=U;S=T.__children__.length;if(T.__expanded__==null&&S>0){T.__expanded__=L<y}if(S===0){O=-1}else{if(T.__expanded__){O=1}else{O=0}}var W=C.length;T.__index__=Q;T.__index_real__=W;T.__level__=L;T.__icon__=O;T.__visible__=M;if(T.__uid__==null){T.__uid__=""+Math.random()}C.push(T);var R=1;if(S>0){for(N=0;N<S;N++){R+=F(T.__children__[N],(k.primary_key=="__uid__")?T.__uid__:T[k.primary_key],W,L+1,M&&T.__expanded__,N)}}var V;if(k.primary_key=="__uid__"){V="#"+P+"#"+W+"#"+T.__uid__}else{V="#"+P+"#"+W+"#"+T[k.primary_key]}if(T.__hashKey__==null||T.__hashKey__!=V){T.__hashKey__=V;k.$globals[V]=null}T.__dept__=R;return R};var J=0;for(D=0;D<H;D++){J+=F(n[D],null,null,1,true,D)}var I,K,G=Object.keys(k.$globals),E=k.$globals.length;I=E-J;if(I!=0){K=E-I;_min=K-Math.abs(I);for(D=_min;D<K;D++){delete (k.$globals[G[D]])}}}k.tree_rows=C;return k.tree_rows},p=function(n){if(n.keyCode==27){k.hideStatus();k.$$apply=false;k.dragEnd(n)}else{if(k.enabledHotkey&&n.shiftKey){k.enableMove(true);k.refreshStatus()}}},m=function(n){if(k.enabledHotkey&&!n.shiftKey){k.enableMove(false);k.refreshStatus()}};k.$watch("treeData",j,true);j();angular.element(a.document.body).bind("keydown",p);angular.element(a.document.body).bind("keyup",m);k.$on("$destroy",function(){angular.element(a.document.body).unbind("keydown",p);angular.element(a.document.body).unbind("keyup",m);if(k.statusElm){k.statusElm.remove()}if(k.placeElm){k.placeElm.remove()}});if(k.tree!=null){if(angular.isObject(k.tree)){s=k.tree;s.expand_all=function(){q(function(n,C){n.__expanded__=true})};s.collapse_all=function(){q(function(n,C){n.__expanded__=false})};s.get_first_branch=function(){v=k.treeData.length;if(v>0){return k.treeData[0]}return null};s.select_first_branch=function(){var n;n=s.get_first_branch();return s.select_branch(n)};s.get_selected_branch=function(){return A};s.get_parent_branch=function(n){return z(n)};s.select_branch=function(n){w(n);return n};s.get_children=function(n){return n.__children__};s.select_parent_branch=function(n){var C;if(n==null){n=s.get_selected_branch()}if(n!=null){C=s.get_parent_branch(n);if(C!=null){s.select_branch(C);return C}}};s.add_branch=function(C,D,n){if((typeof n)!="number"){if(C!=null){C.__children__.push(D);C.__expanded__=true}else{k.treeData.push(D)}}else{if(C!=null){C.__children__.splice(n,0,D);C.__expanded__=true}else{k.treeData.splice(n,0,D)}}return D};s.add_root_branch=function(n){s.add_branch(null,n);return n};s.remove_branch=function(D){D=D||s.get_selected_branch();if(D){var C;if(D.__parent_real__!==null){C=s.get_parent_branch(D).__children__}else{C=k.treeData}var n=C.indexOf(D);C.splice(n,1);A=null}};s.expand_branch=function(n){if(n==null){n=s.get_selected_branch()}if(n!=null){n.__expanded__=true;return n}};s.collapse_branch=function(n){if(n==null){n=A}if(n!=null){n.__expanded__=false;return n}};s.get_siblings=function(n){var C,D;if(n==null){n=A}if(n!=null){C=s.get_parent_branch(n);if(C){D=C.__children__}else{D=k.treeData}return D}};s.get_next_sibling=function(n){var C,D;if(n==null){n=A}if(n!=null){D=s.get_siblings(n);v=D.length;C=D.indexOf(n);if(C<v){return D[C+1]}}};s.get_prev_sibling=function(n){var C,D;if(n==null){n=A}D=s.get_siblings(n);v=D.length;C=D.indexOf(n);if(C>0){return D[C-1]}};s.select_next_sibling=function(n){var C;if(n==null){n=A}if(n!=null){C=s.get_next_sibling(n);if(C!=null){return s.select_branch(C)}}};s.select_prev_sibling=function(n){var C;if(n==null){n=A}if(n!=null){C=s.get_prev_sibling(n);if(C!=null){return s.select_branch(C)}}};s.get_first_child=function(n){var C;if(n==null){n=A}if(n!=null){if(((C=n.__children__)!=null?C.length:void 0)>0){return n.__children__[0]}}};s.get_closest_ancestor_next_sibling=function(n){var D,C;D=s.get_next_sibling(n);if(D!=null){return D}else{C=s.get_parent_branch(n);return s.get_closest_ancestor_next_sibling(C)}};s.get_next_branch=function(n){var C;if(n==null){n=A}if(n!=null){C=s.get_first_child(n);if(C!=null){return C}else{C=s.get_closest_ancestor_next_sibling(n);return C}}};s.select_next_branch=function(n){var C;if(n==null){n=A}if(n!=null){C=s.get_next_branch(n);if(C!=null){s.select_branch(C);return C}}};s.last_descendant=function(n){var C;if(n==null){}v=n.__children__.length;if(v===0){return n}else{C=n.__children__[v-1];return s.last_descendant(C)}};s.get_prev_branch=function(n){var C,D;if(n==null){n=A}if(n!=null){D=s.get_prev_sibling(n);if(D!=null){return s.last_descendant(D)}else{C=s.get_parent_branch(n);return C}}};s.reload_data=function(){return j()};s.select_prev_branch=function(n){var C;if(n==null){n=A}if(n!=null){C=s.get_prev_branch(n);if(C!=null){s.select_branch(C);return C}}}}}h.get(u.templateUrl||g.getPath(),{cache:c}).success(function(X){l.append(f(X)(k));var R="ontouchstart" in window,Y,N,D,I,C,V,F=true,G=false,E=null,L=document.body,M=document.documentElement,O,H,K,U=function(af){if(!R&&(af.button==2||af.which==3)){return}if(af.uiTreeDragging||(af.originalEvent&&af.originalEvent.uiTreeDragging)){return}var ai=angular.element(af.target);var ad=ai.scope();if(!ad||!ad.$type){return}if(ad.$type!="TreeTableNode"&&ad.$type!="TreeTableNodeHandle"){return}if(ad.$type!="TreeTableNodeHandle"){return}var ab=ai.prop("tagName").toLowerCase(),ah=null;if(ab=="input"||ab=="textarea"||ab=="button"||ab=="select"){return}while(ai&&ai[0]&&ai[0]!=l){if(i.nodrag(ai)){return}ai=ai.parent()}ah=ad.getScopeNode();if(!k.beforeDrag(ah)){return}af.uiTreeDragging=true;if(af.originalEvent){af.originalEvent.uiTreeDragging=true}af.preventDefault();var ag=i.eventObj(af);N=true;D=i.dragInfo(ah);var aa=ah.$element.prop("tagName").toLowerCase();I=i.positionStarted(ag,ah.$element);if(aa==="tr"){V=angular.element(a.document.createElement("table")).addClass(k.config.treeClass).addClass(k.config.dragClass).addClass(k.tree_class)}else{V=angular.element(a.document.createElement("ul")).addClass(k.config.dragClass).addClass("tree-table-rows").addClass(k.tree_class)}V.css({width:i.width(ah.$element)+"px","z-index":9995});k.refreshStatus();k.setPositionStatus(af);K=0;var ac=i.width(ah.$element);if(aa=="tr"){var ae=angular.element(a.document.createElement("tbody"));K=ah.node().__level__-1;var Z=function(an){var aj,al,ao,ak,ap,am;aj=k.getScope(an);al=aj.$element;am=al.clone();i.replaceIndent(aj,am,an.__level__-K,"padding-left");ae.append(am);if(k.config.hiddenClass){al.addClass(k.config.hiddenClass)}ap=an.__children__;ak=ap.length;for(ao=0;ao<ak;ao++){Z(ap[ao])}};Z(ah.node());V.append(ae)}else{V.append(ah.$element.clone());if(k.config.hiddenClass){ah.$element.addClass(k.config.hiddenClass)}}V.css({left:ag.pageX-I.offsetX+k.$callbacks.calsIndent(K+1,true,true)+"px",top:ag.pageY-I.offsetY+"px"});d.find("body").append(V);C=k.initPlace(ah.$element,D.level,V);C.css("width",ac);angular.element(d).bind("touchend",J);angular.element(d).bind("touchcancel",J);angular.element(d).bind("touchmove",Q);angular.element(d).bind("mouseup",J);angular.element(d).bind("mousemove",Q);angular.element(d).bind("mouseleave",W);O=Math.max(L.scrollHeight,L.offsetHeight,M.clientHeight,M.scrollHeight,M.offsetHeight);H=Math.max(L.scrollWidth,L.offsetWidth,M.clientWidth,M.scrollWidth,M.offsetWidth)},T=function(at){if(!G){if(!F){G=true;k.$apply(function(){k.$callbacks.dragStart(D)})}return}var Z=i.eventObj(at);var ao,aw,ag;if(V){at.preventDefault();if(a.getSelection){a.getSelection().removeAllRanges()}else{if(a.document.selection){a.document.selection.empty()}}aw=Z.pageX-I.offsetX;ag=Z.pageY-I.offsetY;if(aw<0){aw=0}if(ag<0){ag=0}if((ag+10)>O){ag=O-10}if((aw+10)>H){aw=H-10}V.css({left:aw+k.$callbacks.calsIndent(K+1,true,true)+"px",top:ag+"px"});k.setPositionStatus(at);var ad=window.pageYOffset||a.document.documentElement.scrollTop;var ai=ad+(window.innerHeight||a.document.clientHeight||a.document.clientHeight);if(ai<Z.pageY&&ai<=O){window.scrollBy(0,10)}if(ad>Z.pageY){window.scrollBy(0,-10)}i.positionMoved(at,I,N);if(N){N=false;return}var al=Z.pageX-a.document.body.scrollLeft;var ak=Z.pageY-(window.pageYOffset||a.document.documentElement.scrollTop);var ac=angular.element(a.document.elementFromPoint(al,ak)),aq=ac.scope(),aa=null,ap,ah=false;if(aq&&angular.isFunction(aq.getScopeNode)){aq=aq.getScopeNode();aa=aq.$element.prop("tagName").toLowerCase();if(D.scope!==aq){D.scope.hidePlace();D.scope=aq;D.scope.showPlace();ah=true}}if(!I.dirAx||ah){if(!aq){return}ac=aq.$element;var ae,av=i.offset(ac);if(aa=="tr"){ae=Z.pageY<(av.top+i.height(ac)/2)}else{var ax=i.height(ac)-i.height(aq.elementChilds);if(Z.pageY>av.top+ax){return}ae=Z.pageY<(av.top+ax/2)}C=aq.initPlace(ac,D.level,V);C.css("width",i.width(ac));if(aq.$callbacks.dragEnabled()){if(aq.accept(D,ae)){D.level=aq.node().__level__;if(ae){var aj=aq.node(),ar=aq.getNode(aj.__parent_real__),af;if(D.drag==aq&&D.isDirty(aq.node().__index_real__-1)){af=aq.getPrevGlobal(D.node.__index_real__)}else{af=aq.prev()}D.target=af;D.scope=aq;if(D.drag==aq&&ar.__index_real__&&D.node.__parent_real__){D.move={parent:-1,pos:-1}}else{D.move={parent:ar,pos:(ar==af)?0:af.__index__+1}}if(aa=="tr"){i.replaceIndent(aq,C,D.level)}ac[0].parentNode.insertBefore(C[0],ac[0])}else{var an=D.level,ab=false;aj=aq.node();D.target=aj;D.scope=aq;if(D.drag==aq&&D.parent.__index_real__==aj.__index_real__&&D.node.__index__==0){ab=true}if(aj.__expanded__&&!ab){D.level=++an;D.move={parent:aj,pos:0};if(aa=="tr"){i.replaceIndent(aq,C,an);ac.after(C)}else{aq.elementChilds.prepend(C)}}else{if(ab){D.move={parent:-1,pos:-1}}else{ar=aq.getNode(aj.__parent_real__);D.move={parent:ar,pos:aj.__index__+1}}if(aa=="tr"){i.replaceIndent(aq,C,an)}ac.after(C)}}}}}else{aq=D.scope;aa=aq.$element.prop("tagName").toLowerCase();if(I.dirAx&&I.distAxX>=aq.config.levelThreshold){I.distAxX=0;aj=D.target;if(aj){if(I.distX>0){var am=aq.visible(aj),au;if(am&&am.__level__>=D.level){ar=am;while(ar.__level__>D.level){ar=aq.getNode(ar.__parent_real__)}au=ar.__children__.length;D.level++;if(D.drag==aq&&D.parent==ar&&D.node.__index__>=au-1){D.target=am;D.move={parent:-1,pos:-1}}else{D.move={parent:ar,pos:au}}if(aa=="tr"){i.replaceIndent(aq,C,D.level)}else{_scope=aq.getScope(am);_scope.elementChilds.append(C)}}}else{if(I.distX<0){var aj=D.canIndent();ar=aq.getNode(aj.__parent_real__);if(aj==null||aj){D.level--;if(D.drag==aq&&D.parent==ar&&D.node.__index__==aj.__index__+1){D.move={parent:-1,pos:-1}}else{D.move={parent:ar,pos:aj.__index__+1}}if(aa=="tr"){i.replaceIndent(aq,C,D.level)}else{_scope=aq.getScope(aj);_scope.$element.after(C)}}}}}}}k.$apply(function(){k.$callbacks.dragMove(D)})}},P=function(ad){ad.preventDefault();if(V){var aa=false;k.$apply(function(){aa=k.$callbacks.beforeDrop(D)});var ab=D.drag.$element.prop("tagName").toLowerCase();if(ab=="tr"){var Z=function(ah){var ae,ag,ai,af,aj;ae=k.getScope(ah);ag=ae.$element;if(k.config.hiddenClass){ag.removeClass(k.config.hiddenClass)}aj=ah.__children__;af=aj.length;for(ai=0;ai<af;ai++){Z(aj[ai])}};Z(D.drag.node())}else{if(k.config.hiddenClass){D.drag.$element.removeClass(k.config.hiddenClass)}}V.remove();V=null;D.scope.hidePlace();D.drag.hideStatus();var ac=false;if(k.$$apply){k.$apply(function(){ac=k.$callbacks.dropped(D,aa,k.enabledMove)})}else{S()}k.$apply(function(){k.$callbacks.dragStop(D,ac)});k.$$apply=false;D=null}angular.element(d).unbind("touchend",J);angular.element(d).unbind("touchcancel",J);angular.element(d).unbind("touchmove",Q);angular.element(d).unbind("mouseup",J);angular.element(d).unbind("mousemove",Q);angular.element(a.document.body).unbind("mouseleave",W)},n=function(Z){if(k.$callbacks.dragEnabled()){U(Z)}},Q=function(Z){T(Z)},J=function(Z){k.$$apply=true;k.dragEnd(Z)},W=function(Z){k.dragEnd(Z)},S=function(){l.bind("touchstart mousedown",function(Z){F=true;G=false;n(Z);E=b(function(){F=false},k.dragDelay)});l.bind("touchend touchcancel mouseup",function(){b.cancel(E)})};k.dragEnd=function(Z){P(Z)};S()})}}}]).directive("treeTableNode",["$window","$document","$timeout","$TreeTableHelper","treeTableTemplate",function(e,d,a,c,b){return{restrict:"A",replace:true,controller:["$scope","$element","$attrs","tgConfig",function(h,g,f,i){h.$modelValue=null;h.$scopeChildren=null;h.elementChilds=null;h.childNodesCount=function(){return h.childNodes().length};h.childNodes=function(){return h.$modelValue.__children__};h.prev=function(){return h.getPrevGlobal(h.$modelValue.__index_real__)};h.prevSibling=function(k){var l=h.getNode(k.__parent_real__),j=k.__index__;if(l){if(j>0){return l.__children__[j-1]}}else{if(j>0){return h.treeData[j-1]}}return null};h.next=function(){return h.getNextGlobal(h.$modelValue.__index_real__)};h.node=function(){return h.$modelValue};h.data=function(){return h.$modelValue};h.visible=function(j){if(j!=null){return j.__visible__?j:h.visible(h.tree_rows[j.__parent_real__])}return null};h.setElementChilds=function(j){h.elementChilds=j};h.getScopeNode=function(){return h}}],link:function(h,g,f){h.$element=g;h.$type="TreeTableNode";h.$iconClass="";if(h.config.nodeClass){g.addClass(h.config.nodeClass)}h.$watch(f.treeTableNode,function(i){h.setScope(i,h);h.$modelValue=i;h.$iconClass=h.classIcon[i.__icon__]},true)}}}]).directive("treeTableNodes",function(){return{restrict:"A",replace:true,controller:["$scope","$element","$attrs","tgConfig",function(c,b,a,d){c.datas=[]}],link:function(c,b,a){c.$type="TreeTableNodes";c.$element=b;if(c.setElementChilds){c.setElementChilds(b)}c.$watch(a.treeTableNodes,function(f,d,e){e.datas=f},true);if(c.config.nodesClass){b.addClass(c.config.nodesClass)}c.$element=b}}}).directive("treeTableNodeHandle",function(){return{restrict:"A",scope:true,controller:["$scope","$element","$attrs","tgConfig",function(c,b,a,d){}],link:function(c,b,a){c.$element=b;c.$type="TreeTableNodeHandle";if(c.config.handleClass){b.addClass(c.config.handleClass)}}}}).factory("treeTableTemplate",["$templateCache",function(a){var c="template/treeTable/treeTable.html";var b="template/treeTable/treeTableStatusCopy.html";var d="template/treeTable/treeTableStatusMove.html";return{setMove:function(e){d=e},setCopy:function(e){b=e},getPath:function(){return c},getCopy:function(){var e=a.get(b);if(e){return e}return a.get("template/treeTable/treeTableStatusCopy.html")},getMove:function(){var e=a.get(d);if(e){return e}return a.get("template/treeTable/treeTableStatusMove.html")}}}]).factory("$TreeTableHelper",["$document","$window",function(b,a){return{calsIndent:null,isUndefinedOrNull:function(c){return angular.isUndefined(c)||c===null},nodrag:function(c){return(typeof c.attr("data-nodrag"))!="undefined"},eventObj:function(d){var c=d;if(d.targetTouches!==undefined){c=d.targetTouches.item(0)}else{if(d.originalEvent!==undefined&&d.originalEvent.targetTouches!==undefined){c=d.originalEvent.targetTouches.item(0)}}return c},dragInfo:function(d){var c=d.node();return{node:c,parent:d.getNode(c.__parent_real__),level:c.__level__,target:d.prev(),scope:d,drag:d,move:{parent:-1,pos:-1},isDirty:function(e){return this.node.__index_real__<=e&&e<=this.node.__index_real__+this.node.__dept__-1},canIndent:function(){if(this.level==1){return false}var e=this.target;var f=e;while(e){if(e.__level__<this.level){if(e.__expanded__){if(e.__children__.length==0){return e}else{if((e.__index_real__==this.target.__parent_real__&&e.__children__.length-1==this.target.__index__)||(e.__index_real__==f.__parent_real__&&e.__children__.length-1==f.__index__)||(this.drag==this.scope&&e.__index_real__==this.node.__parent_real__&&e.__children__.length-1==this.node.__index__)){return e}}return false}return e}else{if(e.__parent_real__==null){return null}else{f=e;e=this.scope.tree_rows[e.__parent_real__]}}}return false},canInsert:function(e){if(e.__children__.length==0){return true}else{if((e.__index_real__==this.target.__parent_real__&&e.__children__.length-1==this.target.__index__)||(e.__index_real__==this.node.__parent_real__&&e.__children__.length-1==this.node.__index__)){return e}}return false}}},height:function(c){return c.prop("scrollHeight")},width:function(c){return c.prop("scrollWidth")},offset:function(c){var d=c[0].getBoundingClientRect();return{width:c.prop("offsetWidth"),height:c.prop("offsetHeight"),top:d.top+(a.pageYOffset||b[0].body.scrollTop||b[0].documentElement.scrollTop),left:d.left+(a.pageXOffset||b[0].body.scrollLeft||b[0].documentElement.scrollLeft)}},positionStarted:function(d,c){var f={};f.offsetX=d.pageX-this.offset(c).left;f.offsetY=d.pageY-this.offset(c).top;f.startX=f.lastX=d.pageX;f.startY=f.lastY=d.pageY;f.nowX=f.nowY=f.distX=f.distY=f.dirAx=0;f.dirX=f.dirY=f.lastDirX=f.lastDirY=f.distAxX=f.distAxY=0;return f},positionMoved:function(f,g,d){g.lastX=g.nowX;g.lastY=g.nowY;g.nowX=f.pageX;g.nowY=f.pageY;g.distX=g.nowX-g.lastX;g.distY=g.nowY-g.lastY;g.lastDirX=g.dirX;g.lastDirY=g.dirY;g.dirX=g.distX===0?0:g.distX>0?1:-1;g.dirY=g.distY===0?0:g.distY>0?1:-1;var c=Math.abs(g.distX)>Math.abs(g.distY)?1:0;if(d){g.dirAx=c;g.moving=true;return}if(g.dirAx!==c){g.distAxX=0;g.distAxY=0}else{g.distAxX+=Math.abs(g.distX);if(g.dirX!==0&&g.dirX!==g.lastDirX){g.distAxX=0}g.distAxY+=Math.abs(g.distY);if(g.dirY!==0&&g.dirY!==g.lastDirY){g.distAxY=0}}g.dirAx=c},replaceIndent:function(f,e,d,c){c=c?c:"left";angular.element(e.children()[0]).css(c,f.$callbacks.calsIndent(d))}}}]).factory("$TreeTableConvert",function(){return{line2tree:function(d,j,h){if(!d||d.length==0||!j||!h){return[]}var m=[],a=[],k=d[0],b=k[j],l={},e,g,f=d.length,c=0;while(c<f){k=d[c++];b=k[j];l[b]=k;e=k[h];if(e){g=l[e];if(g.__children__){g.__children__.push(k)}else{g.__children__=[k]}}else{a.push(b)}}f=a.length;for(c=0;c<f;c++){m.push(l[a[c]])}return m},tree2tree:function(c,a){var b=function(g){var i=[];var f,d=g.length,h,e;for(f=0;f<d;f++){h=angular.copy(g[f]);if(angular.isArray(h[a])&&h[a].length>0){e=b(h[a]);delete (h[a]);h.__children__=e}i.push(h)}return i};return b(c)}}}).constant("tgConfig",{treeClass:"tree-table",emptyTreeClass:"tree-table-empty",hiddenClass:"tree-table-hidden",nodeClass:"tree-table-row",nodesClass:"tree-table-rows",handleClass:"tree-table-handle",placeHolderClass:"tree-table-placeholder",dragClass:"tree-table-drag",statusClass:"tree-table-status",levelThreshold:30})}).call(window);
>>>>>>> master
=======
(function(){angular.module("template/treeTable/treeTable.html",[]).run(["$templateCache",function(a){a.put("template/treeTable/treeTable.html",'<table ng-class="tree_class">\n    <thead>\n  <tr>\n     <th ng-class="expandingProperty.titleClass" ng-style="expandingProperty.titleStyle">\n         {{expandingProperty.displayName || expandingProperty.field || expandingProperty}}\n        </th>\n        <th ng-repeat="col in colDefinitions" ng-class="col.titleClass" ng-style="col.titleStyle">\n         {{col.displayName || col.field}}\n     </th>\n    </tr>\n    </thead>\n <tbody>\n  <tr tree-table-node="row" ng-repeat="row in tree_rows track by row.__hashKey__ " ng-show="row.__visible__"\n     ng-class="(row.__selected__ ? \' active\':\'\')">\n        <td ng-if="!expandingProperty.template" tree-table-node-handle\n         ng-style="expandingProperty.cellStyle ? expandingProperty.cellStyle : {\'padding-left\': $callbacks.calsIndent(row.__level__)}"\n          ng-click="onSelect(row)" ng-class="expandingProperty.cellClass"\n            compile="expandingProperty.cellTemplate">\n              <a data-nodrag>\n                  <i ng-class="$iconClass" ng-click="toggleExpand(row)"\n                     class="tree-icon"></i>\n              </a>\n             {{row[expandingProperty.field] || row[expandingProperty]}}\n       </td>\n        <td ng-if="expandingProperty.template" compile="expandingProperty.template"></td>\n        <td ng-repeat="col in colDefinitions" ng-class="col.cellClass" ng-style="col.cellStyle"\n            compile="col.cellTemplate">\n            {{row[col.field]}}\n       </td>\n    </tr>\n    </tbody>\n</table>');a.put("template/treeTable/treeTableStatusCopy.html",'<label><i class="fa fa-copy"></i>&nbsp;<b>Copying</b></label>');a.put("template/treeTable/treeTableStatusMove.html",'<label><i class="fa fa-file-text"></i>&nbsp;<b>Moving</b></label>')}]);angular.module("treeTable",["template/treeTable/treeTable.html"]).directive("compile",["$compile",function(a){return{restrict:"A",link:function(d,c,b){d.$watch(b.compile,function(e){if(e!=null){var f=a(e);var g=f(d);c.empty().append(g)}})}}}]).directive("treeTable",["$timeout","$http","$compile","$window","$document","treeTableTemplate","tgConfig","$TreeTableHelper","$templateCache",function(b,h,f,a,d,g,e,i,c){return{restrict:"E",replace:true,scope:{treeData:"=",on_select:"&onSelect",on_click:"&onClick",tree:"=treeControl",expandOn:"=",columnDefs:"=",callbacks:"=",primaryKey:"="},controller:["$scope","$element","$attrs","tgConfig",function(l,k,j,m){l.dragEnabled=true;l.dragDelay=0;l.indent=20;l.indent_plus=15;l.indent_unit="px";l.tree_class="table";l.primary_key="__uid__";l.enabledMove=true;l.statusMove=true;l.enabledHotkey=false;l.tree_data=l.treeData;l.dragging=null;l.$globals={};l.config={};l.statusElm=null;l.placeElm=null;l.setDragging=function(n){l.dragging=n};l.toggleExpand=function(n){if(n.__children__.length>0){n.__expanded__=!n.__expanded__}};l.classIcon={};l.$callbacks={accept:function(o,n){return true},beforeDrag:function(n){return true},dragStart:function(n){},dragMove:function(n){},dragStop:function(n,o){},beforeDrop:function(n){return true},calsIndent:function(r,o,n){var q=0,p=(n)?0:l.indent_plus;if(!o){q=l.indent_unit?l.indent_unit:"px"}if(r-1<1){return p+q}else{return l.indent*(r-1)+p+q}},dragEnabled:function(){return l.dragEnabled},dropped:function(t,s,n){var p=t.node,u=t.parent||t.drag.treeData,o=t.move,q=o.parent||t.scope.treeData,r;if(q!=-1){if(n==true){r=u;if(r.__children__){r=r.__children__}p=r.splice(p.__index__,1)[0]}else{p=angular.copy(p);p.__uid__=null}if(t.drag==t.scope&&u==q&&o.pos>=t.node.__index__){o.pos--}if(o.pos>-1){r=q;if(r.__children__){r=r.__children__}r.splice(o.pos,0,p)}else{}return true}return false}};l.accept=function(o,n){return l.$callbacks.accept(o,n)};l.beforeDrag=function(n){return l.$callbacks.beforeDrag(n)};l.getPrevGlobal=function(n){if(n>0){return l.tree_rows[n-1]}return null};l.getNextGlobal=function(n){if(n>0){return l.tree_rows[n-1]}return null};l.getNode=function(n){if(n==null){return null}return l.tree_rows[n]};l.getHash=function(n){if(l.primary_key=="__uid__"){return"#"+n.__parent__+"#"+n.__index__+"#"+n.__uid__}else{return"#"+n.__parent__+"#"+n.__index__+"#"+n[l.primary_key]}};l.setScope=function(n,p){var o=l.getHash(p);if(l.$globals[o]!=n){l.$globals[o]=n}};l.getScope=function(n){if(n){return l.$globals[l.getHash(n)]}else{return l}};l.enableMove=function(n){if((typeof n)==="boolean"){l.enabledMove=n}else{l.enabledMove=true}};l.setPositionStatus=function(o,n){if(l.statusElm){l.statusElm.css({left:o.pageX+10+"px",top:o.pageY+15+"px","z-index":9999});l.statusElm.addClass(l.config.statusClass)}};if(j.enableStatus){l.enabledStatus=false;l.hideStatus=function(){if(l.statusElm){l.statusElm.addClass(l.config.hiddenClass)}};l.refreshStatus=function(){if(!l.dragging){return}if(l.enabledStatus){var n=l.statusElm;if(l.enabledMove){l.statusElm=angular.element(g.getMove(l))}else{l.statusElm=angular.element(g.getCopy(l))}if(n!=l.statusElm){if(n){l.statusElm.attr("class",n.attr("class"));l.statusElm.attr("style",n.attr("style"));n.remove()}d.find("body").append(l.statusElm)}l.statusElm.removeClass(l.config.hiddenClass)}}}else{l.enabledStatus=null}l.initPlace=function(p,r,q){var o=p.prop("tagName").toLowerCase();if(!l.placeElm){if(o.toLowerCase()=="tr"){l.placeElm=angular.element(a.document.createElement("tr"));var n=l.colDefinitions.length;l.placeElm.append(angular.element(a.document.createElement("td")).addClass(l.config.emptyTreeClass).addClass("indented").addClass(l.config.placeHolderClass));while(n-->0){l.placeElm.append(angular.element(a.document.createElement("td")).addClass(l.config.emptyTreeClass).addClass(l.config.placeHolderClass))}}else{l.placeElm=angular.element(a.document.createElement("li")).addClass(l.config.emptyTreeClass).addClass(l.config.placeHolderClass)}}else{l.placeElm.removeClass(l.config.hiddenClass)}if(o.toLowerCase()=="tr"){i.replaceIndent(l,l.placeElm,r)}p[0].parentNode.insertBefore(l.placeElm[0],p[0]);l.placeElm.css("height",i.height(q)+"px");return l.placeElm};l.hidePlace=function(){if(l.placeElm){l.placeElm.addClass(l.config.hiddenClass)}};l.showPlace=function(){if(l.placeElm){l.placeElm.removeClass(l.config.hiddenClass)}}}],link:function(O,x,t){O.$type="TreeTable";O.colDefinitions=[];O.dragging=null;O.$watch(t.enableStatus,function(n){if((typeof n)==="boolean"){O.enabledStatus=n}},true);O.$watch(t.enableMove,function(n){if((typeof n)==="boolean"){O.enabledMove=n;O.statusMove=n}},true);if(t.enableStatus){O.$watch(t.templateCopy,function(Z){var n=null;if((typeof Z)==="string"&&Z.trim().length>0){n=Z.trim()}else{n=t.templateCopy;if(n){n=n.trim();if(n.length==0&&!c.get(n)){n=null}}}if(n){if(c.get(n)){g.setCopy(n,O)}}},true);O.$watch(t.templateMove,function(Z){var n=null;if((typeof Z)==="string"&&Z.trim().length>0){n=Z.trim()}else{n=t.templateMove;if(n){n=n.trim();if(n.length==0&&!c.get(n)){n=null}}}if(n){if(c.get(n)){g.setMove(n,O)}}},true)}if(!t.primaryKey){O.primary_key=="__uid__"}else{O.$watch(t.primaryKey,function(n){if(typeof n==="string"){O.primary_key=n}else{O.primary_key=t.primaryKey}},true)}O.$watch(t.callbacks,function(n){angular.forEach(n,function(aa,Z){if(typeof aa==="function"){if(O.$callbacks[Z]){O.$callbacks[Z]=aa}}})},true);if((typeof t["class"])==="string"){O.tree_class=t["class"].trim()}if((typeof t.indentUnit)==="string"){O.indent_unit=t.indentUnit}O.$watch(t.enableHotkey,function(n){if((typeof n)==="boolean"){O.enabledHotkey=n}if(O.enabledHotkey){O.enabledMove=false}else{O.enabledMove=O.statusMove}},true);O.$watch(t.enableDrag,function(n){if((typeof n)==="boolean"){O.dragEnabled=n}else{if((typeof t.enableDrag)=="boolean"){O.indent=t.enableDrag}}},true);O.$watch(t.indent,function(n){if((typeof n)=="number"){O.indent=n}else{if((typeof t.indent)=="number"){O.indent=t.indent}}},true);O.$watch(t.indentPlus,function(n){if((typeof n)=="number"){O.indent_plus=n}else{if((typeof t.indentPlus)=="number"){O.indent_plus=t.indentPlus}}},true);O.$watch(t.dragDelay,function(n){if((typeof n)=="number"){O.dragDelay=n}else{if((typeof t.dragDelay)=="number"){O.dragDelay=t.dragDelay}}},true);O.config={};angular.extend(O.config,e);O.$watch(t.config,function(n){angular.extend(O.config,n)},true);var k,E,S,D;O.classIcon={"1":t.iconExpand?t.iconExpand:"glyphicon glyphicon-minus","0":t.iconCollapse?t.iconCollapse:"glyphicon glyphicon-plus","-1":t.iconLeaf?t.iconLeaf:"glyphicon glyphicon-file"};t.expandLevel=t.expandLevel?t.expandLevel:"3";E=parseInt(t.expandLevel,10);if(!O.treeData){O.treeData=[]}var X=function(){if(O.treeData.length){var ac=O.treeData[0],aa=Object.keys(ac),ab=new RegExp("^__([a-zA-Z0-9_-]*)__$");for(var Z=0,n=aa.length;Z<n;Z++){if(typeof(ac[aa[Z]])==="string"&&!ab.test(aa[Z])){k=aa[Z];break}}if(!k){k=aa[0]}O.expandingProperty=k}},p=function(){if(O.treeData.length){var Z=[],ab=O.treeData[0];var aa=new RegExp("(^__([a-zA-Z0-9_-]*)__$|^"+k+"$)");for(var n in ab){if(!aa.test(n)){Z.push({field:n})}}O.colDefinitions=Z}};if(t.expandOn){k=O.expandOn||[];O.expandingProperty=O.expandOn||[]}if(t.columnDefs){if(!(angular.isArray(O.columnDefs))){p()}else{O.colDefinitions=O.columnDefs}}O.tree_rows=[];var K=null,w=function(ac){var Z,ab,n,aa;Z=function(ae,ah){ac(ae,ah);if(ae.__children__!=null){var ag,ad,af;af=ae.__children__;for(ag=0,ad=af.length;ag<ad;ag++){Z(af[ag],ah+1)}}};aa=O.treeData;for(ab=0,n=aa.length;ab<n;ab++){Z(aa[ab],1)}},P=function(n){if(!n){if(K!=null){K.__selected__=false}K=null;return}if(n!==K){if(K!=null){K.__selected__=false}n.__selected__=true;K=n;A(n);if(angular.isFunction(O.on_select)){return b(function(){return O.on_select({branch:n})})}}},W=function(n){if(n.__parent_real__!==null&&n.__parent_real__>-1&&n.__parent_real__<O.tree_rows.length){return O.tree_rows[n.__parent_real__]}return null},z=function(aa,Z){var n;n=W(aa);if(n!=null){Z(n);return z(n,Z)}},A=function(n){return z(n,function(Z){return Z.__expanded__=true})},m=function(){if(!t.expandOn){X()}if(!t.columnDefs){p()}var ae,n;n=O.treeData;ae=n.length;var Z=[];if(ae>0){var aa,ac;ac=function(aq,ar,am,ai,aj,an){var ak,ap,al;if(!angular.isArray(aq.__children__)){aq.__children__=[]}aq.__parent_real__=am;aq.__parent__=ar;ap=aq.__children__.length;if(aq.__expanded__==null&&ap>0){aq.__expanded__=ai<E}if(ap===0){al=-1}else{if(aq.__expanded__){al=1}else{al=0}}var au=Z.length;aq.__index__=an;aq.__index_real__=au;aq.__level__=ai;aq.__icon__=al;aq.__visible__=aj;if(aq.__uid__==null){aq.__uid__=""+Math.random()}Z.push(aq);var ao=1;if(ap>0){for(ak=0;ak<ap;ak++){ao+=ac(aq.__children__[ak],(O.primary_key=="__uid__")?aq.__uid__:aq[O.primary_key],au,ai+1,aj&&aq.__expanded__,ak)}}var at;if(O.primary_key=="__uid__"){at="#"+am+"#"+au+"#"+aq.__uid__}else{at="#"+am+"#"+au+"#"+aq[O.primary_key]}if(aq.__hashKey__==null||aq.__hashKey__!=at){aq.__hashKey__=at;delete (O.$globals[at])}aq.__dept__=ao;return ao};var ag=0;for(aa=0;aa<ae;aa++){ag+=ac(n[aa],null,null,1,true,aa)}var af,ah,ad=Object.keys(O.$globals),ab=O.$globals.length;af=ab-ag;if(af!=0){ah=ab-af;_min=ah-Math.abs(af);for(aa=_min;aa<ah;aa++){delete (O.$globals[ad[aa]])}}}O.tree_rows=Z;return O.tree_rows};O.onClick=function(n){if(angular.isFunction(O.on_click)){b(function(){O.on_click({branch:n})})}};O.onSelect=function(n){if(n!==K){P(n)}};O.$watch("treeData",m,true);m();if(O.tree==null||!angular.isObject(O.tree)){O.tree={}}D=O.tree;D.expand_all=function(){w(function(n,Z){n.__expanded__=true})};D.collapse_all=function(){w(function(n,Z){n.__expanded__=false})};D.get_first_branch=function(){S=O.treeData.length;if(S>0){return O.treeData[0]}return null};D.select_first_branch=function(){var n;n=D.get_first_branch();return D.select_branch(n)};D.get_selected_branch=function(){return K};D.get_parent_branch=function(n){return W(n)};D.select_branch=function(n){P(n);return n};D.get_children=function(n){return n.__children__};D.select_parent_branch=function(n){var Z;if(n==null){n=D.get_selected_branch()}if(n!=null){Z=D.get_parent_branch(n);if(Z!=null){D.select_branch(Z);return Z}}};D.add_branch=function(Z,aa,n){if((typeof n)!="number"){if(Z!=null){Z.__children__.push(aa);Z.__expanded__=true}else{O.treeData.push(aa)}}else{if(Z!=null){Z.__children__.splice(n,0,aa);Z.__expanded__=true}else{O.treeData.splice(n,0,aa)}}return aa};D.add_root_branch=function(n){D.add_branch(null,n);return n};D.remove_branch=function(aa){aa=aa||D.get_selected_branch();if(aa){var Z;if(aa.__parent_real__!==null){Z=D.get_parent_branch(aa).__children__}else{Z=O.treeData}var n=Z.indexOf(aa);Z.splice(n,1);K=null}};D.expand_branch=function(n){if(n==null){n=D.get_selected_branch()}if(n!=null){n.__expanded__=true;return n}};D.collapse_branch=function(n){if(n==null){n=K}if(n!=null){n.__expanded__=false;return n}};D.get_siblings=function(n){var Z,aa;if(n==null){n=K}if(n!=null){Z=D.get_parent_branch(n);if(Z){aa=Z.__children__}else{aa=O.treeData}return aa}};D.get_next_sibling=function(n){var Z,aa;if(n==null){n=K}if(n!=null){aa=D.get_siblings(n);S=aa.length;Z=aa.indexOf(n);if(Z<S){return aa[Z+1]}}};D.get_prev_sibling=function(n){var Z,aa;if(n==null){n=K}aa=D.get_siblings(n);S=aa.length;Z=aa.indexOf(n);if(Z>0){return aa[Z-1]}};D.select_next_sibling=function(n){var Z;if(n==null){n=K}if(n!=null){Z=D.get_next_sibling(n);if(Z!=null){return D.select_branch(Z)}}};D.select_prev_sibling=function(n){var Z;if(n==null){n=K}if(n!=null){Z=D.get_prev_sibling(n);if(Z!=null){return D.select_branch(Z)}}};D.get_first_child=function(n){var Z;if(n==null){n=K}if(n!=null){if(((Z=n.__children__)!=null?Z.length:void 0)>0){return n.__children__[0]}}};D.get_closest_ancestor_next_sibling=function(n){var aa,Z;aa=D.get_next_sibling(n);if(aa!=null){return aa}else{Z=D.get_parent_branch(n);return D.get_closest_ancestor_next_sibling(Z)}};D.get_next_branch=function(n){var Z;if(n==null){n=K}if(n!=null){Z=D.get_first_child(n);if(Z!=null){return Z}else{Z=D.get_closest_ancestor_next_sibling(n);return Z}}};D.select_next_branch=function(n){var Z;if(n==null){n=K}if(n!=null){Z=D.get_next_branch(n);if(Z!=null){D.select_branch(Z);return Z}}};D.last_descendant=function(n){var Z;if(n==null){}S=n.__children__.length;if(S===0){return n}else{Z=n.__children__[S-1];return D.last_descendant(Z)}};D.get_prev_branch=function(n){var Z,aa;if(n==null){n=K}if(n!=null){aa=D.get_prev_sibling(n);if(aa!=null){return D.last_descendant(aa)}else{Z=D.get_parent_branch(n);return Z}}};D.reload_data=function(){return m()};D.select_prev_branch=function(n){var Z;if(n==null){n=K}if(n!=null){Z=D.get_prev_branch(n);if(Z!=null){D.select_branch(Z);return Z}}};var C="ontouchstart" in window,l,U,Q,L,o,F,Y=true,M=false,v=null,G=document.body,I=document.documentElement,B,R,s,q=function(ae){if(!C&&(ae.button==2||ae.which==3)){return}if(ae.uiTreeDragging||(ae.originalEvent&&ae.originalEvent.uiTreeDragging)){return}var ah=angular.element(ae.target);var ac=ah.scope();if(!ac||!ac.$type){return}if(ac.$type!="TreeTableNode"&&ac.$type!="TreeTableNodeHandle"){return}if(ac.$type!="TreeTableNodeHandle"){return}var aa=ah.prop("tagName").toLowerCase(),ag=null;if(aa=="input"||aa=="textarea"||aa=="button"||aa=="select"){return}while(ah&&ah[0]&&ah[0]!=x){if(i.nodrag(ah)){return}ah=ah.parent()}ag=ac.getScopeNode();if(!O.beforeDrag(ag)){return}ae.uiTreeDragging=true;if(ae.originalEvent){ae.originalEvent.uiTreeDragging=true}ae.preventDefault();var af=i.eventObj(ae);U=true;Q=i.dragInfo(ag);O.setDragging(Q);var Z=ag.$element.prop("tagName").toLowerCase();L=i.positionStarted(af,ag.$element);if(Z==="tr"){F=angular.element(a.document.createElement("table")).addClass(O.config.treeClass).addClass(O.config.dragClass).addClass(O.tree_class)}else{F=angular.element(a.document.createElement("ul")).addClass(O.config.dragClass).addClass("tree-table-rows").addClass(O.tree_class)}F.css({width:i.width(ag.$element)+"px","z-index":9995});s=0;var ab=i.width(ag.$element);if(Z=="tr"){var ad=angular.element(a.document.createElement("tbody"));s=ag.node().__level__-1;var n=function(am){var ai,ak,an,aj,ao,al;ai=O.getScope(am);ak=ai.$element;al=ak.clone();i.replaceIndent(ai,al,am.__level__-s,"padding-left");ad.append(al);if(O.config.hiddenClass){ak.addClass(O.config.hiddenClass)}ao=am.__children__;aj=ao.length;for(an=0;an<aj;an++){n(ao[an])}};n(ag.node());F.append(ad)}else{F.append(ag.$element.clone());if(O.config.hiddenClass){ag.$element.addClass(O.config.hiddenClass)}}F.css({left:af.pageX-L.offsetX+O.$callbacks.calsIndent(s+1,true,true)+"px",top:af.pageY-L.offsetY+"px"});d.find("body").append(F);o=O.initPlace(ag.$element,Q.level,F);o.css("width",ab);if(O.enabledStatus){O.refreshStatus();O.setPositionStatus(ae)}angular.element(d).bind("touchend",N);angular.element(d).bind("touchcancel",N);angular.element(d).bind("touchmove",V);angular.element(d).bind("mouseup",N);angular.element(d).bind("mousemove",V);angular.element(d).bind("mouseleave",H);B=Math.max(G.scrollHeight,G.offsetHeight,I.clientHeight,I.scrollHeight,I.offsetHeight);R=Math.max(G.scrollWidth,G.offsetWidth,I.clientWidth,I.scrollWidth,I.offsetWidth)},r=function(aq){if(!M){if(!Y){M=true;O.$apply(function(){O.$callbacks.dragStart(Q)})}return}var n=i.eventObj(aq);var an,au,af;if(F){aq.preventDefault();if(a.getSelection){a.getSelection().removeAllRanges()}else{if(a.document.selection){a.document.selection.empty()}}au=n.pageX-L.offsetX;af=n.pageY-L.offsetY;if(au<0){au=0}if(af<0){af=0}if((af+10)>B){af=B-10}if((au+10)>R){au=R-10}F.css({left:au+O.$callbacks.calsIndent(s+1,true,true)+"px",top:af+"px"});if(O.enabledStatus){O.setPositionStatus(aq)}var ac=window.pageYOffset||a.document.documentElement.scrollTop;var ah=ac+(window.innerHeight||a.document.clientHeight||a.document.clientHeight);if(ah<n.pageY&&ah<=B){window.scrollBy(0,10)}if(ac>n.pageY){window.scrollBy(0,-10)}i.positionMoved(aq,L,U);if(U){U=false;return}var ak=n.pageX-a.document.body.scrollLeft;var aj=n.pageY-(window.pageYOffset||a.document.documentElement.scrollTop);var ab=angular.element(a.document.elementFromPoint(ak,aj)),ao=ab.scope(),Z=null,ag=false;if(ao&&angular.isFunction(ao.getScopeNode)){ao=ao.getScopeNode();Z=ao.$element.prop("tagName").toLowerCase();if(Q.scope!==ao){Q.scope.hidePlace();Q.scope=ao;Q.scope.showPlace();ag=true}}if(!L.dirAx||ag){if(!ao){return}ab=ao.$element;var ad,at=i.offset(ab);if(Z=="tr"){ad=n.pageY<(at.top+i.height(ab)/2)}else{var av=i.height(ab)-i.height(ao.elementChilds);if(n.pageY>at.top+av){return}ad=n.pageY<(at.top+av/2)}o=ao.initPlace(ab,Q.level,F);o.css("width",i.width(ab));if(ao.$callbacks.dragEnabled()){if(ao.accept(Q,ad)){Q.level=ao.node().__level__;if(ad){var ai=ao.node(),ap=ao.getNode(ai.__parent_real__),ae;if(Q.drag==ao&&Q.isDirty(ao.node().__index_real__-1)){ae=ao.getPrevGlobal(Q.node.__index_real__)}else{ae=ao.prev()}Q.target=ae;Q.scope=ao;if(Q.drag==ao&&ap.__index_real__&&Q.node.__parent_real__){Q.move={parent:-1,pos:-1}}else{Q.move={parent:ap,pos:(ap==ae)?0:ae.__index__+1}}if(Z=="tr"){i.replaceIndent(ao,o,Q.level)}ab[0].parentNode.insertBefore(o[0],ab[0])}else{var am=Q.level,aa=false;ai=ao.node();Q.target=ai;Q.scope=ao;if(Q.drag==ao&&Q.parent.__index_real__==ai.__index_real__&&Q.node.__index__==0){aa=true}if(ai.__expanded__&&!aa){Q.level=++am;Q.move={parent:ai,pos:0};if(Z=="tr"){i.replaceIndent(ao,o,am);ab.after(o)}else{ao.elementChilds.prepend(o)}}else{if(aa){Q.move={parent:-1,pos:-1}}else{ap=ao.getNode(ai.__parent_real__);Q.move={parent:ap,pos:ai.__index__+1}}if(Z=="tr"){i.replaceIndent(ao,o,am)}ab.after(o)}}}}}else{ao=Q.scope;Z=ao.$element.prop("tagName").toLowerCase();if(L.dirAx&&L.distAxX>=ao.config.levelThreshold){L.distAxX=0;ai=Q.target;if(ai){if(L.distX>0){var al=ao.visible(ai),ar;if(al&&al.__level__>=Q.level){ap=al;while(ap.__level__>Q.level){ap=ao.getNode(ap.__parent_real__)}ar=ap.__children__.length;Q.level++;if(Q.drag==ao&&Q.parent==ap&&Q.node.__index__>=ar-1){Q.target=al;Q.move={parent:-1,pos:-1}}else{Q.move={parent:ap,pos:ar}}if(Z=="tr"){i.replaceIndent(ao,o,Q.level)}else{_scope=ao.getScope(al);_scope.elementChilds.append(o)}}}else{if(L.distX<0){var ai=Q.canIndent();ap=ao.getNode(ai.__parent_real__);if(ai==null||ai){Q.level--;if(Q.drag==ao&&Q.parent==ap&&Q.node.__index__==ai.__index__+1){Q.move={parent:-1,pos:-1}}else{Q.move={parent:ap,pos:ai.__index__+1}}if(Z=="tr"){i.replaceIndent(ao,o,Q.level)}else{_scope=ao.getScope(ai);_scope.$element.after(o)}}}}}}}O.$apply(function(){O.$callbacks.dragMove(Q)})}},T=function(ac){ac.preventDefault();if(F){var Z=false;O.$apply(function(){Z=O.$callbacks.beforeDrop(Q)});var aa=Q.drag.$element.prop("tagName").toLowerCase();if(aa=="tr"){var n=function(ag){var ad,af,ah,ae,ai;ad=O.getScope(ag);af=ad.$element;if(O.config.hiddenClass){af.removeClass(O.config.hiddenClass)}ai=ag.__children__;ae=ai.length;for(ah=0;ah<ae;ah++){n(ai[ah])}};n(Q.drag.node())}else{if(O.config.hiddenClass){Q.drag.$element.removeClass(O.config.hiddenClass)}}F.remove();F=null;Q.scope.hidePlace();if(O.enabledStatus!==null){O.hideStatus()}var ab=false;if(O.$$apply){O.$apply(function(){ab=O.$callbacks.dropped(Q,Z,O.enabledMove)})}else{y()}O.$apply(function(){O.$callbacks.dragStop(Q,ab)});O.$$apply=false;Q=null;O.setDragging(null)}angular.element(d).unbind("touchend",N);angular.element(d).unbind("touchcancel",N);angular.element(d).unbind("touchmove",V);angular.element(d).unbind("mouseup",N);angular.element(d).unbind("mousemove",V);angular.element(a.document.body).unbind("mouseleave",H)},u=function(n){if(O.$callbacks.dragEnabled()){q(n)}},V=function(n){r(n)},N=function(n){O.$$apply=true;O.dragEnd(n)},H=function(n){O.dragEnd(n)},y=function(){x.bind("touchstart mousedown",function(n){Y=true;M=false;u(n);v=b(function(){Y=false},O.dragDelay)});x.bind("touchend touchcancel mouseup",function(){b.cancel(v)})},J=function(n){if(n.keyCode==27){if(O.enabledStatus!==null){O.hideStatus()}O.$$apply=false;O.dragEnd(n)}else{if(O.enabledHotkey&&n.shiftKey){O.enableMove(true);if(O.enabledStatus){O.refreshStatus()}}}},j=function(n){if(O.enabledHotkey&&!n.shiftKey){O.enableMove(false);if(O.enabledStatus){O.refreshStatus()}}};O.dragEnd=function(n){T(n)};y();angular.element(a.document.body).bind("keydown",J);angular.element(a.document.body).bind("keyup",j);O.$on("$destroy",function(){angular.element(a.document.body).unbind("keydown",J);angular.element(a.document.body).unbind("keyup",j);if(O.statusElm){O.statusElm.remove()}if(O.placeElm){O.placeElm.remove()}});h.get(t.templateUrl||g.getPath(),{cache:c}).success(function(n){x.append(f(n)(O))})}}}]).directive("treeTableNode",["$window","$document","$timeout","$TreeTableHelper","treeTableTemplate",function(e,d,a,c,b){return{restrict:"A",replace:true,controller:["$scope","$element","$attrs","tgConfig",function(h,g,f,i){h.$modelValue=null;h.$scopeChildren=null;h.elementChilds=null;h.prev=function(){return h.getPrevGlobal(h.$modelValue.__index_real__)};h.node=function(){return h.$modelValue};h.visible=function(j){if(j!=null){return j.__visible__?j:h.visible(h.tree_rows[j.__parent_real__])}return null};h.setElementChilds=function(j){h.elementChilds=j};h.getScopeNode=function(){return h}}],link:function(h,g,f){h.$element=g;h.$type="TreeTableNode";h.$iconClass="";if(h.config.nodeClass){g.addClass(h.config.nodeClass)}h.$watch(f.treeTableNode,function(k,i,j){j.setScope(j,k);j.$modelValue=k;j.$iconClass=j.classIcon[k.__icon__]},true)}}}]).directive("treeTableNodes",function(){return{restrict:"A",replace:true,link:function(c,b,a){c.$type="TreeTableNodes";c.$element=b;c.datas=[];if(c.setElementChilds){c.setElementChilds(b)}c.$watch(a.treeTableNodes,function(f,d,e){e.datas=f},true);if(c.config.nodesClass){b.addClass(c.config.nodesClass)}}}}).directive("treeTableNodeHandle",function(){return{restrict:"A",scope:true,link:function(c,b,a){c.$element=b;c.$type="TreeTableNodeHandle";if(c.config.handleClass){b.addClass(c.config.handleClass)}}}}).factory("treeTableTemplate",["$templateCache",function(a){var d="template/treeTable/treeTable.html";var c="template/treeTable/treeTableStatusCopy.html";var e="template/treeTable/treeTableStatusMove.html";var b={};return{setMove:function(g,f){if(!b[f.$id]){b[f.$id]={}}b[f.$id].movePath=g},setCopy:function(g,f){if(!b[f.$id]){b[f.$id]={}}b[f.$id].copyPath=g},getPath:function(){return d},getCopy:function(g){var f;if(b[g.$id]&&b[g.$id].copyPath&&(f=a.get(b[g.$id].copyPath))){return f}return a.get(c)},getMove:function(g){var f;if(b[g.$id]&&b[g.$id].movePath&&(f=a.get(b[g.$id].movePath))){return f}return a.get(e)}}}]).factory("$TreeTableHelper",["$document","$window",function(b,a){return{calsIndent:null,nodrag:function(c){return(typeof c.attr("data-nodrag"))!="undefined"},eventObj:function(d){var c=d;if(d.targetTouches!==undefined){c=d.targetTouches.item(0)}else{if(d.originalEvent!==undefined&&d.originalEvent.targetTouches!==undefined){c=d.originalEvent.targetTouches.item(0)}}return c},dragInfo:function(d){var c=d.node();return{node:c,parent:d.getNode(c.__parent_real__),level:c.__level__,target:d.prev(),scope:d,drag:d,move:{parent:-1,pos:-1},isDirty:function(e){return this.node.__index_real__<=e&&e<=this.node.__index_real__+this.node.__dept__-1},canIndent:function(){if(this.level==1){return false}var e=this.target;var f=e;while(e){if(e.__level__<this.level){if(e.__expanded__){if(e.__children__.length==0){return e}else{if((e.__index_real__==this.target.__parent_real__&&e.__children__.length-1==this.target.__index__)||(e.__index_real__==f.__parent_real__&&e.__children__.length-1==f.__index__)||(this.drag==this.scope&&e.__index_real__==this.node.__parent_real__&&e.__children__.length-1==this.node.__index__)){return e}}return false}return e}else{if(e.__parent_real__==null){return null}else{f=e;e=this.scope.tree_rows[e.__parent_real__]}}}return false},canInsert:function(e){if(e.__children__.length==0){return true}else{if((e.__index_real__==this.target.__parent_real__&&e.__children__.length-1==this.target.__index__)||(e.__index_real__==this.node.__parent_real__&&e.__children__.length-1==this.node.__index__)){return e}}return false}}},height:function(c){return c.prop("scrollHeight")},width:function(c){return c.prop("scrollWidth")},offset:function(c){var d=c[0].getBoundingClientRect();return{width:c.prop("offsetWidth"),height:c.prop("offsetHeight"),top:d.top+(a.pageYOffset||b[0].body.scrollTop||b[0].documentElement.scrollTop),left:d.left+(a.pageXOffset||b[0].body.scrollLeft||b[0].documentElement.scrollLeft)}},positionStarted:function(d,c){var f={};f.offsetX=d.pageX-this.offset(c).left;f.offsetY=d.pageY-this.offset(c).top;f.startX=f.lastX=d.pageX;f.startY=f.lastY=d.pageY;f.nowX=f.nowY=f.distX=f.distY=f.dirAx=0;f.dirX=f.dirY=f.lastDirX=f.lastDirY=f.distAxX=f.distAxY=0;return f},positionMoved:function(f,g,d){g.lastX=g.nowX;g.lastY=g.nowY;g.nowX=f.pageX;g.nowY=f.pageY;g.distX=g.nowX-g.lastX;g.distY=g.nowY-g.lastY;g.lastDirX=g.dirX;g.lastDirY=g.dirY;g.dirX=g.distX===0?0:g.distX>0?1:-1;g.dirY=g.distY===0?0:g.distY>0?1:-1;var c=Math.abs(g.distX)>Math.abs(g.distY)?1:0;if(d){g.dirAx=c;g.moving=true;return}if(g.dirAx!==c){g.distAxX=0;g.distAxY=0}else{g.distAxX+=Math.abs(g.distX);if(g.dirX!==0&&g.dirX!==g.lastDirX){g.distAxX=0}g.distAxY+=Math.abs(g.distY);if(g.dirY!==0&&g.dirY!==g.lastDirY){g.distAxY=0}}g.dirAx=c},replaceIndent:function(f,e,d,c){c=c?c:"left";angular.element(e.children()[0]).css(c,f.$callbacks.calsIndent(d))}}}]).factory("$TreeTableConvert",function(){return{line2tree:function(d,j,h){if(!d||d.length==0||!j||!h){return[]}var m=[],a=[],k=d[0],b=k[j],l={},e,g,f=d.length,c=0;while(c<f){k=d[c++];b=k[j];l[b]=k;e=k[h];if(e){g=l[e];if(g.__children__){g.__children__.push(k)}else{g.__children__=[k]}}else{a.push(b)}}f=a.length;for(c=0;c<f;c++){m.push(l[a[c]])}return m},tree2tree:function(c,a){var b=function(g){var i=[];var f,d=g.length,h,e;for(f=0;f<d;f++){h=angular.copy(g[f]);if(angular.isArray(h[a])&&h[a].length>0){e=b(h[a]);delete (h[a]);h.__children__=e}i.push(h)}return i};return b(c)}}}).constant("tgConfig",{treeClass:"tree-table",emptyTreeClass:"tree-table-empty",hiddenClass:"tree-table-hidden",nodeClass:"tree-table-row",nodesClass:"tree-table-rows",handleClass:"tree-table-handle",placeHolderClass:"tree-table-placeholder",dragClass:"tree-table-drag",statusClass:"tree-table-status",levelThreshold:30})}).call(window);
>>>>>>> master
