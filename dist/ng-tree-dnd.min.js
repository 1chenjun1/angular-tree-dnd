/**
 * The MIT License (MIT)
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to
 * deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 * sell copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
 * IN THE SOFTWARE.
 */
/**
 * Implementing TreeDnD & Event DrapnDrop (allow drag multi tree-table include all type: table, ol, ul)
 * Demo: http://thienhung1989.github.io/angular-tree-dnd
 * Github: https://github.com/thienhung1989/angular-tree-dnd
 * @version 3.0.3
 * (c) 2015 Nguyuễn Thiện Hùng - <nguyenthienhung1989@gmail.com>
 */
(function(){angular.isUndefinedOrNull=function(e){return angular.isUndefined(e)||null===e},angular.module("ntt.TreeDnD",["template/TreeDnD/TreeDnD.html"]).constant("$TreeDnDClass",{tree:"tree-dnd",empty:"tree-dnd-empty",hidden:"tree-dnd-hidden",node:"tree-dnd-node",nodes:"tree-dnd-nodes",handle:"tree-dnd-handle",place:"tree-dnd-placeholder",drag:"tree-dnd-drag",status:"tree-dnd-status",icon:{1:"glyphicon glyphicon-minus",0:"glyphicon glyphicon-plus","-1":"glyphicon glyphicon-file"}}).factory("$TreeDnDConvert",function(){return{line2tree:function(e,n,t){if(!e||0===e.length||!n||!t)return[];for(var l,a,r=[],o=[],i=e[0],d=i[n],s={},c=e.length,_=0;c>_;)i=e[_++],d=i[n],s[d]=i,l=i[t],l?(a=s[l],a.__children__?a.__children__.push(i):a.__children__=[i]):o.push(d);for(c=o.length,_=0;c>_;_++)r.push(s[o[_]]);return r},tree2tree:function(e,n){var t=function(e){var l,a,r,o=[],i=e.length;for(l=0;i>l;l++)a=angular.copy(e[l]),angular.isArray(a[n])&&a[n].length>0&&(r=t(a[n]),delete a[n],a.__children__=r),o.push(a);return o};return t(e)}}}).factory("$TreeDnDHelper",["$document","$window",function(e,n){return{calsIndent:null,nodrag:function(e){return"undefined"!=typeof e.attr("data-nodrag")},eventObj:function(e){var n=e;return void 0!==e.targetTouches?n=e.targetTouches.item(0):void 0!==e.originalEvent&&void 0!==e.originalEvent.targetTouches&&(n=e.originalEvent.targetTouches.item(0)),n},dragInfo:function(e){var n=e.getData(),t=e.getScopeTree(),l=e.getNode(n.__parent_real__);return{node:n,parent:l,move:{parent:l,pos:n.__index__},scope:e,target:t,drag:t,drop:e.getPrevSibling(n),changed:!1}},height:function(e){return e.prop("scrollHeight")},width:function(e){return e.prop("scrollWidth")},offset:function(t){var l=t[0].getBoundingClientRect();return{width:t.prop("offsetWidth"),height:t.prop("offsetHeight"),top:l.top+(n.pageYOffset||e[0].body.scrollTop||e[0].documentElement.scrollTop),left:l.left+(n.pageXOffset||e[0].body.scrollLeft||e[0].documentElement.scrollLeft)}},positionStarted:function(e,n){var t={};return t.offsetX=e.pageX-this.offset(n).left,t.offsetY=e.pageY-this.offset(n).top,t.startX=t.lastX=e.pageX,t.startY=t.lastY=e.pageY,t.nowX=t.nowY=t.distX=t.distY=t.dirAx=0,t.dirX=t.dirY=t.lastDirX=t.lastDirY=t.distAxX=t.distAxY=0,t},positionMoved:function(e,n,t){n.lastX=n.nowX,n.lastY=n.nowY,n.nowX=e.pageX,n.nowY=e.pageY,n.distX=n.nowX-n.lastX,n.distY=n.nowY-n.lastY,n.lastDirX=n.dirX,n.lastDirY=n.dirY,n.dirX=0===n.distX?0:n.distX>0?1:-1,n.dirY=0===n.distY?0:n.distY>0?1:-1;var l=Math.abs(n.distX)>Math.abs(n.distY)?1:0;return t?(n.dirAx=l,void(n.moving=!0)):(n.dirAx!==l?(n.distAxX=0,n.distAxY=0):(n.distAxX+=Math.abs(n.distX),0!==n.dirX&&n.dirX!==n.lastDirX&&(n.distAxX=0),n.distAxY+=Math.abs(n.distY),0!==n.dirY&&n.dirY!==n.lastDirY&&(n.distAxY=0)),void(n.dirAx=l))},replaceIndent:function(e,n,t,l){l=l?l:"left",angular.element(n.children()[0]).css(l,e.$callbacks.calsIndent(t))}}}]).factory("$TreeDnDTemplate",["$templateCache",function(e){var n="template/TreeDnD/TreeDnD.html",t="template/TreeDnD/TreeDnDStatusCopy.html",l="template/TreeDnD/TreeDnDStatusMove.html",a={};return{setMove:function(e,n){a[n.$id]||(a[n.$id]={}),a[n.$id].movePath=e},setCopy:function(e,n){a[n.$id]||(a[n.$id]={}),a[n.$id].copyPath=e},getPath:function(){return n},getCopy:function(n){var l;return a[n.$id]&&a[n.$id].copyPath&&(l=e.get(a[n.$id].copyPath))?l:e.get(t)},getMove:function(n){var t;return a[n.$id]&&a[n.$id].movePath&&(t=e.get(a[n.$id].movePath))?t:e.get(l)}}}]).factory("$TreeDnDFilter",["$filter",function(e){var n,t,l,a,r,o,i=function(e,n,t,l,a,r){if(!angular.isFunction(l))return null;var o,d,s,c,_=!1,u=!1;if(c=l(e,n,r),_=c,!angular.isUndefinedOrNull(n[t]))for(s=n[t],d=s.length,o=0;d>o;o++)c=i(e,s[o],t,l,a,_),u=u||c;return angular.isFunction(a)&&a(e,n,_,u),_||u},d=function(e,n,t,l,a,r){if(!angular.isFunction(a))return null;var o,i,s,c=!1;if(c=a(e,n,t),angular.isFunction(r)&&r(e,n,t,c)===!0)return!1;if(!angular.isUndefinedOrNull(t[l]))for(s=t[l],i=s.length,o=0;i>o;o++)if(d(e,n,s[o],l,a,r)===!1)return!1},s=function(n,t,l){var a,r,o,i=l.field,d=l.callback,s=null,c=null,_=function(n){if(angular.isUndefinedOrNull(n)||angular.isArray(n))return null;if(angular.isFunction(d))return d(n,e);if("boolean"==typeof d)return n=!!n,n===d;if(angular.isUndefinedOrNull(d))return null;var t=new RegExp(d,"g");return t.test(n)};if("_$"===i)for(r=Object.keys(t),o=r.length,a=0;o>a;a++){if(c=_(t[r[a]]),c===!0)return!0;s=c}else angular.isUndefinedOrNull(t[i])||(s=_(t[i]));return s},c=function(e,n,t,l){return t===!0?(n.__filtered__=!0,void(n.__filtered_visible__=!0)):l===!0&&e.showParent===!0?(n.__filtered__=!1,void(n.__filtered_visible__=!0)):(delete n.__filtered__,void delete n.__filtered_visible__)},_=function(e){if(angular.isObject(e)&&!angular.isArray(e)){l=Object.keys(e),t=l.length,r=[];var i=!0;if(t>0)for(n=0;t>n;n++)("string"!=typeof e[l[n]]||0!==e[l[n]].length)&&(a={field:l[n],callback:e[l[n]]},i?(r.push(a),i=!1,o=a):(o.conditions=[],o.conditions.push(a),o=a));return r}return e},u=function(e,n,t){if(!angular.isArray(e)||0===e.length||!angular.isArray(n)&&!angular.isObject(n)||0===n.length)return e;var l,a,r,o,u;if(u=_(n),!angular.isArray(u)&&!angular.isObject(u)||0===u.length)return e;o=u.length;var p=function(e,n,t){var l=!1,a=function(e,n,t,a){return a===!1?(l=!1,!0):void(l=l||a)};if(0===o)return n.__filtered__=!0,!0;for(r=0;o>r;r++)if(d(e,n,u[r],"conditions",s,a),l)return!0;return!1};for(l=0,a=e.length;a>l;l++)i(t,e[l],"__children__",p,c);return e};return u}]).factory("$TreeDnDOrderBy",["$filter",function(e){var n=e("orderBy"),t=function(e,n,l,a){var r,o,i;if(!angular.isUndefinedOrNull(n[l])){for(i=n[l],o=i.length,r=0;o>r;r++)i[r]=t(e,i[r],l,a);n[l]=a(n[l],e)}return n},l=function(e,t){return n(e,t)};return function(e,n){if(!angular.isArray(e)||0===e.length||!(angular.isArray(n)||angular.isObject(n)||angular.isString(n))||0===n.length)return e;var a,r;for(a=0,r=e.length;r>a;a++)e[a]=t(n,e[a],"__children__",l);return e=l(e,n)}}]).directive("compile",["$compile",function(e){return{restrict:"A",link:function(n,t,l){n.$watch(l.compile,function(l){if(l){var a=e(l),r=a(n);angular.isFunction(t.empty)?t.empty():t.html(""),t.append(r)}})}}}]).directive("treeDndNodeHandle",function(){return{restrict:"A",scope:!0,link:function(e,n,t){e.$element=n,e.$type="TreeDnDNodeHandle",e.$class.handle&&n.addClass(e.$class.handle)}}}).directive("treeDndNode",function(){return{restrict:"A",replace:!0,link:function(e,n,t){e.$modelValue=null,e.$element=n,e.$type="TreeDnDNode",e.$icon_class="",e.$node_class="",e.getScopeNode=function(){return e},e.getData=function(){return e.$modelValue},e.getElementChilds=function(){return angular.element(n[0].querySelector("[tree-dnd-nodes]"))},e.$class.node&&(n.addClass(e.$class.node),e.$node_class=e.$class.node),e.$watch(t.treeDndNode,function(e,n,t){t.setScope(t,e),t.$modelValue=e,t.$icon_class=t.$class.icon[e.__icon__]},!0)}}}).directive("treeDndNodes",function(){return{restrict:"A",replace:!0,link:function(e,n,t){e.nodes=[],e.$nodes_class="",e.$type="TreeDnDNodes",e.$element=n,e.getScopeNode=null,e.$watch(t.treeDndNodes,function(e,n,t){t.nodes=e},!0),e.$class.nodes&&(n.addClass(e.$class.nodes),e.$nodes_class=e.$class.nodes)}}}).directive("treeDnd",["$timeout","$http","$compile","$window","$document","$templateCache","$TreeDnDTemplate","$TreeDnDClass","$TreeDnDHelper","$TreeDnDOrderBy","$TreeDnDFilter",function(e,n,t,l,a,r,o,i,d,s,c){return{restrict:"E",scope:!0,replace:!0,controller:["$scope","$element","$attrs",function(e,n,t){e.dragEnabled=!0,e.dropEnabled=!0,e.dragDelay=0,e.indent=20,e.indent_plus=15,e.indent_unit="px",e.$tree_class="table",e.primary_key="__uid__",e.enabledMove=!0,e.statusMove=!0,e.enabledHotkey=!1,e.enabledCollapse=null,e.enabledFilter=null,e.dragBorder=30,e.horizontal=null,e.$type="TreeDnD",e.colDefinitions=[],e.$globals={},e.$class={},e.tree_nodes=[],e.statusElm=null,e.placeElm=null,e.dragging=null,e.targeting=!1,e.for_all_descendants=function(n,t){if(angular.isFunction(t)){var l,a,r;if(t(n))return!1;for(r=n.__children__,a=r.length,l=0;a>l;l++)if(!e.for_all_descendants(r[l],t))return!1}return!0};var r;e.$callbacks={for_all_descendants:e.for_all_descendants,accept:function(e,n,t){return!0},beforeDrag:function(e){return!0},dragStart:function(e){},dragMove:function(e){},dragStop:function(e,n){},beforeDrop:function(e){return!0},calsIndent:function(n,t,l){var a=0,r=l?0:e.indent_plus;return t||(a=e.indent_unit?e.indent_unit:"px"),1>n-1?r+a:e.indent*(n-1)+r+a},droppable:function(){return e.dropEnabled},draggable:function(){return e.dragEnabled},changeKey:function(n){var t=n.__uid__;n.__uid__=Math.random(),n.__selected__&&delete n.__selected__,"__uid__"!==e.primary_key&&(t=""+n[e.primary_key],t=t.replace(/_#.+$/g,"")+"_#"+n.__uid__,n[e.primary_key]=t)},clone:function(e,n){return r=angular.copy(e),this.for_all_descendants(r,this.changeKey),r},remove:function(e,n,t){return n.splice(e.__index__,1)[0]},add:function(e,n,t,l){t&&(t.length>-1&&n>-1?t.splice(n,0,e):t.push(e))},dropped:function(e,n,t){if(!e)return null;if(!e.changed&&t)return!1;var l=e.node,a=null,r=e.move,o=null,i=e.parent||e.drag.treeData,d=r.parent||e.target.treeData;return e.target.$callbacks.accept(e,e.move,e.changed)?(t?(o=i,angular.isUndefinedOrNull(o.__children__)||(o=o.__children__),a=e.drag.$callbacks.remove(l,o,e.drag.$callbacks)):a=e.drag.$callbacks.clone(l,e.drag.$callbacks),t&&e.drag===e.target&&i===d&&r.pos>=e.node.__index__&&r.pos--,o=d,o.__children__&&(o=o.__children__),e.target.$callbacks.add(a,r.pos,o,e.drag.$callbacks),!0):!1}},e.setDragging=function(n){e.dragging=n},e.toggleExpand=function(e){e.__children__.length>0&&(e.__expanded__=!e.__expanded__)},e.getScopeTree=function(){return e},e.getPrevSibling=function(n){if(n&&n.__index__>0){var t,l=n.__index__-1;return angular.isUndefinedOrNull(n.__parent_real__)?e.treeData[l]:(t=e.tree_nodes[n.__parent_real__],t.__children__[l])}return null},e.getNode=function(n){return angular.isUndefinedOrNull(n)?null:e.tree_nodes[n]},e.getHash=function(n){return"__uid__"===e.primary_key?"#"+n.__parent__+"#"+n.__uid__:"#"+n.__parent__+"#"+n[e.primary_key]},e.setScope=function(n,t){var l=e.getHash(t);e.$globals[l]!==n&&(e.$globals[l]=n)},e.getScope=function(n){return n?e.$globals[e.getHash(n)]:e},e.enableMove=function(n){e.enabledMove="boolean"==typeof n?n:!0},e.visible=function(n){return n?n.__visible__?n:e.visible(e.tree_nodes[n.__parent_real__]):null},t.enableStatus?(e.enabledStatus=!1,e.hideStatus=function(){e.statusElm&&e.statusElm.addClass(e.$class.hidden)},e.refreshStatus=function(){if(e.dragging&&e.enabledStatus){var n=e.statusElm;e.statusElm=angular.element(e.enabledMove?o.getMove(e):o.getCopy(e)),n!==e.statusElm&&(n&&(e.statusElm.attr("class",n.attr("class")),e.statusElm.attr("style",n.attr("style")),n.remove()),a.find("body").append(e.statusElm)),e.statusElm.removeClass(e.$class.hidden)}},e.setPositionStatus=function(n,t){e.statusElm&&(e.statusElm.css({left:n.pageX+10+"px",top:n.pageY+15+"px","z-index":9999}),e.statusElm.addClass(e.$class.status))}):e.enabledStatus=null,e.initPlace=function(n,t){var a=null,r=!1;if(n?(a=n.prop("tagName").toLowerCase(),r="tr"===a||"td"===a):(a=e.getElementChilds().prop("tagName").toLowerCase(),r="tbody"===a||"table"===a),!e.placeElm)if(r){e.placeElm=angular.element(l.document.createElement("tr"));var o=e.colDefinitions.length;for(e.placeElm.append(angular.element(l.document.createElement("td")).addClass(e.$class.empty).addClass("indented").addClass(e.$class.place));o-->0;)e.placeElm.append(angular.element(l.document.createElement("td")).addClass(e.$class.empty).addClass(e.$class.place))}else e.placeElm=angular.element(l.document.createElement("li")).addClass(e.$class.empty).addClass(e.$class.place);return t&&e.placeElm.css("height",d.height(t)+"px"),n?n[0].parentNode.insertBefore(e.placeElm[0],n[0]):e.getElementChilds().append(e.placeElm),e.placeElm},e.hidePlace=function(){e.placeElm&&e.placeElm.addClass(e.$class.hidden)},e.showPlace=function(){e.placeElm&&e.placeElm.removeClass(e.$class.hidden)},e.$safeApply=function(e){var n=this.$root.$$phase;"$apply"===n||"$digest"===n?e&&"function"==typeof e&&e():this.$apply(e)},e.generateWatch=function(n,l,a,r,o,i){r=r||l,("string"==typeof n||"array"==typeof n||"object"==typeof n)&&(t[l]?e.$watch(t[l],function(t){e[r]="string"==typeof n&&typeof t===n||("array"==typeof n||"object"==typeof n)&&n.indexOf(typeof t)>-1?t:angular.isFunction(a)?a(t):a,angular.isFunction(i)&&i(e[r])},!0):angular.isFunction(o)?e[r]=o():angular.isUndefined(o)||(e[r]=o))}}],compile:function(_,u,p){var g="",f=_.html().trim();return f.length>0&&(g=f,_.html("")),function(_,u,p){var f,h,m,b,y,v,$,D=function(){if(_.treeData.length){var e,n,t=_.treeData[0],l=Object.keys(t),a=new RegExp("^__([a-zA-Z0-9_-]*)__$");for(n=0,e=l.length;e>n;n++)if("string"==typeof t[l[n]]&&!a.test(l[n]))return void(_.expandingProperty=l[n]);angular.isUndefinedOrNull(_.expandingProperty)&&(_.expandingProperty=l[0])}},x=function(){if(_.treeData.length){var e,n,t=[],l=_.treeData[0],a=new RegExp("(^__([a-zA-Z0-9_-]*)__$|^"+_.expandingProperty+"$)"),r=Object.keys(l);for(e=0,n=r.length;n>e;e++)"string"!=typeof l[r[e]]||a.test(r[e])||t.push({field:r[e]});_.colDefinitions=t}},C=function(e,n,t,l,a,r,o){var i,d,s,c,u,p;if(angular.isArray(n.__children__)||(n.__children__=[]),n.__parent_real__=l,n.__parent__=t,d=n.__children__.length,angular.isUndefinedOrNull(n.__expanded__)&&d>0&&(n.__expanded__=a<_.expandLevel),s=0===d?-1:n.__expanded__?1:0,c=e.length,n.__index__=o,n.__index_real__=c,n.__level__=a,n.__icon__=s,n.__visible__=r,angular.isUndefinedOrNull(n.__uid__)&&(n.__uid__=""+Math.random()),e.push(n),u=1,d>0)for(i=0;d>i;i++)u+=C(e,n.__children__[i],"__uid__"===_.primary_key?n.__uid__:n[_.primary_key],c,a+1,r&&n.__expanded__,i);return p=_.getHash(n),(angular.isUndefinedOrNull(n.__hashKey__)||n.__hashKey__!==p)&&(n.__hashKey__=p),n.__dept__=u,u},E=function(){var e=_.treeData,n=e.length,t=[];if(p.expandOn||D(),p.columnDefs||x(),angular.isUndefinedOrNull(_.orderBy)||(e=s(e,_.orderBy)),angular.isUndefinedOrNull(_.filter)||(e=c(e,_.filter,_.filterOptions)),n>0){var l,a,r,o,i,d=0;for(l=0;n>l;l++)d+=C(t,e[l],null,null,1,!0,l);if(i=Object.keys(_.$globals),n=_.$globals.length,a=n-d,0!==a)for(r=n-a,o=r-Math.abs(a),l=o;r>l;l++)delete _.$globals[i[l]]}return _.tree_nodes=t,_.tree_nodes},S={showParent:!0,showChild:!1},k=[["boolean","enableStatus",null,"enabledStatus"],["boolean","enableMove",null,"enabledMove"],["boolean","horizontal",null],[["object","string","array","function"],"orderBy",p.orderBy],["string","primaryKey",p.primaryKey,"primary_key","__uid__"],["string","indentUnit",p.indentUnit,"indent_unit"],["boolean","enableCollapse","boolean"==typeof p.enableCollapse?p.enableCollapse:null,"enabledCollapse"],["boolean","enableDrag","boolean"==typeof p.enableDrag?p.enableDrag:null,"dragEnabled"],["boolean","enableDrop","boolean"==typeof p.enableDrop?p.enableDrop:null,"dropEnabled"],["number","dragBorder","number"==typeof p.dragBorder?p.dragBorder:null],["number","indent","number"==typeof p.indent?p.indent:0],["number","indentPlus","number"==typeof p.indentPlus?p.indentPlus:0,"indent_plus"],["number","dragDelay","number"==typeof p.dragDelay?p.dragDelay:0],["null","callbacks",function(e){return angular.forEach(e,function(e,n){"function"==typeof e&&_.$callbacks[n]&&(_.$callbacks[n]=e)}),_.$callbacks},"$callbacks"],["boolean","enableHotkey",null,"enabledHotkey",null,function(e){_.enabledMove=e?!1:_.statusMove}],[["object","string"],"expandOn",D,"expandingProperty",D],[["array","object"],"columnDefs",x,"colDefinitions",x],["string","templateCopy",p.templateCopy,"templateCopy",null,function(e){e&&r.get(e)&&o.setCopy(e,_)}],["string","templateMove",p.templateMove,"templateMove",null,function(e){e&&r.get(e)&&o.setMove(e,_)}],[["object","array"],"filter",null,"filter",null,function(e){var n=!1;if(angular.isObject(e)&&!angular.isArray(e)){var t,l=Object.keys(e),a=l.length;if(T=!0,a>0)for(t=0;a>t;t++)if("string"!=typeof e[l[t]]||0!==e[l[t]].length){n=!0;break}}_.enabledFilter=n,E()}],["object","filterOptions",S,"filterOptions",S,function(e){"object"==typeof e&&(_.filterOptions=angular.extend(S,e))}],["number","expandLevel",3,"expandLevel",3,function(){E()}]],w=k.length;for(f=0;w>f;f++)h=k[f][0],m=k[f][1],b=k[f][2],y=k[f][3],v=k[f][4],$=k[f][5],_.generateWatch(h,m,b,y,v,$);if(p.treeData){var T=!0,N=function(){var e=_.$watch(p.treeData,function(n,t){(!angular.equals(n,t)||T)&&(_.treeData="object"==typeof n||"array"==typeof n?n:[],e(),T=!1,E(),N())},!0)};N()}p.treeClass?/^(\s+[\w\-]+){2,}$/g.test(" "+p.treeClass)?_.$tree_class=p.treeClass.trim():_.$watch(p.treeClass,function(e){switch(typeof e){case"string":_.$tree_class=e;break;case"object":angular.extend(_.$class,e),_.$tree_class=_.$class.tree;break;default:_.$tree_class=p.treeClass}}):_.$tree_class=_.$class.tree+" table",_.getElementChilds=function(){return angular.element(u[0].querySelector("[tree-dnd-nodes]"))},_.$class=angular.copy(i);var P,O;angular.extend(_.$class.icon,{1:p.iconExpand||"glyphicon glyphicon-minus",0:p.iconCollapse||"glyphicon glyphicon-plus","-1":p.iconLeaf||"glyphicon glyphicon-file"}),_.treeData||(_.treeData=[]),_.onClick=function(n){angular.isFunction(_.on_click)&&e(function(){_.on_click({node:n})})},_.onSelect=function(e){e!==O.selected_node&&O.select_node(e)},_.tree&&angular.isObject(_.tree)||(_.tree={}),O={selected_node:null,for_all_descendants:_.for_all_descendants,select_node:function(n){return n?(n!==O.selected_node&&(O.selected_node&&delete O.selected_node.__selected__,n.__selected__=!0,O.selected_node=n,O.expand_all_parents(n),angular.isFunction(_.on_select)&&e(function(){_.on_select({node:n})})),n):(O.selected_node&&delete O.selected_node.__selected__,O.selected_node=null,null)},deselect_node:function(){var e=null;return O.selected_node&&(delete O.selected_node.__selected__,e=O.selected_node,O.selected_node=null),e},get_parent:function(e){return e&&null!==e.__parent_real__?_.tree_nodes[e.__parent_real__]:null},for_all_ancestors:function(e,n){var t;return t=O.get_parent(e),t?n(t)?!1:O.for_all_ancestors(t,n):!0},expand_all_parents:function(e){return O.for_all_ancestors(e,function(e){e.__expanded__=!0})},reload_data:function(){return E()},add_node:function(e,n,t){return"number"!=typeof t?e?(e.__children__.push(n),e.__expanded__=!0):_.treeData.push(n):e?(e.__children__.splice(t,0,n),e.__expanded__=!0):_.treeData.splice(t,0,n),n},add_node_root:function(e){return O.add_node(null,e),e},expand_all:function(){var e=0,n=_.treeData.length,t=function(e){e.__expanded__=!0};for(e=0;n>e;e++)O.for_all_descendants(_.treeData[e],t)},collapse_all:function(){var e=0,n=_.treeData.length,t=function(e){e.__expanded__=!1};for(e=0;n>e;e++)O.for_all_descendants(_.treeData[e],t)},remove_node:function(e){if(e=e||O.selected_node){var n;n=e.__parent_real__?O.get_parent(e).__children__:_.treeData,n.splice(e.__index__,1),O.selected_node===e&&(O.selected_node=null)}},expand_node:function(e){return e||(e=O.selected_node),e?(e.__expanded__=!0,e):void 0},collapse_node:function(e){return e||(e=O.selected_node),e?(e.__expanded__=!1,e):void 0},get_selected_node:function(){return O.selected_node},get_first_node:function(){return P=_.treeData.length,P>0?_.treeData[0]:null},get_children:function(e){return e.__children__},get_siblings:function(e){var n,t;return e||(e=O.selected_node),e?(n=O.get_parent(e),t=n?n.__children__:_.treeData):void 0},get_next_sibling:function(e){var n;return e||(e=O.selected_node),e&&(n=O.get_siblings(e),P=n.length,e.__index__<P)?n[e.__index__+1]:void 0},get_prev_sibling:function(e){var n;return e||(e=O.selected_node),n=O.get_siblings(e),e.__index__>0?n[e.__index__-1]:void 0},get_first_child:function(e){var n;return e||(e=O.selected_node),e&&((n=e.__children__)?n.length:void 0)>0?e.__children__[0]:null},get_closest_ancestor_next_sibling:function(e){var n,t;return n=O.get_next_sibling(e),n?n:(t=O.get_parent(e),O.get_closest_ancestor_next_sibling(t))},get_next_node:function(e){var n;return e||(e=O.selected_node),e?(n=O.get_first_child(e),n?n:O.get_closest_ancestor_next_sibling(e)):void 0},get_prev_node:function(e){var n,t;return e||(e=O.selected_node),e?(t=O.get_prev_sibling(e),t?O.get_last_descendant(t):n=O.get_parent(e)):void 0},get_last_descendant:function(e){var n;return e||(e=O.selected_node),P=e.__children__.length,0===P?e:(n=e.__children__[P-1],O.get_last_descendant(n))},select_parent_node:function(e){var n;return e||(e=O.selected_node),e&&(n=O.get_parent(e))?O.select_node(n):void 0},select_first_node:function(){return O.select_node(O.get_first_node())},select_next_sibling:function(e){var n;return e||(e=O.selected_node),e&&(n=O.get_next_sibling(e))?O.select_node(n):void 0},select_prev_sibling:function(e){var n;return e||(e=O.selected_node),e&&(n=O.get_prev_sibling(e))?O.select_node(n):void 0},select_next_node:function(e){var n;return e||(e=O.selected_node),e&&(n=O.get_next_node(e))?O.select_node(n):void 0},select_prev_node:function(e){var n;return e||(e=O.selected_node),e&&(n=O.get_prev_node(e))?O.select_node(n):void 0}},angular.extend(_.tree,O),O=_.tree;var Y,X,A,M,j,H,U,F,B="ontouchstart"in window,L=!0,I=!1,K=null,W=document.body,z=document.documentElement,R=function(e){if((B||2!==e.button&&3!==e.which)&&!(e.uiTreeDragging||e.originalEvent&&e.originalEvent.uiTreeDragging)){var n=angular.element(e.target),t=n.scope();if(t&&t.$type&&"TreeDnDNodeHandle"===t.$type){var r=n.prop("tagName").toLowerCase(),o=null;if("input"!==r&&"textarea"!==r&&"button"!==r&&"select"!==r){for(;n&&n[0]&&n[0]!==u;){if(d.nodrag(n))return;n=n.parent()}if(e.uiTreeDragging=!0,e.originalEvent&&(e.originalEvent.uiTreeDragging=!0),e.preventDefault(),o=t.getScopeNode(),Y=!0,_.$callbacks.beforeDrag(o)){var i=d.eventObj(e),s=o.$element.prop("tagName").toLowerCase(),c="tr"===s;X=d.dragInfo(o),_.setDragging(X),A=d.positionStarted(i,o.$element),j=c?angular.element(l.document.createElement("table")).addClass(_.$class.tree).addClass(_.$class.drag).addClass(_.$tree_class):angular.element(l.document.createElement("ul")).addClass(_.$class.drag).addClass("tree-dnd-nodes").addClass(_.$tree_class),j.css({width:d.width(o.$element)+"px","z-index":9995}),F=0;var p=d.width(o.$element),g=o,f=g.$element,h=null,m=_.enabledCollapse,b=!1,y=null;if(c)F=X.node.__level__-1,y=angular.element(l.document.createElement("tbody")),_.for_all_descendants(X.node,function(e){g=_.getScope(e),f=g.$element,b||(h=f.clone(),d.replaceIndent(g,h,e.__level__-F,"padding-left"),y.append(h),m&&(b=!0)),_.enabledMove&&_.$class.hidden&&f.addClass(_.$class.hidden)}),j.append(y);else{if(m){var v=g.getElementChilds(),$=angular.element("<swaped />");v.after(angular.element("<holder />")),$.append(v),h=f.clone(),h.find("holder").remove(),f.find("holder").replaceWith(v),$.remove(),v=null}else h=f.clone();j.append(h),_.enabledMove&&_.$class.hidden&&f.addClass(_.$class.hidden)}j.css({left:i.pageX-A.offsetX+_.$callbacks.calsIndent(F+1,!0,!0)+"px",top:i.pageY-A.offsetY+"px"}),a.find("body").append(j),_.$callbacks.droppable()&&(M=_.initPlace(o.$element,j),c&&d.replaceIndent(_,M,X.node.__level__),M.css("width",p)),_.showPlace(),_.targeting=!0,_.enabledStatus&&(_.refreshStatus(),_.setPositionStatus(e)),angular.element(a).bind("touchend",J),angular.element(a).bind("touchcancel",J),angular.element(a).bind("touchmove",G),angular.element(a).bind("mouseup",J),angular.element(a).bind("mousemove",G),angular.element(a).bind("mouseleave",Q),H=Math.max(W.scrollHeight,W.offsetHeight,z.clientHeight,z.scrollHeight,z.offsetHeight),U=Math.max(W.scrollWidth,W.offsetWidth,z.clientWidth,z.scrollWidth,z.offsetWidth)}}}}},q=function(e){if(!I)return void(L||(I=!0,_.$safeApply(function(){_.$callbacks.dragStart(X)})));if(j){e.preventDefault(),l.getSelection?l.getSelection().removeAllRanges():l.document.selection&&l.document.selection.empty();var n=d.eventObj(e),t=n.pageX-A.offsetX,a=n.pageY-A.offsetY;0>t&&(t=0),0>a&&(a=0),a+10>H&&(a=H-10),t+10>U&&(t=U-10),j.css({left:t+_.$callbacks.calsIndent(F+1,!0,!0)+"px",top:a+"px"}),_.enabledStatus&&_.setPositionStatus(e);var r=window.pageYOffset||l.document.documentElement.scrollTop,o=r+(window.innerHeight||l.document.clientHeight||l.document.clientHeight);if(o<n.pageY&&H>=o&&window.scrollBy(0,10),r>n.pageY&&window.scrollBy(0,-10),d.positionMoved(e,A,Y),Y)return void(Y=!1);var i=n.pageX-l.document.body.scrollLeft,s=n.pageY-(window.pageYOffset||l.document.documentElement.scrollTop),c=null,u=null,p=null,g=null,f=null,h=!1,m=!0,b=!0,y=!1,v=!1,$=null,D=null,x=X.move,C=1,E=X.node,S=X.drop,k=X.target,w=null,T=!1,N=function(){if(M){var n=d.offset(M);T=n.top<=e.pageY&&e.pageY<=n.top+n.height&&n.left<=e.pageX&&e.pageX<=n.left+n.width?!0:!1}};if(N(),!T){if(c=angular.element(l.document.elementFromPoint(i,s)),u=c.scope(),!u)return;if(w=function(){if(k=u.getScopeTree(),D=X.target,X.target!==k){if(!k.$callbacks.droppable())return!1;D.hidePlace(),D.targeting=!1,k.targeting=!0,X.target=k,M=k.initPlace(u.$element,j),D=null,v=!0}return!0},angular.isFunction(u.getScopeNode)){if(u=u.getScopeNode(),!w())return}else{if("TreeDnDNodes"!==u.$type&&"TreeDnD"!==u.$type)return;if(!u.tree_nodes)return;if(0===u.tree_nodes.length){if(!w())return;y=!0}}}if((A.dirAx&&!v||T)&&(b=!1,u=X.scope),!u.$element&&!u)return;if(y)f=u.$element.prop("tagName").toLowerCase(),h="tbody"===f||"table"===f||"tr"===f||"td"===f,x.parent=null,x.pos=0,S=null;else if(f=u.$element.prop("tagName").toLowerCase(),h="tr"===f||"tbody"===f||"td"===f,b){if(c=u.$element,g=d.offset(c),u.horizontal&&!h)p=n.pageX<g.left+d.width(c)/2;else if(h)p=n.pageY<g.top+d.height(c)/2;else{var P=d.height(c);if(u.getElementChilds()&&(P-=-d.height(u.getElementChilds())),n.pageY>g.top+P)return;p=n.pageY<g.top+P/2}if(D=u.getData(),K=u.getNode(D.__parent_real__),p){var O=u.getPrevSibling(D);x.parent=K,x.pos=angular.isUndefinedOrNull(O)?0:O.__index__+1,S=O}else!D.__expanded__||1===D.__children__.length&&D.__index_real__===E.__parent_real__?(x.parent=D,x.pos=D.__index__+1,S=D):(x.parent=D,x.pos=0,S=null)}else{if(!(A.dirAx&&A.distAxX>=k.dragBorder))return;if(A.distAxX=0,A.distX>0){if(K=S,!K){if(!(x.pos-1>=0))return;K=x.parent.__children__[x.pos-1]}if(X.drag===X.target&&K===E&&_.enabledMove&&(K=k.getPrevSibling(K)),!K||!K.__visible__)return;var B=K.__children__.length;x.parent=K,x.pos=B,S=B>0?K.__children__[B-1]:null}else{if(!(A.distX<0))return;if(D=x.parent,!D||!(0===D.__children__.length||D.__children__.length-1<x.pos||D.__children__.length-1===E.__index__&&D.__index__real__===E.__parent_real__&&_.enabledMove))return;K=k.getNode(D.__parent_real__),x.parent=K,x.pos=D.__index__+1,S=D}}if(X.drag===X.target&&x.parent&&E.__parent_real__===x.parent.__index_real__&&E.__index__===x.pos&&(m=!1),k.$callbacks.accept(X,x,m)){if(X.move=x,X.drop=S,X.changed=m,X.scope=u,h)if(C=angular.isUndefinedOrNull(x.parent)?1:x.parent.__level__+1,d.replaceIndent(k,M,C),S){var K=(x.parent?x.parent.__children__:null)||X.target.treeData;S.__index__<K.length-1?(S=K[S.__index__+1],$=X.target.getScope(S),$.$element[0].parentNode.insertBefore(M[0],$.$element[0])):(D=X.target.tree.get_last_descendant(S),$=X.target.getScope(D),$.$element.after(M))}else $=X.target.getScope(x.parent),$&&(x.parent?$.$element.after(M):$.getElementChilds().prepend(M));else $=X.target.getScope(S||x.parent),S?$.$element.after(M):$.getElementChilds().prepend(M);k.showPlace(),_.$safeApply(function(){_.$callbacks.dragMove(X)})}}},V=function(e){if(e.preventDefault(),j){var n=!1,t=_.getScope(X.node),r=t.$element.prop("tagName").toLowerCase(),o="tr"===r,i=t.$element;_.$safeApply(function(){n=_.$callbacks.beforeDrop(X)}),o?_.for_all_descendants(X.node,function(e){t=_.getScope(e),i=t.$element,t.$class.hidden&&i.removeClass(_.$class.hidden)}):_.$class.hidden&&i.removeClass(_.$class.hidden),j.remove(),j=null,_.enabledStatus&&_.hideStatus();var d=!1;_.$$apply?_.$safeApply(function(){d=_.$callbacks.dropped(X,n,_.enabledMove)}):ee(),_.$safeApply(function(){_.$callbacks.dragStop(X,d)}),X.target.hidePlace(),X.target.targeting=!1,X=null,_.$$apply=!1,_.setDragging(null)}angular.element(a).unbind("touchend",J),angular.element(a).unbind("touchcancel",J),angular.element(a).unbind("touchmove",G),angular.element(a).unbind("mouseup",J),angular.element(a).unbind("mousemove",G),angular.element(l.document.body).unbind("mouseleave",Q)},Z=function(e){_.$callbacks.draggable()&&R(e)},G=function(e){q(e)},J=function(e){_.$$apply=!0,_.dragEnd(e)},Q=function(e){_.dragEnd(e)},ee=function(){u.bind("touchstart mousedown",function(n){L=!0,I=!1,Z(n),K=e(function(){L=!1},_.dragDelay)}),u.bind("touchend touchcancel mouseup",function(){e.cancel(K)})},ne=function(e){if(27===e.keyCode)_.enabledStatus&&_.hideStatus(),_.$$apply=!1,_.dragEnd(e);else if(_.enabledHotkey&&e.shiftKey){if(_.enableMove(!0),_.enabledStatus&&_.refreshStatus(),!X)return;var n=_.getScope(X.node),t=n.$element.prop("tagName").toLowerCase(),l=n.$element;"tr"===t?_.for_all_descendants(X.node,function(e){n=_.getScope(e),l=n.$element,_.$class.hidden&&l.addClass(_.$class.hidden)}):_.$class.hidden&&l.addClass(_.$class.hidden)}},te=function(e){if(_.enabledHotkey&&!e.shiftKey){if(_.enableMove(!1),_.enabledStatus&&_.refreshStatus(),!X)return;var n=_.getScope(X.node),t=n.$element.prop("tagName").toLowerCase(),l=n.$element;"tr"===t?_.for_all_descendants(X.node,function(e){n=_.getScope(e),l=n.$element,_.$class.hidden&&l.removeClass(_.$class.hidden)}):_.$class.hidden&&l.removeClass(_.$class.hidden)}};_.dragEnd=function(e){V(e)},ee(),angular.element(l.document.body).bind("keydown",ne),angular.element(l.document.body).bind("keyup",te),_.$on("$destroy",function(){angular.element(l.document.body).unbind("keydown",ne),angular.element(l.document.body).unbind("keyup",te),_.statusElm&&_.statusElm.remove(),_.placeElm&&_.placeElm.remove()}),_.$safeApply(function(){g.length>0?u.append(t(g)(_)):n.get(p.templateUrl||o.getPath(),{cache:r}).success(function(e){u.append(t(e.trim())(_))})})}}}}]),angular.module("template/TreeDnD/TreeDnD.html",[]).run(["$templateCache",function(e){e.put("template/TreeDnD/TreeDnD.html",'<table ng-class="$tree_class">    <thead>  <tr>     <th ng-class="expandingProperty.titleClass" ng-style="expandingProperty.titleStyle">         {{expandingProperty.displayName || expandingProperty.field || expandingProperty}}        </th>        <th ng-repeat="col in colDefinitions" ng-class="col.titleClass" ng-style="col.titleStyle">         {{col.displayName || col.field}}     </th>    </tr>    </thead> <tbody tree-dnd-nodes="tree_nodes">  <tr tree-dnd-node="node" ng-repeat="node in nodes track by node.__hashKey__ " ng-show="node.__visible__"       ng-click="onSelect(node)" ng-class="(node.__selected__ ? \' active\':\'\')">        <td ng-if="!expandingProperty.template" tree-dnd-node-handle         ng-style="expandingProperty.cellStyle ? expandingProperty.cellStyle : {\'padding-left\': $callbacks.calsIndent(node.__level__)}"          ng-class="expandingProperty.cellClass"            compile="expandingProperty.cellTemplate">              <a data-nodrag>                  <i ng-class="$icon_class" ng-click="toggleExpand(node)"                     class="tree-icon"></i>              </a>             {{node[expandingProperty.field] || node[expandingProperty]}}       </td>        <td ng-if="expandingProperty.template" compile="expandingProperty.template"></td>        <td ng-repeat="col in colDefinitions" ng-class="col.cellClass" ng-style="col.cellStyle"            compile="col.cellTemplate">            {{node[col.field]}}       </td>    </tr>    </tbody></table>'),e.put("template/TreeDnD/TreeDnDStatusCopy.html",'<label><i class="fa fa-copy"></i>&nbsp;<b>Copying</b></label>'),e.put("template/TreeDnD/TreeDnDStatusMove.html",'<label><i class="fa fa-file-text"></i>&nbsp;<b>Moving</b></label>')}])}).call(window);
//# sourceMappingURL=/ng-tree-dnd.min.js.map